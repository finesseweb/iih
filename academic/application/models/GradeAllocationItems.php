<?php/**  * @Framework Zend Framework * @Powered By TIS  * @category   ERP Product * @copyright  Copyright (c) 2014-2015 Techintegrasolutions Pvt Ltd. * (http://www.techintegrasolutions.com) *	Authors Kannan and Rajkumar */class Application_Model_GradeAllocationItems extends Zend_Db_Table_Abstract{    public $_name = 'grade_allocation_items';    protected $_id = 'grade_allocation_item_id';      //get details by record for edit	public function getRecords($id)    {               $select=$this->_db->select()                      ->from($this->_name)                      ->where("$this->_name.grade_allocation_id=?", $id);				   					  //->where("$this->_name.status !=?", 2);					 // echo $select;die;        $result=$this->getAdapter()                      ->fetchAll($select);       				          return $result;    }	public function getRecordsOnComponentID($id)    {               $select=$this->_db->select()                      ->from($this->_name)                      ->where("$this->_name.component_id=?", $id);				   					  //->where("$this->_name.status !=?", 2);					 // echo $select;die;        $result=$this->getAdapter()                      ->fetchAll($select);            return $result;    }               public function getStudentFailDetailsAll($session,$department,$cmn_terms,$fail_no_subject=0,$student_id = '',$promotion = false){                  $select = empty($student_id)?"select  COUNT(DISTINCT course_id,cmn_terms) as fail_in,":"select ";                $select.="temtb.*  from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session and cmn_terms in $cmn_terms AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                 and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent";                $select .= !empty($student_id)?" and erp_student_information.student_id in ('$student_id')":"";                                $select .= !$promotion?" ) as temtb where  grade_value REGEXP '(F|NA|Ab|D)'":" ) as temtb where  grade_value NOT REGEXP '(F|NA|Ab|D)'";                                $select .= empty($student_id)?" group by student_id having COUNT(DISTINCT course_id,cmn_terms) >= $fail_no_subject":" group by cmn_terms,course_id";            // echo "<pre>".$select;                $result=$this->getAdapter()                  ->fetchAll($select);              return $result;                    }                public function getStudentFailDetailsAllwithstudentlist($session,$department,$cmn_terms,$fail_no_subject=0,$student_id = '',$promotion = false){                  $select = empty($student_id)?"select  COUNT(DISTINCT course_id,cmn_terms) as fail_in,":"select ";                $select.="temtb.*  from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session and cmn_terms in $cmn_terms AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                 and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent";                $select .= !empty($student_id)?" and erp_student_information.student_id in ('$student_id')":"";                                $select .= !$promotion?" ) as temtb where  grade_value REGEXP '(F|NA|Ab|D)'":" ) as temtb where  grade_value NOT REGEXP '(F|NA|Ab|D)'";                                $select .= empty($student_id)?" group by student_id having COUNT(DISTINCT course_id,cmn_terms) >= $fail_no_subject":" group by student_id";           // echo "<pre>".$select;                $result=$this->getAdapter()                  ->fetchAll($select);              return $result;                    }          public function getStudentFailDetailsAllwithouttab($session,$department,$cmn_terms,$fail_no_subject=0,$student_id = '',$promotion = false){                  $select = empty($student_id)?"select  COUNT(DISTINCT course_id,cmn_terms) as fail_in,":"select ";                $select.="temtb.*  from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                            ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session and cmn_terms in $cmn_terms AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent";                $select .= !empty($student_id)?" and erp_student_information.student_id = $student_id":"";                                $select .= !$promotion?" ) as temtb where  grade_value REGEXP '(F|NA|Ab|D)'":" ) as temtb where  grade_value NOT REGEXP '(F|NA|Ab|D)'";                                $select .= empty($student_id)?" group by student_id having COUNT(DISTINCT course_id,cmn_terms) >= $fail_no_subject":" group by cmn_terms,course_id";           //  echo "<pre>".$select; die;                $result=$this->getAdapter()                  ->fetchAll($select);              return $result;                    }             public function getAllFailAndPassDetails($session,$department,$cmn_terms,$fail_no_subject=0,$student_id = '',$promotion = false,$res = array()){                $select = "select createdtb.student_id,createdtb.stu_fname,createdtb.reg_no,createdtb.exam_roll,createdtb.father_fname                    ,createdtb.stu_id,createdtb.father_mobileno,createdtb.stu_email_id,createdtb.academic_id from (select sum(fail_in) as fail_in , sum(pass_in) as pass_in,temptb.student_id,temptb.stu_fname,temptb.reg_no,temptb.exam_roll,temptb.father_fname                    ,temptb.stu_id, temptb.father_mobileno,temptb.stu_email_id,temptb.academic_id FROM (select case when grade_value NOT REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as pass_in,case when grade_value  REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as fail_in,temtb.*  from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                ,tabulation_report                ,tabulation_report_items                ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session and cmn_terms in $cmn_terms AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                 and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id";                $select .= $res ? " and grade_allocation_items.student_id not in $res":"";                $select .= " and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent ) as temtb group by student_id,course_id,cmn_terms) as temptb GROUP by student_id ) as createdtb where";                $select .= !$promotion?"  fail_in>0":" fail_in = 0";          //  echo "<pre>".$select; die;         $result=$this->getAdapter()                  ->fetchAll($select);              return $result;                    }            public function notpromotedtype1($session,$department,$cmn_terms,$prom=0,$deleteddate=""){    $select = "select * from (SELECT finaldb.*,GROUP_CONCAT(remarks) as flag from (select  case when pass_in >= pass_count and appear_in >= appeared_paper then 1 else 0 End as remarks ,student_id,stu_fname,reg_no,exam_roll,father_fname                    ,stu_id,father_mobileno,stu_email_id,cmn_terms from (select sum(pass_in) pass_in,sum(fail_in) fail_in,sum(appear_in) appear_in,student_id,stu_fname,reg_no,exam_roll,father_fname                    ,stu_id,father_mobileno,stu_email_id,prom_id,pass_count,appeared_paper,cmn_terms from (select case when grade_value NOT REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as pass_in,case when grade_value  REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as fail_in,case when grade_value NOT REGEXP '(NA|Ab)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as appear_in,temtb.* from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* ,promotion_master.id as prom_id,promotion_seperate_items.semester_paper_count pass_count,promotion_master.appeared_paper from ";                 $select.=!empty($deleteddate)?" deleted_grade_allocation_items as grade_allocation_items": " grade_allocation_items" ;               $select.= " ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                ,tabulation_report                ,tabulation_report_items                ,promotion_master                ,promotion_seperate_items                ,term_master                ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session  AND `flag` LIKE 'r')                  and promotion_master.semester in $cmn_terms                and promotion_master.session = grade_allocation_master.session                and promotion_seperate_items.master_id = promotion_master.id                 and grade_allocation_master.cmn_terms = promotion_seperate_items.cmn_terms                and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and term_master.cmn_terms = promotion_master.semester                and term_master.academic_year_id = academic_master.academic_year_id                and promotion_master.degree_id = grade_allocation_master.degree_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                 and tabulation_report.term_id = term_master.term_id                 and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master.session = grade_allocation_master.session";                 $select.=!empty($deleteddate)?" and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$deleteddate'":"";                $select.=" and reference_grade_master_items.reference_id = reference_grade_master.reference_id and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent ) as temtb group by student_id,course_id,cmn_terms) as temptb group by student_id,cmn_terms)  as createddb ) as finaldb  group by student_id) as newfinaltb where flag $prom like '%0%'";   //  echo "<pre>".$select; die;     $result=$this->getAdapter()                  ->fetchAll($select);                   // echo "<pre>";print_r($result);            return $result;}          public function notpromotedtype2($session,$department,$cmn_terms,$prom=0,$deleteddate=""){    $select = "select * from (select  case when pass_in >= pass_count and appear_in >= appeared_paper then 1 else 0 End as remarks ,student_id,stu_fname,reg_no,exam_roll,father_fname                    ,stu_id,father_mobileno,stu_email_id from (select sum(pass_in) pass_in,sum(fail_in) fail_in,sum(appear_in) appear_in,student_id,stu_fname,reg_no,exam_roll,father_fname                    ,stu_id,father_mobileno,stu_email_id,prom_id,pass_count,appeared_paper from (select case when grade_value NOT REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as pass_in,case when grade_value  REGEXP '(F|NA|Ab|D)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as fail_in,case when grade_value NOT REGEXP '(NA|Ab)' then COUNT(DISTINCT course_id,cmn_terms) ELSE 0 END as appear_in,temtb.* from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.* ,promotion_master.id as prom_id,promotion_master.semester_paper_count pass_count,promotion_master.appeared_paper from ";                 $select.=!empty($deleteddate)?" deleted_grade_allocation_items as grade_allocation_items": " grade_allocation_items" ;               $select.= " ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                ,tabulation_report                ,tabulation_report_items                ,promotion_master                ,term_master                ,academic_master where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session = $session  AND `flag` LIKE 'r')                  and promotion_master.semester in $cmn_terms                and promotion_master.session = grade_allocation_master.session                and FIND_IN_SET(grade_allocation_master.cmn_terms, promotion_master.cmn_terms)                and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and academic_master.department = $department                and term_master.cmn_terms = promotion_master.semester                and term_master.academic_year_id = academic_master.academic_year_id                and promotion_master.degree_id = grade_allocation_master.degree_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                 and tabulation_report.term_id = term_master.term_id                 and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master.session = grade_allocation_master.session";                  $select.= !empty($deleteddate)?" and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$deleteddate'":"";                $select.= " and reference_grade_master_items.reference_id = reference_grade_master.reference_id and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent ) as temtb group by student_id,course_id,cmn_terms) as temptb group by student_id)  as createddb ) as finaldb where remarks = $prom";                //echo "<pre>".$select;die;     $result=$this->getAdapter()                  ->fetchAll($select);              return $result;}          public function getStudentFailDetailsAlldeleted($session,$department,$cmn_terms,$date,$student_id=""){        $select="select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id                from deleted_grade_allocation_items as grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session in ($session) and grade_allocation_master.cmn_terms in ($cmn_terms) and grade_allocation_master.department in ($department) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'                and grade_allocation_master.flag like 'r'                and grade_allocation_items.flag like 'B'                and grade_allocation_items.grade_value REGEXP '(F|NA|Ab|D)'";                $select .= !empty($student_id)?" and erp_student_information.student_id in ('$student_id')":"";                $select.=" group by erp_student_information.student_id                order by grade_allocation_items.grade_allocation_item_id ASC";              //  echo "<pre>".$select;                 $result=$this->getAdapter()                      ->fetchAll($select);              return $result;                    }                 public function getStudentFailDetailsAccudeleted($session,$department,$cmn_terms,$date,$student_id=""){        $select="select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id                from accu_grade_allocation_items as grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session in ($session) and grade_allocation_master.cmn_terms in $cmn_terms and grade_allocation_master.department in ($department) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'                and grade_allocation_master.flag like 'r'                and grade_allocation_items.grade_value REGEXP '(F|NA|Ab|D)'";                $select .= !empty($student_id)?" and erp_student_information.student_id in ('$student_id')":"";                $select.=" group by erp_student_information.student_id                order by grade_allocation_items.grade_allocation_item_id ASC";                // if($department==14){                // echo "<pre>".$select;die;                // }                 $result=$this->getAdapter()                      ->fetchAll($select);              return $result;                    }             public function getStudentFailDetailsAlludeleted($session,$department,$cmn_terms,$date,$student_id=""){        $select="select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,erp_student_information.father_mobileno,erp_student_information.stu_email_id,erp_student_information.academic_id                from  grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.session in ($session) and grade_allocation_master.cmn_terms in ($cmn_terms) and grade_allocation_master.department in ($department) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = erp_student_information.student_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and grade_allocation_master.flag like 'r'                and grade_allocation_items.grade_value REGEXP '(F|NA|Ab|D)'";                $select .= !empty($student_id)?" and erp_student_information.student_id in ('$student_id')":"";                $select.=" group by erp_student_information.student_id                order by grade_allocation_items.grade_allocation_item_id ASC";              //  echo "<pre>".$select;die;                 $result=$this->getAdapter()                      ->fetchAll($select);              return $result;                    }     public function getStudentMarksDetails($academic_year_id,$terms_ids=array(),$ispayment=false,$isAttendance=false,$tabTermId=0,$cmn_terms = '',$date=""){        //===============line 292============================//        //  and ((erp_student_information.stu_status != 3 and erp_student_information.is_course_completed != 1)         //         or (erp_student_information.stu_status =3 and erp_student_information.leaving_sem != grade_allocation_master.cmn_terms)         //         or (erp_student_information.stu_status =3 and  erp_student_information.is_course_completed =1)        //         or (erp_student_information.stu_status !=3 and  erp_student_information.is_course_completed =1)        //         or (erp_student_information.stu_status !=3 and  erp_student_information.leaving_sem != grade_allocation_master.cmn_terms))        if($cmn_terms=="t1")        return $this->getStudentMarksDetailsWithoutTab($academic_year_id,$terms_ids,$ispayment,$isAttendance,$tabTermId,$cmn_terms );             $sql="";    if($isAttendance){        $sql.="select * from (";    }                $sql.= "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.stu_dob,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*";                $sql.=$isAttendance?",semester_wise_attendance_report.course_id attcourse":"";                $sql.=!empty($date)?" from accu_grade_allocation_items as grade_allocation_items":" from grade_allocation_items";                 $sql.=",erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                ,tabulation_report                ,tabulation_report_items                ,academic_master";                                            $sql.=$ispayment?",exam_form_submission":"";            $sql.=$isAttendance?",semester_wise_attendance_report":"";            $sql.=" where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and term_id in ('".implode("','",$terms_ids)."') AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                               and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                And academic_master.academic_year_id = erp_student_information.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id";                $sql.=!empty($date)?" and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'":"";                $sql.=$tabTermId>0?" and tabulation_report.term_id = $tabTermId":" and tabulation_report.term_id = grade_allocation_master.term_id";                $sql.=$tabTermId>0?" and tabulation_report_items.final_remarks like 'p'":"";                                $sql.=$ispayment?" and exam_form_submission.student_id=grade_allocation_items.student_id":"";                $sql.=$ispayment?" and exam_form_submission.term_id=grade_allocation_master.term_id":"";                $sql.=$ispayment?" and exam_form_submission.payment_status=1":"";                                $sql.=$isAttendance?" and semester_wise_attendance_report.u_id = erp_student_information.stu_id":"";                $sql.=$isAttendance?" and semester_wise_attendance_report.cmn_terms = grade_allocation_master.cmn_terms":"";                $sql.=$isAttendance?" and  ((semester_wise_attendance_report.course_id = 0 and academic_master.department = grade_allocation_master.department)                   or   (semester_wise_attendance_report.course_id = grade_allocation_master.course_id and semester_wise_attendance_report.ge_id = grade_allocation_master.ge_id) )":"";                                $sql.=" and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                group by stu_id,course_id order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,cast(ExtractNumber(course_master.course_code) as unsigned)";                                if($isAttendance){                    $sql.=") as temtbl                    where (temtbl.attcourse = 0 and temtbl.ge_id = 0) or (temtbl.attcourse != 0 and temtbl.ge_id != 0)";                }          //  echo "<pre>".$sql; die;            $result=$this->getAdapter()                      ->fetchAll($sql);              return $result;        } public function getStudentMarksDetailsWithoutTab($academic_year_id,$terms_ids=array(),$ispayment=false,$isAttendance=false,$tabTermId=0,$cmn_terms){     $sql="";    if($isAttendance){        $sql.="select * from (";    }                $sql.= "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.stu_dob,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_id,course_type_master.ct_name,course_master.course_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.component_id,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*";                $sql.=$isAttendance?",semester_wise_attendance_report.course_id attcourse":"";                $sql.=" from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master";            $sql.=$ispayment?",exam_form_submission":"";            $sql.=$isAttendance?",semester_wise_attendance_report":"";            $sql.=" where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and term_id in ('".implode("','",$terms_ids)."') AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id";                $sql.=$ispayment?" and exam_form_submission.student_id=grade_allocation_items.student_id":"";                $sql.=$ispayment?" and exam_form_submission.term_id=grade_allocation_master.term_id":"";                $sql.=$ispayment?" and exam_form_submission.payment_status=1":"";                                $sql.=$isAttendance?" and semester_wise_attendance_report.u_id = erp_student_information.stu_id":"";                $sql.=$isAttendance?" and semester_wise_attendance_report.cmn_terms = grade_allocation_master.cmn_terms":"";                $sql.=$isAttendance?" and  ((semester_wise_attendance_report.course_id = 0 and semester_wise_attendance_report.department = grade_allocation_master.department)                   or   (semester_wise_attendance_report.course_id = grade_allocation_master.course_id and semester_wise_attendance_report.ge_id = grade_allocation_master.ge_id) )":"";                                $sql.=" and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,cast(ExtractNumber(course_master.course_code) as unsigned)";                                if($isAttendance){                    $sql.=") as temtbl                    where (temtbl.attcourse = 0 and temtbl.ge_id = 0) or (temtbl.attcourse != 0 and temtbl.ge_id != 0)";                }             //  echo "<pre>".$sql;die;            $result=$this->getAdapter()                      ->fetchAll($sql);              return $result;}public function getArchivedData($academic_year_id,$term_id,$student_id,$course_id,$date){     $sql = "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*                from deleted_grade_allocation_items as grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and term_id in ($term_id) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and grade_allocation_items.student_id = $student_id                and grade_allocation_master.course_id = $course_id                and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'                and grade_allocation_master.flag like 'r'                and grade_allocation_items.flag like 'B'                order by grade_allocation_items.grade_allocation_item_id ASC";                        $result=$this->getAdapter()                      ->fetchRow($sql);              return $result;}public function getArchivedData1($academic_year_id,$term_id,$student_id,$course_id,$date){     $sql = "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*                from grade_allocation_items as grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and term_id in ($term_id) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and grade_allocation_items.student_id = $student_id                and grade_allocation_master.course_id = $course_id                and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'                and grade_allocation_master.flag like 'r'                and grade_allocation_items.flag like 'B'                order by grade_allocation_items.grade_allocation_item_id ASC";                        $result=$this->getAdapter()                      ->fetchRow($sql);              return $result;}public function getArchivedDataaccu($academic_year_id,$term_id,$student_id,$course_id,$date){     $sql = "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*                from accu_grade_allocation_items as grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and term_id in ($term_id) AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and grade_allocation_items.student_id = $student_id                and grade_allocation_master.course_id = $course_id                and DATE_FORMAT(grade_allocation_items.publish_date,'%Y-%m-%d') = '$date'                and grade_allocation_master.flag like 'r'                order by grade_allocation_items.grade_allocation_item_id ASC";                        $result=$this->getAdapter()                      ->fetchRow($sql);              return $result;}public function getcompletedterms($stu_id){    $select ="select count(distinct tabulation_report_items.tabl_id)/2 as completed_year from tabulation_report                ,tabulation_report_items,                erp_student_information                where erp_student_information.student_id = tabulation_report_items.student_id                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report.flag like 'R'                and stu_id = '$stu_id'";            //    echo "<pre>".$select; die;                $result=$this->getAdapter()                      ->fetchRow($select);              return $result;}    public function getCGPAForStudent($acdemic_year_id,$stu_id="",$cmn_terms = "'t1','t2','t3','t4','t5','t6'"){	$select ="select * from (select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,grade_allocation_master.degree_id,grade_allocation_master.session,sum(obtained_marks) obtained_marks,sum(total_marks) total_marks                    ,FORMAT((sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value)),2) cgpa                from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items";               $select.=" where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($acdemic_year_id) and cmn_terms in ($cmn_terms) AND `flag` LIKE 'r')";                   $select.=" and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and core_course_master.count_id = 0";                if(!empty($stu_id))                $select.=" and stu_id = '$stu_id'";                $select.=" GROUP by stu_id                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,course_type_master.ct_name) as t order by cgpa desc";                 $result=$this->getAdapter()                      ->fetchRow($select);              return $result;                }public function getCGPAForStudentdegree($acdemic_year_id='',$stu_id="",$cmn_terms = "'t1','t2','t3','t4','t5','t6'",$deg=false,$session="",$last_term ='t6'){    	$select ="select course_name ,dept_type,group_concat(students) as grades,academic_id from (select academic_id,dept_type,dept_id,course_name,concat(course_name,'_',letter_grade,'_',count(dept_id)) as students  from (select department_type.department_type as dept_type,department.id as dept_id,department.department as course_name,erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.academic_id,erp_student_information.stu_id,grade_allocation_master.degree_id,grade_allocation_master.session,sum(obtained_marks) obtained_marks,sum(total_marks) total_marks                    ,format(case when grade_allocation_master.degree_id =3 then FORMAT(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9.25                     when grade_allocation_master.degree_id =1 AND grade_allocation_master.session <7 THEN FORMAT(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9                     ELSE FORMAT(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9.5 END,2) as percent                    ,FORMAT((sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value)),2) cgpa                from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,department                ,department_type                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items";                if(!$deg)               $select.=" where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($acdemic_year_id) and cmn_terms in ($cmn_terms) AND `flag` LIKE 'r')";                 else               $select.=" where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.degree_id = $deg and grade_allocation_master.session = $session and cmn_terms in ($cmn_terms) AND `flag` LIKE 'r')";                                   $select.=" and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                 and department.id = grade_allocation_master.department                 and department_type.id = department.department_type                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.term_id = grade_allocation_master.term_id";               $select.=" and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and core_course_master.count_id = 0";                if(!empty($stu_id))                $select.=" and stu_id in ('$stu_id')";                $select.=" GROUP by stu_id                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,course_type_master.ct_name) as t ,reference_grade_master                ,reference_grade_master_items                where reference_grade_master.degree_id = t.degree_id                and reference_grade_master.session = t.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= round(percent)                and reference_grade_master_items.marks_to >= round(percent)  group by dept_id,letter_grade) as newtb group by dept_id";               // echo "<pre>".$select;die;                 $result=$this->getAdapter()                      ->fetchAll($select);              return $result;                }public function getCGPAForStudentRanking($acdemic_year_id,$stu_id=""){	$select ="select * from (select  erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,grade_allocation_master.degree_id,grade_allocation_master.session,sum(obtained_marks) obtained_marks,sum(total_marks) total_marks,                    format(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),3)  cgpa                from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($acdemic_year_id) and cmn_terms in ('t1','t2','t3','t4','t5','t6') AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                and core_course_master.count_id = 0";                if(!empty($stu_id))                $select.=" and stu_id = '$stu_id'";                $select.=" GROUP by stu_id                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,course_type_master.ct_name) as t order by cgpa desc";                 $result=$this->getAdapter()                      ->fetchAll($select);              return $result;                }		public function trashItems($grade_allocation_id) {        $this->_db->delete($this->_name, "grade_allocation_id=$grade_allocation_id");    }	    public function saveRows($array) {        $vAmount    = count($array);        $values     = array();        $columns    = array();    if($vAmount>0){        foreach ($array as $colval) {            foreach ($colval as $column=>$value) {                array_push($values,$value);                !in_array($column,$columns) ? array_push($columns,$column) : null;            }        }        $cAmount    = count($columns);        $values     = array_chunk($values, $cAmount);        $iValues    = '';        $iColumns   = implode("`, `", $columns);        for($i=0; $i<$vAmount;$i++)            $iValues.="('".implode("', '", $values[$i])."')".(($i+1)!=$vAmount ? ',' : null);        $data="INSERT INTO `".$this->_name."` (`".$iColumns."`) VALUES ".$iValues;        $this->getAdapter()->query($data);    }}}?>