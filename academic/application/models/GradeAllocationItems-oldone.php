<?php/**  * @Framework Zend Framework * @Powered By TIS  * @category   ERP Product * @copyright  Copyright (c) 2014-2015 Techintegrasolutions Pvt Ltd. * (http://www.techintegrasolutions.com) *	Authors Kannan and Rajkumar */class Application_Model_GradeAllocationItems extends Zend_Db_Table_Abstract{    public $_name = 'grade_allocation_items';    protected $_id = 'grade_allocation_item_id';      //get details by record for edit	public function getRecords($id)    {               $select=$this->_db->select()                      ->from($this->_name)                      ->where("$this->_name.grade_allocation_id=?", $id);				   					  //->where("$this->_name.status !=?", 2);					 // echo $select;die;        $result=$this->getAdapter()                      ->fetchAll($select);       				          return $result;    }	public function getRecordsOnComponentID($id)    {               $select=$this->_db->select()                      ->from($this->_name)                      ->where("$this->_name.component_id=?", $id);				   					  //->where("$this->_name.status !=?", 2);					 // echo $select;die;        $result=$this->getAdapter()                      ->fetchAll($select);            return $result;    }        public function getStudentMarksDetails($academic_year_id){                            $sql = "select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,course_type_master.ct_name,course_master.course_code,grade_allocation_master.course_id,core_course_master.ge_id,core_course_master.count_id,grade_allocation_master.term_id,                    grade_allocation_master.cmn_terms,grade_allocation_items.grade_value,grade_allocation_items.number_value,obtained_marks obtained_marks,total_marks,percent,                    credit_master.credit_value,                reference_grade_master_items.*                from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($academic_year_id) and cmn_terms in ('t1','t2','t3','t4','t5','t6') AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,course_type_master.ct_name";            $result=$this->getAdapter()                      ->fetchAll($sql);              return $result;        }     public function getCGPAForStudent($acdemic_year_id,$stu_id=""){	$select ="select erp_student_information.student_id,erp_student_information.stu_fname,erp_student_information.reg_no,erp_student_information.exam_roll,erp_student_information.father_fname                    ,erp_student_information.stu_id,grade_allocation_master.degree_id,grade_allocation_master.session,sum(obtained_marks) obtained_marks,sum(total_marks) total_marks,                    format(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)  cgpa,CASE                     WHEN reference_grade_master.degree_id = 3 THEN                    format(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9.25                    WHEN reference_grade_master.degree_id > 1 THEN                    format(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9.5                    ELSE                    format(sum(reference_grade_master_items.number_grade*credit_master.credit_value)/sum(credit_master.credit_value),2)*9                    END                    percentage                from grade_allocation_items                 ,erp_student_information                ,grade_allocation_master                ,core_course_master                ,credit_master                ,reference_grade_master                ,reference_grade_master_items                ,course_master                ,course_type_master                 ,tabulation_report                ,tabulation_report_items                where grade_allocation_items.grade_allocation_id in (SELECT grade_id FROM `grade_allocation_master` WHERE grade_allocation_master.academic_id in ($acdemic_year_id) and cmn_terms in ('t1','t2','t3','t4','t5','t6') AND `flag` LIKE 'r')                  and erp_student_information.student_id = grade_allocation_items.student_id                and grade_allocation_master.grade_id = grade_allocation_items.grade_allocation_id                AND core_course_master.academic_year_id = grade_allocation_master.academic_id                and core_course_master.course_id = grade_allocation_master.course_id                and course_master.course_id = grade_allocation_master.course_id                and core_course_master.term_id =  grade_allocation_master.term_id                and core_course_master.credit_id = credit_master.credit_id                and course_type_master.ct_id = course_master.ct_id                and tabulation_report.academic_id = grade_allocation_master.academic_id                and tabulation_report.term_id = grade_allocation_master.term_id                and tabulation_report.flag like 'R'                and tabulation_report_items.tabl_id = tabulation_report.tabl_id                and tabulation_report_items.student_id = grade_allocation_items.student_id                and reference_grade_master.degree_id = grade_allocation_master.degree_id                and reference_grade_master.session = grade_allocation_master.session                and reference_grade_master_items.reference_id = reference_grade_master.reference_id                and reference_grade_master_items.marks_from <= percent                and reference_grade_master_items.marks_to >= percent";                if(!empty($stu_id))                $select.=" and stu_id = '$stu_id'";                $select.=" GROUP by stu_id                order by erp_student_information.exam_roll,grade_allocation_master.cmn_terms,course_type_master.sort_order,course_type_master.ct_name";                 $result=$this->getAdapter()                      ->fetchRow($select);              return $result;                }		public function trashItems($grade_allocation_id) {        $this->_db->delete($this->_name, "grade_allocation_id=$grade_allocation_id");    }	}?>