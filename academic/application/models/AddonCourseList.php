<?phpclass Application_Model_AddonCourseList extends Zend_Db_Table_Abstract {    public $_name = 'addon_courses_list';    protected $_id = 'id';    public function getRecord($id) {        $select = $this->_db->select()                ->from($this->_name)                ->where("$this->_name.$this->_id =?", $id);        $result = $this->getAdapter()                ->fetchRow($select);        return $result;    }    public function checkExistedData($acadYear) {        $select = $this->_db->select()                ->from($this->_name)                ->where("$this->_name.academic_year =?", $acadYear)                ->where("$this->_name.status != ?", 2);        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }    public function getRecords() {        $select = $this->_db->select()                ->from($this->_name)                ->where("$this->_name.status != ?", 2);        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }    public function getAddonCourseCount($yearId) {        $select = $this->_db->select()                ->from($this->_name, array('name', 'id', 'capacity', 'conductedby', 'fee','tot_credit', "count(distinct(addon_allot.stu_id)) as total_applied"))                ->joinLeft(array('addon_allot' => 'addon_courses_allotment'), "addon_allot.addon_course_id = $this->_name.id", array())                ->where("$this->_name.status != ?", 2)                ->where("$this->_name.academic_year = ?", $yearId)                ->group("$this->_name.id");        //echo $select;die;        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }    public function getAddonCoursePaidCount($yearId) {        $select = $this->_db->select()                ->from('addon_courses_allotment', array("count(distinct(addon_courses_allotment.stu_id)) as total_paid", 'addon_course_id'))                ->join(array('paymode_details' => 'applicant_paymode_details'), "paymode_details.form_id = addon_courses_allotment.stu_id", array())                ->joinRight(array('addon_master' => 'addon_course_mater'), "addon_master.id = addon_courses_allotment.addon_course_id", array())                ->where("addon_master.academic_year = ?", $yearId)                ->group("addon_master.id");        $result = $this->getAdapter()                ->fetchAll($select);        //echo $select;die;        return $result;    }    public function getRecordByAddonCourse($addon_course_id) {        $select = $this->_db->select()                ->from('addon_courses_allotment', array())                ->joinLeft(array('course_d' => 'applicant_course_details'), "course_d.form_id = addon_courses_allotment.stu_id", array('course_d.applicant_name', 'course_d.form_id', 'course_d.course'))                ->joinLeft(array('deptType' => 'department_type'), "deptType.id = course_d.course", array('department_type'))                ->joinLeft(array('students' => 'erp_student_information'), "students.stu_id = course_d.form_id", array('reg_no', 'exam_roll', 'roll_no', 'stu_email_id', 'father_mobileno'))                ->where("addon_courses_allotment.addon_course_id = ?", $addon_course_id);        //echo $select;die;        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }    public function getRecordByAddonStream($addon_course_id, $stream) {        $select = $this->_db->select()                ->from('addon_courses_allotment', array())                ->joinLeft(array('course_d' => 'applicant_course_details'), "course_d.form_id = addon_courses_allotment.stu_id", array('course_d.applicant_name', 'course_d.form_id', 'course_d.course'))                ->joinLeft(array('deptType' => 'department_type'), "deptType.id = course_d.course", array('department_type'))                ->where("deptType.id = ?", $stream)                ->where("addon_courses_allotment.addon_course_id = ?", $addon_course_id);        //echo $select;die;        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }    public function getDropDownList() {        $select = $this->_db->select()                ->from($this->_name, array('id', 'name'))                //->where("status !=?",2)                ->order('name  ASC');        $result = $this->getAdapter()->fetchAll($select);        $data = array();        $st_year = '';        $end_year = '';        foreach ($result as $val) {            $data[$val['id']] = $val['name'];            // $data[$val['academic_id']] = substr($val['from_date']).'-'.substr($val['to_date']);            //print_r($data);die;        }        return $data;    }             public function getDropDownListByYear($academic_year) {        $select = $this->_db->select()                ->from($this->_name, array('id', 'name'))                ->where("academic_year =?",$academic_year)                ->order('name  ASC');        $result = $this->getAdapter()->fetchAll($select);   return $result;                }public function getRecordByID($id) {             $select = $this->_db->select()                ->from($this->_name)                ->where("$this->_name.id = ?", $id)                ->where("$this->_name.status != ?", 2);        $result = $this->getAdapter()                ->fetchRow($select);        return $result;    }        public function getRecordByAcad($id,$acad) {             $select = $this->_db->select()                ->from($this->_name)                ->join(array('addon_master' => 'addon_course_mater'), "addon_master.id = $this->_name.addon_course_id", array('name'))                               ->where("$this->_name.addon_course_id = ?", $id)                ->where("$this->_name.academic_year= ?", $acad)                ->where("$this->_name.status != ?", 2);// echo $select;die;        $result = $this->getAdapter()                ->fetchAll($select);        return $result;    }     public function getDropDownListByYearID($acad) {        $select = $this->_db->select()                ->from($this->_name, array('id', 'name'))               ->where("$this->_name.academic_year= ?", $acad)                ->order('name  ASC');        $result = $this->getAdapter()->fetchAll($select);        $data = array();        $st_year = '';        $end_year = '';        foreach ($result as $val) {            $data[$val['id']] = $val['name'];            // $data[$val['academic_id']] = substr($val['from_date']).'-'.substr($val['to_date']);            //print_r($data);die;        }        return $data;    }    public function getStudentByAddonID($course_id){     $select = $this->_db->select()                ->from($this->_name)               ->joinLeft(array("student"=>"erp_student_information"),"student.stu_id=$this->_name.stu_id")               ->joinLeft(array("academic"=>"academic_master"),"academic.academic_year_id=student.academic_id")               ->where("$this->_name.addon_course_id = ?",$course_id)               ->where("$this->_name.status != ?",2);                      $result = $this->getAdapter()                ->fetchAll($select);        return $result;} public function getStudenInfoByFormIdForAddon($id) {        $rwo='';        $select = $this->_db->select()            ->from($this->_name)            ->join(array("list_stu" => "erp_student_information"), "list_stu.stu_id=$this->_name.stu_id",array('student_id'))            ->where("$this->_name.status !=?", 2)            ->where("$this->_name.stu_id =?", $id)            ->group("list_stu.roll_no");        $result = $this->getAdapter()            ->fetchRow($select);                  if ($result) {            $select = $this->_db->select()                ->from($this->_name);            $select->join(array("addon_course" => "addon_course_mater"), "addon_course.academic_year= $this->_name.academic_year", array('name', 'conductedby', 'code','tot_credit'));                       $select->where("addon_course.academic_year=?", $result['academic_year']);             $select->where("addon_course.id=?", $result['addon_course_id']);          //  echo $select;die;            $result1 = $this->getAdapter()                ->fetchRow($select);                   }               if ($result) {            $select  ->join(array("erp" => "erp_student_information"), "erp.stu_id=$this->_name.stu_id",array('student_id'));                   $select->join(array("tr_items" => "addon_grade_allocation_items"), "tr_items.student_id=erp.student_id", array('grade_value','number_value'));          $select->where("tr_items.student_id=?", $result['student_id']);           $select->group("tr_items.student_id");          $result6 = $this->getAdapter()                ->fetchAll($select);         // echo $select; die();        }        foreach($result6 as $res) {            $rwo.=$res['grade_value'];            $rwo.=',';                         $rwo2.=$res['number_value'];            $rwo2.=',';        }               if($result) {            $select = $this->_db->select()                ->from($this->_name);            $select->join(array("academic_year" => "academic_year"), "academic_year.year_id= $this->_name.academic_year", array('academic_year as session'));            $result7 = $this->getAdapter()                ->fetchRow($select);                   }                                // echo $select;die;        $split_date = explode('-', $result3['added_date']);        $result['last_exam_date'] = $split_date[0];        $result['failed_count'] = $result1['failed_count'];        $result['total_grade'] = $result1['total_grade'];        $result['total_credit'] = $result1['tot_credit'];        $result['batch'] = $result1['batch_code'];        $result['session'] = $result7['session'];        $result['session_id'] = $result2['id'];        $result['degree'] = $result4['degree_id'];        $result['dept_name'] = $result4['description'];        $result['course_name'] = $result1['name'];        $result['conducted'] = $result1['conductedby'];        $result['dept_id'] = $result4['id'];        $result['exam_date'] = !empty($result5['exam_date']) ? $result5['exam_date'] : 'N/A';         $result['grade_value']=(explode(',',$rwo));         $result['number_value']=(explode(',',$rwo2));        // echo "<pre>";  print_r($result);exit;        return $result;    }}