<?php
//echo "hello";die;
$stu_details = $this->stu_details;
$course_model = new Application_Model_Corecourselearning();

$extra_span = 0;
if (in_array($stu_details['academic_id'], array(53, 54))) {
    $extra_span = 1;
}
$url = $this->url;
$passmarks = $this->passpercent;

$sl_no = $this->gradesheet_number;
// //===============[WIDTHS]
// $marks_width = '20px';
// $marks_width1 = '20px';
// $marks_width4 = '25px';
// $marks_width3 = "14px";
// $total_width = "10px";
$single_pr = $this->single;

$cgpaf = array();
$tgpa = array();
$credit_number = $degree_id = 0;

    $session_name = 'XXXX-XXXXX';
if ($stu_details['academic_id']) {
    $academic_credits = new Application_Model_TotalEarnedCredits();
    $credit_number = $academic_credits->getRecordAcademic($stu_details['academic_id'])['credit_number'];
     $academic_model = new Application_Model_Academic();
     $department_model = new Application_Model_Department();
     
        $academic_details = $academic_model->getRecord($stu_details['academic_id']);
        $depert_detial=$department_model->getRecord($academic_details['department']);
        $session_model = new Application_Model_Session();
        $session_name = $session_model->getRecord($academic_details['session'])['session'];
        
        $deg_details = new Application_Model_Department();
        $d_id = $academic_details['department'];
        $programmDetails = $deg_details->getRecord($d_id);
        $degree_id = $programmDetails['degree_id'];
        $programmName = $programmDetails['description'];
   
}
$back_dates = $this->back_dates;
$back_ids = $this->back_ids;
$noncoldate = max($back_dates);
$key = array_search ($noncoldate, $back_dates);
$date_added = $this->added_date[$key];
$back_tabl_id = $back_ids[$key];
?>
<style>
    /*body{*/
    /*   background-image: url('https://pwcadmissions.in/academic/public/images/watermark.png');*/
    /*   background-repeat:no-repeat;*/
    /*    background-size: cover;*/
    /*}*/
/*.sup {*/
/*  position: relative;*/
/*  font-size: 98%;*/
/*  line-height: 0;*/
/*  top: -0.5em;*/
/*  vertical-align: baseline;*/
/*}*/


    @page {
        background: url('https://pwcadmissions.in/academic/public/images/watermark.png') no-repeat 0 0;
        background-image-resize: 6;
    }
    table{
        margin:0 !important;
        width:100% !important;
    }

    .sub{
        border:.01em solid #932e90;
        text-align: center;
<?php if ($this->year_id) { ?>
            font-size: 0.72rem; 
        <?php } else { ?>
            font-size:10px;
        <?php } ?>
    }

    .cleanup{
        border-top:0px solid #000;
    }

    .cleandown{
        border-bottom:0px solid #000;
    }

    th{
        width:auto !important;
        font-size:.8em;
    }

    td,tr{
        margin:0 !important;
        font-size:14px !important;

    }

</style>



<div class="grade-data-container" >
    <table class="tablestyle1"  cellspacing ="0" >
        <thead>

            <tr >
                <!--[COLLEGE HEADER AND LOG STUDENT IMAGE]--->
                <th class="<?php
        if ($this->year_id) {
            echo "sub";
        }
        ?>" <?php
                if (!$this->year_id) {
                    echo 'style="text-align:left"';
                }
                ?> width='<?= $marks_width; ?>' ><img src="<?= $this->mainconfig['publicpath']; ?>/images/img.png"  height="130"></th>
                <th class="<?php
                    if ($this->year_id) {
                        echo "sub";
                    }
                    ?>"  width='<?= $marks_width1; ?>' >
                    <pre style="font-family:'Times New Roman'; border:1px solid #fff;">
 <span style ="font-size:1.5em;  font-weight:900">PATNA&nbsp;WOMEN'S&nbsp;COLLEGE</span>
                        <?php if ($this->year_id) { ?>
    <br/><span style ="font-size:1.3em; letter-spacing:.05em; font-weight:900">AUTONOMOUS</span><br />
    <span style ="font-size:1em; font-weight:900">PATNA UNIVERSITY</span>
                        <?php } else { ?>
    <br/><span style ="font-size:1.3em; letter-spacing:.05em; font-weight:900;">AUTONOMOUS</span><br />
    <span style ="font-size:1.3em; font-weight:900">PATNA UNIVERSITY, PATNA</span>
                        <?php } ?>
                        <?php if ($this->year_id) { ?>
    <br /><span style ="font-size:0.9em;">3rd Cycle NAAC Accredited <span style="text-transform: lowercase;">at</span> A Grade <span style="text-transform: lowercase;">with</span>&nbsp;CGPA 3.58/4</span>
    <span style ="font-size:1em;">'College<span style="text-transform: lowercase;"> with</span> Potential <span style="text-transform: lowercase;">for</span> Excellence'(CPE) <span style="text-transform: lowercase;">&nbsp;status accorded by </span>UGC</span>
    <span style ="font-size:1em; font-weight:900"> BAILEY ROAD,PATNA</span> - 800 001, BIHAR
                           
                        </pre>
                    </th>
                    <th class="sub" width='<?= $marks_width; ?>'>
    <?php if (!empty($stu_details['filename'])) { ?>
                            <img  width="132" src="<?= $this->mainconfig['host'] . $stu_details['filename']; ?>">
                        <?php } else { ?>
                            No image.
                        <?php } ?><br>
                        <?= $stu_details['stu_id']; ?>

                    </th>
<?php } else { ?>
                    <th class="<?php
                    if ($this->year_id) {
                        echo "sub";
                    }
                    ?>" width='<?= $marks_width; ?>' style="text-align:right">
                        <img  src="<?= $this->mainconfig['imagesurl'] . "Patna_University.png"; ?>" width="180"  >

                    </th>

<?php } ?>
            </tr>

<?php if ($this->year_id) { 
$slspace = str_pad("SL. NO.",26," ");
    $slspace = str_replace(" ", "&nbsp;",$slspace);
    
    
    $issuedate = str_pad("DATE OF ISSUE",23," ");
    $issuedate = str_replace(" ", "&nbsp;",$issuedate);
    
    //Added By Kedar for Examination Dates
    $term_det = new Application_Model_TermMaster();
    //echo '<pre>'; print_r($this->term_marks[1]);exit;
    $term_name = !empty($this->term_marks[1]) ? $term_det->getRecord($this->term_marks[1]) : false;
    $term = !empty($term_name['cmn_terms']) ? $term_name['cmn_terms'] : '';
    $session_id = !empty($academic_details['session']) ? $academic_details['session'] : '';
    $requiredData = array(
        'acad_id' => $academic_details['academic_year_id'],
        'term' => $term,
        'session' => $session_id,
        'exam_type' => 1
    );

     $examDateModel = new Application_Model_ExamDateModel();
     $examinationDates = $examDateModel->getRecordByAcadId($requiredData);
?>
                <tr>
                    
                    <th class="sub" style ="text-align:left;"><?=$slspace;?>  : <?=str_pad($sl_no,3,0,STR_PAD_LEFT); ?></th>

                    <th  class="sub">
                        <?= $academic_details['batch_code']; ?>
                    </th>
                     <th style="text-align:left;" class="sub" colspan = "1" ><small> <span style ="font-size:1.2em; font-weight:900"><?php if($examinationDates['stu_mark_sheet_status']=='0') { ?><?=$issuedate;?>  : <?=Date("d-m-Y"); }?></span></small></th>
              

                </tr>

                <!--            AACADEMIC SESSION AND PRINT OUT DATE-->
                <tr>
    <?php
    if (!$stu_details['academic_id']) {
        $col_span = 3;
        $align = 'center';
    } else {
        $col_span = '';
        $align = 'left';
    }
     $sessionspace = str_pad("SESSION",24," ");
    $sessionspace = str_replace(" ", "&nbsp;",$sessionspace);
    ?>
                    
                     <?php
   
    if (!$stu_details['academic_id']) {
        echo "Student Report Card Not Pepared!";
        exit;
    }
    
    
    
    //echo '<pre>';print_r($this->term_marks[1]);exit;
    //End Kedar Date : 27 Jan 2021
    $subject = str_pad("SUBJECT",24," ");
    $subject = str_replace(" ", "&nbsp;",$subject);
    $student_name = str_pad("STUDENT'S NAME",16," ");
    $student_name = str_replace(" ", "&nbsp;",$student_name);
    $mother_name = str_pad("MOTHER'S NAME",16," ");
    $mother_name = str_replace(" ", "&nbsp;",$mother_name);
    $father_name = str_pad("FATHER'S NAME",17," ");
    $father_name = str_replace(" ", "&nbsp;",$father_name);
    $spacedate = str_pad("DATE OF RESULT",21," ");
    $spacedate = str_replace(" ", "&nbsp;",$spacedate);
    $issuedate = str_pad("DATE OF ISSUE",27," ");
    $issuedate = str_replace(" ", "&nbsp;",$issuedate); 
    $spaceexam = str_pad("EXAMINATION ROLL NO.",22," ");
    $spaceexam = str_replace(" ", "&nbsp;",$spaceexam);
    $spacereg = str_pad("REGISTRATION NO.",27," ");
    $spacereg = str_replace(" ", "&nbsp;",$spacereg);
    
    
    ?>


                    <td class="sub" style ="text-align:left;"><span style ="font-size:1em;"><b><?=$sessionspace;?>:  <?= $session_name; ?></b></span></td>
                    <th class="sub"  style ="font-size:.7em;">STATEMENT OF MARKS AND GRADE POINTS (CBCS)</th>
                    <th class="sub" style ="text-align:left;">     <span style ="">
    <?php
    $reval_date = new Application_Model_TabulationReportItems();
    $trModel = new Application_Model_TabulationReport();
    $added_date = '';
  //  if($this->tabldetails['term_id']){
        $added_date = $reval_date->getRecordByStudentId($this->student_marks_details[$this->term_marks[0]][0]['student_id'], $this->term_marks);
  //  }
    $checkYearPassStatus = $reval_date->checkYearPassoutStudent($this->student_marks_details[$this->term_marks[0]][0]['student_id'], $added_date['NonTblId'], $added_date['RevalTblId']);

    $revalD = !empty($added_date['reval_date']) ? date("Y-m-d", strtotime($added_date['reval_date'])) : "";
    $NonCollegiateD = $added_date['noncolligiate_date'];

    // echo "<pre>"; print_r($added_date);exit;
    // echo '<pre>'; print_r($this->term_marks);  exit;
//    if (!empty($checkYearPassStatus)) {
        $dtae = Date('d-m-Y', strtotime($examinationDates['result_publish_date']));
        //echo '<pre>';print_r($revalDates);exit;
       
        if (!empty($added_date['NonTblId']) || !empty($added_date['RevalTblId'])) {
            if (!empty($added_date['reval_date']) && $revalD > $NonCollegiateD) {
                $followupDate = $revalD;
                $cmnTerms = $trModel->getTermIdByTablId($added_date['RevalTblId']);
            } else {
                $followupDate = $NonCollegiateD;
                $cmnTerms = $trModel->getTermIdByTablId($added_date['NonTblId']);
            }
            
            $this->tabldetails['term_id'] = $cmnTerms['term_id'];
            $revalDates = $examDateModel->getRevalDatesByAcadId($academic_details['academic_year_id'], $followupDate, $this->tabldetails['term_id']);
            /// echo '<pre>'; print_r($revalDates);  exit;
            if ($revalD > $NonCollegiateD) {
                $followupDate = $revalD;
                $cmnTerms = $trModel->getTermIdByTablId($added_date['RevalTblId']);
            } else {
                $followupDate = $NonCollegiateD;
                $cmnTerms = $trModel->getTermIdByTablId($added_date['NonTblId']);
            }
            $this->tabldetails['term_id'] = $cmnTerms['term_id'];
            $revalDates = $examDateModel->getRevalDatesByAcadId($academic_details['academic_year_id'], $followupDate, $this->tabldetails['term_id']);
           ///  echo '<pre>'; print_r($revalDates);  exit;
                if ($revalD > $NonCollegiateD) {
                    $revalDate = Date('d-m-Y', strtotime($revalDates['reval_date'])); ?>
                    </span><?=$spacedate;?> : </span><?= $revalDate; ?> 

                    <?php
                } else {
               $publishDate = Date('d-m-Y', strtotime($revalDates['result_publish_date']));
                    ?>
                    </span><?=$spacedate;?> : </span><?=$publishDate; ?> 

                    <?php
                }
                
                
            } else {
               
               $dtae = Date('d-m-Y', strtotime($examinationDates['result_publish_date']));
                ?>
                <?=$spacedate;?> : </span><?= $dtae; ?> 
            <?php
            } ?>
           </td>

                </tr>

                <!--            STUDENT PERSONAL DETAILS-->
              
   
                 <tr>
                     <th style="text-align:left;" class="sub" colspan = "3"><span style ="font-size:1em; font-weight:900"><?=$subject;?>:  </span> <?=trim($programmName);?> </th>
                    </tr>        
                <tr>
                    <th class="sub" style='text-align:left;' colspan=2 ><span style ="font-size:1em; font-weight:900"><?=$student_name;?>: </span> <?= $stu_details['stu_fname'] . ' ' . $stu_details['stu_lname']; ?></th>
                    <th class="sub" style='text-align:left;' ><span style ="font-size:1em; font-weight:900"><?=$spaceexam;?>: </span><?= $stu_details['exam_roll']; ?></th>
                </tr>

                <tr>
                    <th class="sub" style='text-align:left;' colspan=2><span style ="font-size:1em; font-weight:900"><?=$mother_name;?>: </span>
    <?php
    if ($single_pr) {
        $term_det = new Application_Model_TermMaster();
        $term_name = $term_det->getRecord($this->term_marks[0])['term_name'];
        echo "$term_name (Examination" . !empty($examinationDates['exam_date']) ? date("F", strtotime($examinationDates['exam_date'])) . ' ' . date("Y", strtotime($examinationDates['exam_date'])) : 'N/A' . ")";
        ?>

                            <?php
                        } else {

                            echo $stu_details['mother_fname'] . ' ' . $stu_details['mother_lname'];
                        }
                        ?>


                    </th>
                    <th class="sub" style='text-align:left;'><span style ="font-size:1em; font-weight:900"><?=$spacereg;?>:</span> <?= $stu_details['reg_no']; ?></th>
                </tr>
                <tr ><th  style='text-align:left;' class="sub" colspan=2><span style ="font-size:1em; font-weight:900"><?=$father_name;?>:  </span> <?= $stu_details['father_fname'] . ' ' . $stu_details['father_lname']; ?></th>
             
                    <th class="sub" style='text-align:left;'>
                       <!-- <span style ="font-size:1em; font-weight:900">-->
    <?php
   ?>  
                    </th></tr>
<?php } else { ?>

                <!--fixed header in  final grade sheet-->
                <tr>
                    <th  colspan=3 class="sup" style ="font-size:1.1em;"><?= $academic_details['batch_code']; ?></th>
                </tr>
                <tr>
                    <th colspan=3 style ="text-align:center; padding-top:12px; vertical-align: baseline; font-size:.9em;">STATEMENT OF MARKS AND GRADE POINTS (CBCS)</th>
                </tr>


                <tr>
                    <th style="text-align:left">SL. NO: <?=str_pad($sl_no,3,0,STR_PAD_LEFT); ?></th>
                    <th ></th>
                    <th></th>
                </tr>
    <?php
    $academic_model = new Application_Model_Academic();
    $examDateModel = new Application_Model_ExamDateModel();
    if (!$stu_details['academic_id']) {
        echo "Student Report Card Not Pepared !";
        exit;
    }
    //Added By Kedar for Examination Dates
    $term_det = new Application_Model_TermMaster();
    $maxKey = max(array_keys($this->term_marks));
    $term_name = $term_det->getRecord($this->term_marks[$maxKey]);
    $term = !empty($term_name['cmn_terms']) ? $term_name['cmn_terms'] : '';
    $session_id = !empty($academic_details['session']) ? $academic_details['session'] : '';
    $requiredData = array(
        'acad_id' => $academic_details['academic_year_id'],
        'term' => $term,
        'session' => $session_id,
        'exam_type' => 1
    );
    //echo '<pre>';print_r($requiredData);exit;
    $examinationDates = $examDateModel->getRecordByAcadId($requiredData);
    //End Kedar Date : 27 Jan 2021    
    ?>
               <tr>
                   <th style="text-align:left" >SUBJECT </th>
                   <th style="text-align:left" colspan="1"><?=trim($programmName);?></th>
                   <th  rowspan=7 style="text-align:right; padding-right:0px; padding-top:0px;"> <?php if (!empty($stu_details['filename'])) { ?>
                            <img  width="130" height="120" style="" src="<?=$this->mainconfig['host'] . $stu_details['filename']; ?>">
    <?php } else { ?>
                            No image.
                        <?php } ?>
                    </th>
               </tr>     
                <tr>
                    <th style="text-align:left">STUDENT'S&nbsp;NAME</th>
                    <th style="text-align:left"><?= $stu_details['stu_fname'] . ' ' . $stu_details['stu_lname']; ?> </th>
                    <th></th>
                </tr>
                <tr>
                    <th style="text-align:left">FATHER'S&nbsp;NAME</th>
                    <th style="text-align:left"><?= $stu_details['father_fname'] . ' ' . $stu_details['father_lname']; ?> </th>
                    <th></th>
                </tr>
                <tr>
                    <th style="text-align:left" >REGISTRATION&nbsp;NO.</th>
                    <th style="text-align:left"><?= $stu_details['reg_no']; ?></th>
                    <th  ></th>
                </tr>

                <tr>
                    <th style="text-align:left;padding:0;margin:0;">EXAMINATION&nbsp;ROLL&nbsp;NO.</th>
                    <th style="text-align:left"><?= $stu_details['exam_roll']; ?></th>
                    <th ></th>
                </tr>

                <tr>
                    <th style="text-align:left">SESSION</th>

                    <th style="text-align:left"><?= $session_name; ?></th>
                    <th ></th>
                </tr>


    <?php
    $reval_date = new Application_Model_TabulationReportItems();
    $trModel = new Application_Model_TabulationReport();
    $added_date = $reval_date->getRecordByStudentId($this->student_marks_details[$this->term_marks[0]][0]['student_id'], $this->term_marks);
  // echo "<pre>";print_r($added_date);exit;
        // $added_date['noncolligiate_updated_date'] = $noncoldate;
        // $added_date['noncolligiate_date'] = $noncoldate;
        // $added_date['NonTblId'] = $back_tabl_id;
        // $added_date['added_date'] = $date_added;
     
       // $checkFullYearPassStatus= '';
       // if($added_date['max_sem']){
             //print_r($added_date);exit;
     //   $checkFullYearPassStatus = $reval_date->checkSessionPassoutStudent($this->student_marks_details[$this->term_marks[0]][0]['student_id'], $added_date['max_sem']);
     //   if($checkFullYearPassStatus)
     //   $added_date['noncolligiate_date'] = '0000-00-00';
     //    $added_date['NonTblId'] =    '';
    //    }
 
    $revalD = date("Y-m-d", strtotime($added_date['reval_date']));
    $NonCollegiateD = $added_date['noncolligiate_date'];
    $finalDate = Date('Y-m-d', strtotime($examinationDates['result_publish_date']));
   $added_date['NonTblId'] = $examinationDates['result_publish_date'] > $NonCollegiateD ? "" :$added_date['NonTblId'];
    $added_date['RevalTblId'] = $examinationDates['result_publish_date'] > $revalD ? "" :$added_date['RevalTblId'];
   // $added_date['NonTblId'] = 314;
   //echo '<pre>';print_r($this->tabldetails); 
   //  exit;
      
                    if (!empty($added_date['NonTblId']) || !empty($added_date['RevalTblId'])) {
                        
                        if (!empty($added_date['reval_date']) && $revalD > $NonCollegiateD) {
                        
                            $followupDate = $revalD;
                            $cmnTerms = $trModel->getTermIdByTablId($added_date['RevalTblId']);
                           // echo '<pre>';print_r($cmnTerms);
                        } else {
                            $followupDate = $NonCollegiateD;
                            $cmnTerms = $trModel->getTermIdByTablId($added_date['NonTblId']);
                        }
                         
                        $this->tabldetails['term_id'] = $cmnTerms['term_id'];
                        $revalDates = $examDateModel->getRevalDatesByAcadId($academic_details['academic_year_id'], $followupDate, $this->tabldetails['term_id']);
                 
                        $dtae = Date('d-m-Y', strtotime($examinationDates['result_publish_date']));
                       
            
                        if ($revalD > $NonCollegiateD ) {
                            $revalDate = Date('d-m-Y', strtotime($revalDates['reval_date']));
                            ?>
            
                                        <tr>
                                            <th style="text-align:left">DATE&nbsp;OF&nbsp;RESULT</th>
                                            <th style="text-align:left"><?= $revalDate; ?></th>
                                            <th></th>
                                        </tr>
            
                            <?php
                        } else {
            
                            $nonPublishDate = Date('d-m-Y', strtotime($revalDates['result_publish_date']));
                            ?>
                                       
                                        <tr>
                                            <th style="text-align:left">DATE OF RESULT</th>
                                            <th style="text-align:left"><?= $nonPublishDate; ?></th>
            
                                        </tr>
            
            
                            <?php
                        }
                    } else {
            //echo '<pre>';print_r($examinationDates);exit;
            $dtae = Date('d-m-Y', strtotime($examinationDates['result_publish_date']));
             
            ?>

                        <tr>
                            <th style="text-align:left">DATE OF RESULT </th>
                            <th style="text-align:left"><?= $dtae; ?></th>
                        </tr>
        <?php } ?> 

 
   
                    <tr>
                        <th style="text-align:left"><?php if($examinationDates['stu_mark_sheet_status']=='0') { ?>DATE OF ISSUE <?php } ?></th>
                        <th style="text-align:left"><?php if($examinationDates['stu_mark_sheet_status']=='0') { ?><?=Date("d-m-Y");?> <?php } ?></th>
                        <th  style="text-align:right;padding-right:20; "><?= $stu_details['stu_id']; ?></th>
                    </tr> 
                    
    <?php 
} ?>
        </thead>
        <tbody>


            <!-----------[Important Variables]-------------->
<?php $header_component = $this->header_component[$this->term_marks[0]]; ?>

            <!-----------------[END]---------------------->
            <tr>
                <td colspan="3" style="margin:0; padding:0;">
                    <table class="tablestyle1" cellspacing="0" id='marks'>
                        <thead>
<?php if ($this->year_id) { ?>
                                <tr><?php if (!$single_pr) { ?> <th class="sub"  rowspan ="2" width="<?= $marks_width; ?>" >Semester</th> <?php } if ($single_pr) { ?>

                                        <td class="sub" rowspan ="2" width="<?= $marks_width; ?>" >Group</th>
                                <?php } ?>
                                    <th class="sub" rowspan="2" width="<?= $marks_width; ?>">Code</th>
    <?php foreach ($header_component as $component_key => $compo_val) { ?>
                                        <th class="sub"  colspan="2" width ="<?= $marks_width; ?>"><?= $compo_val['component_name']; ?></th>
                                        <?php } ?>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Total</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2">Total Marks Obtained</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Credit</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Grade Letter</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Grade Point</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Credit Point<hr/><br/>(Credit x Grade Point)</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >SGPA<br/>(Credit Point/ Credit)</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Remarks</th>

                                    <th class="sub" width ="<?= $marks_width; ?>" rowspan="2" >Final Remarks / Fail <span style="text-transform: lowercase;">in</span></th>
                                </tr>
                                <tr>
    <?php foreach ($header_component as $component_key => $compo_val) { ?>
                                        <th class="sub" width ="<?= $marks_width; ?>">Full Marks/ Pass Marks</th>
                                        <th class="sub" width ="<?= $marks_width; ?>">Marks Obtained</th>
                                    <?php } ?>
                                </tr>

                                <?php } else { ?>



                                <tr><?php if (!$single_pr) { ?> <th class="sub" width="<?= $marks_width; ?>" >Semester</th> <?php } if ($single_pr) { ?>

                                        <td class="sub"  width="<?= $marks_width; ?>" >Group</th>
    <?php } ?>
                                    <th class="sub"  width="<?= $marks_width; ?>">Course Code</th>

                                    <th class="sub" width ="<?= $marks_width; ?>"  >Full Marks</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" >Pass Marks</th>
                                    <th class="sub" width ="<?= $marks_width; ?>" > Marks Obtained</th>
                                    <th class="sub" width ="<?= $marks_width; ?>"  >Credit</th>
                                    <th class="sub" width ="<?= $marks_width; ?>"  >Grade Letter</th>
                                    <th class="sub" width ="<?= $marks_width; ?>"  >Grade Point</th>
                                    <th class="sub" width ="<?= $marks_width; ?>"  >Credit Point<hr/><br/>(Credit x Grade Point)</th>
                                    <th class="sub" width ="<?= $marks_width; ?>"  >SGPA<br/>(Credit Point/ Credit)</th>
<?php } ?>
                        </thead>
                        <tbody> 

<?php
//==========================[term_iteration_starts]===========//
$grand_total = $grand_ob_total = $grand_cr_total = $grand_gr_total = $grand_crp_total = 0;
$gr_pr = 1;

foreach ($this->term_marks as $term_index => $term_id) {

    //====chnage according to term id iterate====//
    $term_pr_id = $term_id;

    $countable_course = $course_model->getNoNcontables($term_pr_id);
   
    if(in_array($degree_id,array(8))){
            $extra_span = count($countable_course);
          //  $extra_span-- ;
            echo $extra_span;
    }
  else if(in_array($degree_id,array(2))){
            $extra_span = 1;
    }
        // if($term_id==703){
        //     echo $extra_span; die;
        // }
    $stu_marks = $this->student_marks_details[$term_pr_id];
    // if($term_id == 639){
    //     echo "<pre>";print_r($stu_marks);exit;
    // }
    $sgpa = $this->stu_sgpa[$term_pr_id];
    $details_Arr = array($this->term_marks,
        $this->stu_term_details,
        $this->stu_academic_details,
        $this->student_marks_details,
        $this->stu_course);
    $sgpa_fail_course_details = getSgpa($details_Arr, $degree_id, $term_id);
    $sgpa = $sgpa_fail_course_details['sgpa'];

    $fail_ct_id = $sgpa_fail_course_details['fail_in'];
    $prom = $this->prom[$term_pr_id];
    $term_details = $this->stu_term_details[$term_pr_id];
    $academic_details = $this->stu_academic_details[$term_pr_id];
    $session_details = new Application_Model_Session();
    $session_name = $session_details->getRecord($academic_details['session'])['session'];
    $ct_ids = $this->stu_course[$term_pr_id];

    //=============[Spans]
    $core_span = $this->corespan[$term_pr_id];

    $course_des_span = count($stu_marks);
    $grand_name = 'GRAND TOTAL';

    if (!$single_pr) {
        $grand_name = 'TOTAL';
    }
    ?>

                                <?php
                                $row_span_arr = array();
                                $non_term = $term_one = $promo_one = $sgpa_one = $course_group_arr = array();
                                $empty_cell_prin_len = count($header_component);
                                $all_total = $ob_total = $cr_total = $gr_total = $crp_total = 0;
                                $sgpa_span = $this->sgpaspan[$term_details['term_id']]['sgpa_span'];
                                
                                $span = (int) $sgpa_span + (int) $extra_span + 1;
                         
                                $tem_percent = 0;
                                $j = 1;
                                $sgfa = " ";
                                $tpfa = [];
                                ?>
                                <?php
                                foreach ($stu_marks as $marks_key => $marks_val) {

                                    if ($marks_key == 1 && in_array($term_pr_id, array(310, 314))) {
                                        $marks_val = $stu_marks[2];
                                    } else if ($marks_key == 2 && in_array($term_pr_id, array(310, 314))) {
                                        $marks_val = $stu_marks[1];
                                    }

                                    //====[student marks sheet details]============//
                                    $component_weightages = explode(',', $marks_val['component_weightages']);
                                    $component_grades = explode(',', $marks_val['component_grades']);
                                    $marks_obtained = explode(',', $marks_val['number_value']);
                                    $grade_value = explode(',', $marks_val['grade_value']);

                                    $core_course_master = new Application_Model_Corecourselearning();
                                    $course_credit_info = $core_course_master->getCoreCouseDetailByTermAcademicCourse($academic_details['academic_year_id'], $term_details['term_id'], $marks_val['course_id']);
                                    if ($course_credit_info['count_id'] == 0) {
                                        ?>
                                        <?php
                                        foreach ($ct_ids as $key => $ct_values) {
                                        //     if($term_id == 639){
                                        // echo "<pre>";print_r($ct_ids);exit;
                                        //     }
                                            $i = 1;
                                            $total = $tot_obtained = $tot_marks = 0;
                                            $pass_fail = 'P';
                                            ?>

                                            <?php
                                            foreach ($ct_values as $ct_keys => $ct_value) {
                                              
                                            // if($term_details['cmn_terms']=='t4' && $degree_id==2){
                                            //                             $extra_span = 1;
                                            //                             $span = (int) $sgpa_span + (int) $extra_span + 1; 
                                            //                         }
                                                                    
                                                //===============[for end semester exam result]===========================//
                                                if ($this->year_id) {
                                                    if ($marks_val['course_id'] == $ct_value['course_id']) {
                                                        $row_span_arr[$key] += 1;
                                                        ?>
                                                        <tr>
                                                            <!--
                                                            PRint Only one Course Group-->
                                                        <?php
                                                        if (!in_array($key, $course_group_arr)) {
                                                            $course_group_arr[] = $key;
                                                            if (!$single_pr) {
                                                                if (!in_array($sgpa, $term_one)) {
                                                                    $term_one[] = $sgpa;
                                                                    
                                                                    ?>

                                                                        <td class='sub' width="<?= $marks_width; ?>" style="width:20px !important;" rowspan="<?= $span; ?>"><?= $term_details['term_name']; ?></td>
                                                                        <?php
                                                                    }
                                                                } if ($single_pr) {
                                                                    ?>
                                                                    <td class="sub" rowspan="<?= count($ct_values) ?>" style='text-align:left;width:40% !important' > <?= $key; ?></td><?php
                                                                }
                                                            }
                                                            ?>

                                                            <!--print Course Code-->
                                                            <?php
                                                            $courseMaster = new Application_Model_Course();
                                                            $course_code = $courseMaster->getRecord($ct_value['course_id'])['course_code'];
                                                            ?>
                                                            <td class="sub" style='text-align:left; width:30px !important' ><?=$course_code; ?></td>
                                                            <!------print total component and number obtained------>
                                                            <?php for ($k = 0; $k < count($component_grades); $k++) { ?>
                                                                <?php
                                                                $tot_marks += $component_weightages[$k];
                                                                $tot_obtained += !empty($marks_obtained[$k]) ? $marks_obtained[$k] : 0;
                                                                if ($tem_percent == 0) {
                                                                    $tem_percent = $passmarks;
                                                                }
                                                                //$passmarks = $tem_percent;
//die;
                                                                if ($component_weightages[$k] == 250)
                                                                    $tem_percent = 50;
                                                                else if ($ct_value['course_id'] == 721)
                                                                    $tem_percent = 50;
                                                                ?>
                                                                <td class="sub" ><?= $component_weightages[$k] == 0 ? '--' : $component_weightages[$k] . ' / ' . ((int) $tem_percent / 100) * (int) $component_weightages[$k]; ?></td>
                                                                <?php if (!empty($grade_value[$k])) { ?>
                                                                    <td class="sub" style ='<?php if (strtolower($grade_value[$k]) == "ab" || strtolower($grade_value[$k]) == "na") echo "color:red;"; ?>'><?php
                                                                    if ((!empty($marks_obtained[$k]) || $marks_obtained[$k] == 0) && $grade_value[$k] !== 'Ab' && $grade_value[$k] !== 'NA') {
                                                                        echo $marks_obtained[$k];
                                                                        if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                                                            $pass_fail = $grade_value[$k];
                                                                            echo "*";
                                                                        }
                                                                    } else {
                                                                        echo $grade_value[$k];
                                                                        $pass_fail = $grade_value[$k];
                                                                        echo "*";
                                                                    }
                                                                    ?>

                                                                    </td>
                                                                    <?php } else { ?>
                                                                    <td class="sub">--</td>
                                <?php } ?>

                                                                <?php
                                                                $i += 1;
                                                            }
                                                            ?>
                                                            <!-- //================[print empty cell]==============//-->

                                                            <?php
                                                            if ($i < ($empty_cell_prin_len + 1)) {
                                                                for ($pr = $i; $pr <= $empty_cell_prin_len; $pr++) {
                                                                    ?>
                                                                    <td class="sub" >-- </td>
                                                                    <td class="sub" >-- </td>
                                                                    <?php
                                                                }
                                                            }
                                                            ?>


                                                            <!-------print total marks or total marks obtained----->         
                                                            <td class="sub" width ="<?= $total_width; ?>"><?= $tot_marks; ?></td>

                            <?php
                            $all_total += $tot_marks;
                            $ob_total += $tot_obtained;
                            ?>
                                                            <?php
                                                            $num = round(((int) $tot_obtained / $tot_marks) * 100);
                                                            $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
                                                            $letter_grade = $ref_grade_item->getRecordByNumGrade($num, $degree_id, $academic_details['session']);

                                                            if (in_array($pass_fail,array('NA','Ab','D','F'))) {
                                                                $pass_fail = 'F';
                                                                $letter_grade = 'F';
                                                                if($pass_fail=='D')
                                                                $letter_grade='D';
                                                            }
                                                            ?>
                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $tot_obtained; ?><?php
                                                            if (in_array($letter_grade, array('F', 'D')) || $pass_fail == "F") {
                                                                echo "*";
                                                                $sgfa = "F";
                                                                $tgpa[] = 'F';
                                                                $tpfa[] = 'F';
                                                            } else {
                                                                $sgfa = "";
                                                            }
                                                            ?></td>



                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 00; ?>  </td>


                                        <?php $cr_total += $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0; ?> 




                                                            <td  class="sub" width ="<?= $marks_width; ?>"><?= !empty($letter_grade) ?$letter_grade == 'F' || $letter_grade == 'D' ? 'F*' : $letter_grade : '--'; ; ?></td>

                            <?php
                            if (!is_numeric($letter_grade)) {

                                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();
                                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade, $degree_id, $academic_details['session']);
                                $numeric_grade = $letter_grade_result['number_grade'];
                            } else if (is_numeric($letter_grade)) {
                                $numeric_grade = $letter_grade;
                            } $total = $course_credit_info['count_id'] == 0 ? $numeric_grade * $course_credit_info['credit_value'] : 0;
                            ?>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $numeric_grade == 0 ? "--" : $numeric_grade; ?></td>
                                                            <td class="sub" width ="10px"><?= $total == 0 ? "--" : $total; ?></td>

                            <?php
                            if (!in_array($sgpa, $sgpa_one)) {
                                $sgpa_one[] = $sgpa;
                                ?>

                                                                <td  class="sub" width ="<?= $marks_width; ?>" rowspan="<?= $span; ?>">
                                                                <?php
                                                                if (empty($fail_ct_id)) {
                                                                    echo $sgpa;
                                                                } else {
                                                                    echo '--';
                                                                    $cgpaf[] = 'F';
                                                                }
                                                                ?>
                                                                </td>
                                                                <?php } ?>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $letter_grade == 'F' || $letter_grade == 'D' ? $letter_grade . '*' : $pass_fail == 'F' ? 'F*' : 'P'; ?></td>
                                                            <?php
                                                            if (!in_array($prom, $promo_one)) {
                                                                $promo_one[] = $prom;

                                                                $cour_det = new Application_Model_Course();
                                                                $fail_cts = $cour_det->getctname($fail_ct_id, $stu_details['student_id'], $term_pr_id);
                                                                if ($fail_cts) {
                                                                    ?>    
                                                                    <td class="sub" rowspan="<?= $span; ?>"><?= ($prom); ?> /<br/><?= $fail_cts; ?></td>
                                                                <?php } else { ?>
                                                                    <td class="sub" rowspan="<?= $span; ?>"><?= "$prom"; ?></td>
                                                                    <?php
                                                                }
                                                            }
                                                            ?>
                                                            <?php
                                                            $gr_total += $numeric_grade;
                                                            $crp_total += $total;
                                                            ?>
                                                        </tr>
                                                        <?php } ?>
                                                    <?php } else { ?> 

                                                    <?php
                                                    if ($marks_val['course_id'] == $ct_value['course_id']) {
                                                        $row_span_arr[$key] += 1;
                                                        ?>
                                                        <tr id = "<?= $ct_value['course_id']; ?>">
                                                            <!--
                                                            PRint Only one Course Group-->
                                                        <?php
                                                        if (!in_array($key, $course_group_arr)) {
                                                            $course_group_arr[] = $key;
                                                            if (!$single_pr) {
                                                                if (!in_array($sgpa, $term_one)) {
                                                                    $term_one[] = $sgpa;
                                                                    ?>

                                                                        <th class='sub cleandown' width="<?= $marks_width; ?>" style="width:20px !important;" rowspan="<?= $span; ?>"><?= $term_details['term_name']; ?></th>
                                                                        <?php
                                                                    }
                                                                } if ($single_pr) {
                                                                    ?>
                                                                    <td class="sub" rowspan="<?= count($ct_values) ?>" style='text-align:left;width:40% !important' > <?= $key; ?></td><?php
                                                                }
                                                            }
                                                            ?>

                                                            <!--print Course Code-->
                                                            <?php
                                                            $courseMaster = new Application_Model_Course();
                                                            $course_code = $courseMaster->getRecord($ct_value['course_id'])['course_code'];
                                                            ?>
                                                            <td class="sub" style='text-align:left; width:30px !important'  ><?= $course_code; ?></td>
                                                            <!------print total component and number obtained------>
                                                            <?php for ($k = 0; $k < count($component_grades); $k++) { ?>
                                                                <?php
                                                                $tot_marks += $component_weightages[$k];
                                                                $tot_obtained += !empty($marks_obtained[$k]) ? $marks_obtained[$k] : 0;

                                                                if ($tem_percent == 0) {
                                                                    $tem_percent = $passmarks;
                                                                }
                                                                //$passmarks = $tem_percent;

                                                                if ($component_weightages[$k] == 250) {
                                                                    $tem_percent = 50;
                                                                } else if ($ct_value['course_id'] == 721) {
                                                                    $tem_percent = 50;
                                                                } else {
                                                                    if ($degree_id == 3) {
                                                                        $tem_percent = 45;
                                                                    }
                                                                }
                                                                ?>

                                                                <?php if (!empty($grade_value[$k])) { ?>
                                                                    <?php
                                                                    if ((!empty($marks_obtained[$k]) || $marks_obtained[$k] == 0) && $grade_value[$k] !== 'Ab' && $grade_value[$k] !== 'NA') {
                                                                        if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                                                            $pass_fail = $grade_value[$k];
                                                                        }
                                                                    } else {
                                                                        $pass_fail = $grade_value[$k];
                                                                    }
                                                                    ?>

                                                                <?php } else { ?>
                                                                <?php } ?>

                                                                <?php
                                                                $i += 1;
                                                            }
                                                            ?>
                                                            <!-- //================[print empty cell]==============//-->

                                                            <?php
                                                            if ($i < ($empty_cell_prin_len + 1)) {
                                                                for ($pr = $i; $pr <= $empty_cell_prin_len; $pr++) {
                                                                    ?>
                                                                    <?php
                                                                }
                                                            }
                                                            ?>


                                                            <!-------print total marks or total marks obtained----->         
                                                            <td class="sub" width ="<?= $total_width; ?>"><?= $tot_marks; ?></td>
                                                            <td class="sub" ><?= ((int) $tem_percent / 100) * $tot_marks; ?></td>
                            <?php
                            $all_total += $tot_marks;
                            $ob_total += $tot_obtained;
                            ?>


                                                            <?php
                                                            $num = round(((int) $tot_obtained / $tot_marks) * 100);
                                                            $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
                                                            $letter_grade = $ref_grade_item->getRecordByNumGrade($num, $degree_id, $academic_details['session']);

                                                            if ($pass_fail == 'F' || $pass_fail == 'D' || $pass_fail == 'Ab' || $pass_fail == 'NA' ) {
                                                                 if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                                                $letter_grade = $pass_fail;
                                                                 }
                                                                 else{
                                                                     $letter_grade = 'F';
                                                                 }
                                                            }
                                                            ?>
                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $tot_obtained; ?><?php
                                                            if (in_array($letter_grade, array('F', 'D')) || $pass_fail == "F") {
                                                                echo "*";
                                                                $sgfa = "F";
                                                                $tpfa[] = 'F';
                                                            } else {
                                                                $sgfa = "";
                                                            }
                                                            ?></td>



                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 00; ?>  </td>


                            <?php $cr_total += $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0; ?> 



                                                            <td  class="sub" width ="<?= $marks_width; ?>"><?= !empty($letter_grade) ? $letter_grade : '--'; ?></td>

                            <?php
                            if (!is_numeric($letter_grade)) {

                                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();
                                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade, $degree_id, $academic_details['session']);
                                $numeric_grade = $letter_grade_result['number_grade'];
                            } else if (is_numeric($letter_grade)) {
                                $numeric_grade = $letter_grade;
                            } $total = $course_credit_info['count_id'] == 0 ? $numeric_grade * $course_credit_info['credit_value'] : 0;
                            ?>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?php
                                                            if ($sgfa == 'F') {
                                                                echo "--";
                                                            } else {
                                                                ?><?= $numeric_grade; ?><?php } ?></td>
                                                            <td class="sub" width ="10px"><?php
                                                                if ($sgfa == 'F') {
                                                                    echo "--";
                                                                } else {
                                                                    ?><?= $total; ?><?php } ?></td>

                                                                <?php
                                                                if (!in_array($sgpa, $sgpa_one)) {
                                                                    $sgpa_one[] = $sgpa;
                                                                    ?>

                                                                <th  class="sub" width ="<?= $marks_width; ?>" rowspan="<?= $span; ?>">
                                                                <?php
                                                                if (empty($fail_ct_id)) {
                                                                    echo $sgpa;
                                                                } else {
                                                                    echo '--';
                                                                    $cgpaf[] = 'F';
                                                                }
                                                                ?>
                                                                </th>
                                                                <?php } ?>

                                                                                                                                                                <!--<td class="sub" width ="<?= $marks_width; ?>"><?= $letter_grade == 'F' || $letter_grade == 'D' ? $letter_grade . '*' : $pass_fail == 'F' ? 'F*' : 'P'; ?></td>-->

                                                            <?php
                                                            $gr_total += $numeric_grade;
                                                            $crp_total += $total;
                                                            ?>
                                                        </tr>
                                                        <?php } ?>

                                                        <?php
                                                    }
                                                }
                                                ?>

                                        <?php } ?>
                                        <?php
                                    }
                                    $j++;
                                }
                                ?>
                                <tr></tr>
                                <!-----------Total or Grand Total --------------------->
                                <?php if ($this->year_id) { ?>
                                    <tr>

                                        <th class="sub" style='text-align:left;' ><?= $grand_name; ?></th>
                                    <?php for ($i = 0; $i < ($empty_cell_prin_len * 2); $i++) { ?>
                                            <th class="sub" ></th>
        <?php } ?>
                                        <th class="sub"  ><?= $all_total; ?></th>
                                        <th class="sub" ><?php
        if (count($tpfa) !== 0) {
            echo "--";
        } else {
            ?><?= $ob_total; ?><?php } ?></th>
                                        <th class="sub"><?= $cr_total; ?></th>
                                        <th class="sub"></th>
                                        <th class="sub" ></th>
                                        <th class="sub" ><?php
                                    if (count($tpfa) !== 0) {
                                        echo "--";
                                    } else {
                                        ?><?= $crp_total; ?><?php } ?></th>


                                            <?php if ($single_pr) { ?>
                                            <th class="sub"></th>
                                        </tr>
                                        <?php } ?>

    <?php } else { ?>
                                    <tr >
                                        <th class="sub" ><?= $grand_name; ?></th>
                                        <th class="sub" ><?= $all_total; ?></th>
                                        <th class="sub"></th>
                                        <th class="sub" ><?php
                            if (count($tpfa) !== 0) {
                                echo "--";
                            } else {
                                ?><?= $ob_total; ?><?php } ?></th>
                                        <th class="sub"><?= $cr_total; ?></th>
                                        <th class="sub"></th>
                                        <th class="sub" ></th>
                                        <th class="sub" ><?php
                                    if (count($tpfa) !== 0) {
                                        echo "--";
                                    } else {
                                        ?><?= $crp_total; ?><?php } ?></th>

                                    </tr>
                                        <?php } ?>

                                <!------[For Non countable Values]-------------------->

                                <?php
                                $sgfan = " ";
                                $tpfan = array();
                                foreach ($stu_marks as $marks_key => $marks_val) {
                                    //====[student marks sheet details]============//
                                    $component_weightages = explode(',', $marks_val['component_weightages']);
                                    $component_grades = explode(',', $marks_val['component_grades']);
                                    $marks_obtained = explode(',', $marks_val['number_value']);
                                    $grade_value = explode(',', $marks_val['grade_value']);

                                    $core_course_master = new Application_Model_Corecourselearning();
                                    $course_credit_info = $core_course_master->getCoreCouseDetailByTermAcademicCourse($academic_details['academic_year_id'], $term_details['term_id'], $marks_val['course_id']);
                                    if ($course_credit_info['count_id'] == 1) {
                                        ?>
                                        <?php
                                        foreach ($ct_ids as $key => $ct_values) {

                                            $i = 1;
                                            $total = $tot_obtained = $tot_marks = 0;
                                            $pass_fail = 'P';
                                            ?>

                                            <?php
                                            foreach ($ct_values as $ct_keys => $ct_value) {
                                                if ($this->year_id) {
                                                    if ($marks_val['course_id'] == $ct_value['course_id']) {
                                                        $row_span_arr[$key] += 1;
                                                        ?>
                                                        <tr>
                                                            <!--
                                                            PRint Only one Course Group-->
                                                        <?php
                                                        if (!in_array($key, $course_group_arr)) {
                                                            $course_group_arr[] = $key;
                                                            if (!$single_pr) {
                                                                ?>


                                                                <?php }if ($single_pr) { ?>
                                                                    <td class="sub" rowspan="<?= count($ct_values) ?>" style='text-align:left;' > <?= $key; ?></td><?php
                                }
                            }
                                                            ?>

                                                            <!--print Course Code-->

                                                            <?php
                                                            $courseMaster = new Application_Model_Course();
                                                            $course_code = $courseMaster->getRecord($ct_value['course_id'])['course_code'];
                                                            ?>
                                                           
                                                            <td class="sub" style='text-align:left;' ><?=$course_code; ?></td>


                                                            <!------print total component and number obtained------>

                            <?php for ($k = 0; $k < count($component_grades); $k++) { ?>
                                <?php
                                $tot_marks += $component_weightages[$k];
                                $tot_obtained += !empty($marks_obtained[$k]) ? $marks_obtained[$k] : 0;
                                if ($tem_percent == 0) {
                                    $tem_percent = $passmarks;
                                }
                               // $passmarks = $tem_percent;
                                if ($component_weightages[$k] == 250)
                                    $tem_percent = 50;
                                else if ($ct_value['course_id'] == 721)
                                    $tem_percent = 50;
                                ?>
                                                                <td class="sub" ><?= $component_weightages[$k] == 0 ? '--' : $component_weightages[$k] . ' / ' . ((int) $tem_percent / 100) * (int) $component_weightages[$k]; ?></td>
                                                                <?php if (!empty($grade_value[$k])) { ?>
                                                                    <td class="sub" style ='<?php if (strtolower($grade_value[$k]) == "ab" || strtolower($grade_value[$k]) == "na") echo "color:red;"; ?>'><?php
                                                                    if ((!empty($marks_obtained[$k]) || $marks_obtained[$k] == 0) && $grade_value[$k] !== 'Ab' && $grade_value[$k] !== 'NA') {
                                                                        echo $marks_obtained[$k];
                                                                        if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                                                            $pass_fail = $grade_value[$k];
                                                                            echo "*";
                                                                        }
                                                                    } else {
                                                                        echo $grade_value[$k];
                                                                        $pass_fail = $grade_value[$k];
                                                                        echo "*";
                                                                    }
                                                                    ?>
                                                                    </td>
                                                                    <?php } else { ?>
                                                                    <td class="sub">--</td>
                                                                    <?php } ?>

                                                                <?php
                                                                $i += 1;
                                                            }
                                                            ?>
                                                            <!-- //================[print empty cell]==============//-->

                                                            <?php
                                                            if ($i < ($empty_cell_prin_len + 1)) {
                                                                for ($pr = $i; $pr <= $empty_cell_prin_len; $pr++) {
                                                                    ?>
                                                                    <td class="sub" >-- </td>
                                                                    <td class="sub" >-- </td>
                                                                    <?php
                                                                }
                                                            }
                                                            ?>
                                                            <?php
                                                            $num = round(((int) $tot_obtained / $tot_marks) * 100);
                                                            $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
                                                            $letter_grade = $ref_grade_item->getRecordByNumGrade($num, $degree_id, $academic_details['session']);
                                                            if ($pass_fail == "F" || $pass_fail == "D") {
                                                                $letter_grade = $pass_fail;
                                                            }
                                                            ?>

                                                            <!-------print total marks or total marks obtained----->         
                                                            <td class="sub" width ="<?= $total_width; ?>"><?= $tot_marks; ?></td>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $tot_obtained; ?><?php
                                if (in_array($letter_grade, array('F', 'D')) || $pass_fail == "F") {
                                    echo "*";
                                    $sgfan = "F";
                                    $tpfan[] = 'F';
                                } else {
                                    $sgfan = "";
                                }
                                                            ?></td>
                                                            
                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $course_credit_info['credit_value']; ?></td>




                                                            <td  class="sub" width ="<?= $marks_width; ?>"><?= '--'; ?></td>

                            <?php
                            if (!is_numeric($letter_grade)) {

                                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();
                                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade, $degree_id, $academic_details['session']);
                                $numeric_grade = $letter_grade_result['number_grade'];
                            } else if (is_numeric($letter_grade)) {
                                $numeric_grade = $letter_grade;
                            }
                            ?>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= '--'; ?></td>
                                                            <td class="sub" width ="10px"><?= '--'; ?></td>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $letter_grade == 'F' || $letter_grade == 'D' ? $letter_grade . '*' : $pass_fail == 'F' ? 'F*' : 'P'; ?></td>
                            <?php if ($single_pr) { ?>
                                                                <td class="sub" width ="<?= $marks_width; ?>"></td>
                            <?php } ?>
                                                            <?php ?>
                                                 <!--<td class="sub" width ="<?= $marks_width; ?>"></td>-->
                                                        </tr>
                                                            <?php
                                                        }
                                                    } else {
                                                        if ($marks_val['course_id'] == $ct_value['course_id']) {
                                                            $row_span_arr[$key] += 1;
                                                            ?>
                                                        <tr>
                                                            <!--
                                                            PRint Only one Course Group   pg-->
                                                        <?php
                                                        if (!in_array($key, $course_group_arr)) {
                                                            $course_group_arr[] = $key;
                                                            if (!$single_pr) {
                                                                ?>


                                                                <?php }if ($single_pr) { ?>
                                                                    <td class="sub" rowspan="<?= count($ct_values) ?>" style='text-align:left;' > <?= $key; ?></td><?php
                                }
                            }
                                                            ?>

                                                            <!--print Course Code-->

                                                            <?php
                                                            $courseMaster = new Application_Model_Course();
                                                            $course_code = $courseMaster->getRecord($ct_value['course_id'])['course_code'];
                                                            ?>
                                                            
                                                            <td class="sub non" style='text-align:left;' ><?= $course_code; ?></td>


                                                            <!------print total component and number obtained------>

                            <?php for ($k = 0; $k < count($component_grades); $k++) { ?>
                                <?php
                                $tot_marks += $component_weightages[$k];
                                $tot_obtained += !empty($marks_obtained[$k]) ? $marks_obtained[$k] : 0;
                                if ($tem_percent == 0) {
                                    $tem_percent = $passmarks;
                                }
                                //$passmarks = $tem_percent;
                                if ($component_weightages[$k] == 250)
                                    $tem_percent = 50;
                                else if ($ct_value['course_id'] == 721)
                                    $tem_percent = 50;
                                ?>

                                                                <?php if (!empty($grade_value[$k])) { ?>
                                                                    <?php
                                                                    if ((!empty($marks_obtained[$k]) || $marks_obtained[$k] == 0) && $grade_value[$k] !== 'Ab' && $grade_value[$k] !== 'NA') {
                                                                        //   echo  $marks_obtained[$k];
                                                                        if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                                                            $pass_fail = $grade_value[$k];
                                                                        }
                                                                    } else {
                                                                        //   echo $grade_value[$k];
                                                                        $pass_fail = $grade_value[$k];
                                                                    }
                                                                    ?>

                                                                <?php } else { ?>
                                                                <?php } ?>

                                                                <?php
                                                                $i += 1;
                                                            }
                                                            ?>
                                                            <!-- //================[print empty cell]==============//-->

                                                            <?php
                                                            if ($i < ($empty_cell_prin_len + 1)) {
                                                                for ($pr = $i; $pr <= $empty_cell_prin_len; $pr++) {
                                                                    ?>
                                                                    <?php
                                                                }
                                                            }
                                                            ?>

                                                            <?php
                                                            $num = round(((int) $tot_obtained / $tot_marks) * 100);
                                                            $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
                                                            $letter_grade = $ref_grade_item->getRecordByNumGrade($num, $degree_id, $academic_details['session']);
                                                            if ($pass_fail == "F" || $pass_fail == "D") {
                                                                $pass_fail == $pass_fail;
                                                            }
                                                            ?>
                                                            <!-------print total marks or total marks obtained----->         
                                                            <td class="sub" width ="<?= $total_width; ?>"><?= $tot_marks; ?></td>
                                                            <td class="sub" ><?= ((int) $tem_percent / 100) * $tot_marks; ?></td>
                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $tot_obtained; ?><?php
                                if (in_array($letter_grade, array('F', 'D')) || $pass_fail == "F") {
                                    echo "*";
                                    $sgfan = "F";
                                    $tpfan[] = 'F';
                                } else {
                                    $sgfan = "";
                                }
                                                            ?></td>
                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= $course_credit_info['credit_value']; ?>  </td>



                                                            
                                                            <td  class="sub" width ="<?= $marks_width; ?>"><?= '--'; ?></td>

                            <?php
                            if (!is_numeric($letter_grade)) {

                                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();
                                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade, $degree_id, $academic_details['session']);
                                $numeric_grade = $letter_grade_result['number_grade'];
                            } else if (is_numeric($letter_grade)) {
                                $numeric_grade = $letter_grade;
                            }
                            ?>

                                                            <td class="sub" width ="<?= $marks_width; ?>"><?= '--'; ?></td>
                                                            <td class="sub" width ="10px"><?= '--'; ?></td>

                                                                                                                <!--<td class="sub" width ="<?= $marks_width; ?>"><?= $letter_grade == 'F' || $letter_grade == 'D' ? $letter_grade . '*' : $pass_fail == 'F' ? 'F*' : 'P'; ?></td>-->
                            <?php if ($single_pr) { ?>
                                                                <td class="sub" width ="<?= $marks_width; ?>"></td>
                            <?php } ?>
                                                            <?php ?>

                                                        </tr>
                                                            <?php
                                                        }
                                                    }
                                                }
                                                ?>

                                        <?php } ?>
                                        <?php
                                    }
                                    $j++;
                                }
                                ?>





                                <!-------this will print only for single term in ug------------------->
    <?php if ($single_pr) { ?>
                                    <!---YET TO PRINT-->
                                    <tr>
                                        <th class="sub"  style='text-align:left;' >Abbreviation Codes:</th>
                                        <th class="sub"  colspan ="<?= ($empty_cell_prin_len * 2) + 6; ?>"></th>
                                        <th class="sub"  colspan ="3" style='text-align:left;' >*To Reappear in Concerned semester. </th>
        <?php if ($single_pr) { ?>
                                            <th class="sub"></th>
        <?php } ?>
                                    </tr>



        <?php
        $sppear_semester = $course_des = 0;
        $check_course_id = array();
        // echo "<pre>";print_r($stu_marks);exit;
        $na_inc = 0;
        foreach ($stu_marks as $key => $value) {
            $courseMaster = new Application_Model_Course();
            $course_details['course_code'] = '';
            $course_details['course_name'] = '';
            $course_details1['course_code'] = '';
            $course_details1['course_name'] = '';
            if (!in_array($value['course_id'], $check_course_id)) {
                if (!empty($stu_marks[$key]['course_id']))
                    $course_details = $courseMaster->getRecord($stu_marks[$key]['course_id']);
                if (!empty($stu_marks[$key + 1]['course_id']))
                    $course_details1 = $courseMaster->getRecord($stu_marks[$key + 1]['course_id']);
                ?>
                                            <tr>
                                                <th class="sub"  style='text-align:left;'   colspan ="<?= ($empty_cell_prin_len * 2); ?>"> <?=
                                            !empty($course_details['course_code']) ? "{$course_details['course_code']} : " : '';
                                            echo $course_details['course_name'];
                                            ?></th>
                                                <th class='sub' style='text-align:left;' colspan ="<?= ($empty_cell_prin_len * 2) + 1; ?>"><?=
                                                    !empty($course_details1['course_code']) ? "{$course_details1['course_code']} : " : '';
                                                    echo $course_details1['course_name'];
                                                    ?></th>
                                                    <?php if ($na_inc == 0) { ?>
                                                    <td class="sub" colspan="3"></td>
                                                    <th class="sub">NA = Not Allowed</th>

                                                    <?php
                                                    $na_inc++;
                                                } else {
                                                    ?>
                                                    <td class="sub" colspan="4"></td>
                                                <?php } ?>
                                            </tr>
                                                <?php
                                                $check_course_id[$key] = $value['course_id'];
                                                $check_course_id[$key + 1] = $stu_marks[$key + 1]['course_id'];
                                            }
                                        }
                                        ?>
                                    <tr>
                                        <th class="sub">GRADE LETTER:</th> 

                                    <?php
                                    $grades = $ref_grade_item->getRecordByDegId($degree_id, $academic_details['session']);
                                    foreach ($grades as $grade_key => $grade_val) {
                                        if ($grade_val['letter_grade'] != 'NA' ) {
                                            ?>
                                                <td class="sub"><?= "{$grade_val['letter_grade']} = {$grade_val['des']}"; ?></td> 

                                                <?php
                                            }
                                        }
                                        ?>
                                        <th class="sub" colspan="<?= (count($grades) - 1) > 8 ? 7 - ((count($grades) - 1) - 8) : (count($grades) - 1) < 8 ? 7 + (8 - (count($grades) - 1)) : 7; ?>"></th>
                                        <th class="sub"></th>
                                    </tr>

                                    <tr>
                                        <th  colspan=17>

                                            <table class="tablestyle1"  cellspacing="0" cellpadding=0>
                                                <tbody>

        <?php if ($single_pr) { ?>
                                                        <tr>
                                                            <th class="sub" colspan ="3" >CIA : Continuous Internal Assessment</th>
                                                            <th class="sub" colspan=14>SGPA: Semester Grade Point Average</th>

                                                        </tr>

                                                        <tr>
                                                            <th class="sub"  colspan="17">
                                                                **Disclaimer: If any discrepancy is cropped up inadvertantly due to software then contact examination cell PWC for rectification
                                                            </th>
                                                        </tr>
                                                        <tr>
                                                            <td class="sub" colspan="8"><img src="<?php echo $this->mainconfig['publicpath']; ?>images/controler.jpg" height="40" width="200"  alt="..."  ></td>

                                                            <td class="sub" colspan="9"><img src="<?php echo $this->mainconfig['publicpath']; ?>images/principal.jpg" height="40" width="200"  alt="..."  ></td>
                                                        </tr>
                                                        <tr>
                                                            <th class="sub" colspan="8">Controller of Examinations</th>

                                                            <th class="sub" colspan="9">Principal</th>
                                                        </tr>
        <?php } ?>
                                                </tbody>
                                            </table>


                                        </th>
                                    </tr>

    <?php } else { ?>
        <?php
        //===============[Grand Total for al the semeseter]======//
        $grand_total += $all_total;
        $grand_ob_total += $ob_total;
        $grand_cr_total += $cr_total;
        $grand_gr_total += $gr_total;
        $grand_crp_total += $crp_total;

        $percent = ($grand_ob_total / $grand_total) * 100;
        $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
        $letter_grade = $ref_grade_item->getRecordByNumGrade1($percent, $degree_id, $academic_details['session']);
        
       

        $cgpa = $grand_crp_total / $grand_cr_total;
        ?>
                                    <?php
                                    if (count($this->term_marks) == $gr_pr) {
                                        if ($this->year_id) {
                                            ?>
                                            <tr>    

                                                <th class="sub" style='text-align:left;'><?= 'GRAND TOTAL'; ?></th>
                                            <?php for ($i = 0; $i < ($empty_cell_prin_len * 2) + 1; $i++) { ?>
                                                    <th class="sub" ></th>
                <?php } ?>
                                                <th class="sub"  ><?= $grand_total; ?></th>
                                                <th class="sub" ><?= count($tgpa) == 0 ? $grand_ob_total : '--'; ?></th>
                                                <th class="sub"><?= $grand_cr_total; ?></th>
                                                <th class="sub"></th>
                                                <th class="sub" ></th>
                                                <th class="sub" ><?= count($tgpa) == 0 ? $grand_crp_total : '--'; ?></th>
                                                <th class="sub"></th>
                                                <th class="sub"></th>
                                                <th class="sub"></th>

                                            </tr>
                                            <tr>
                                                <th colspan="6" class="sub" ><img src="<?php echo $this->mainconfig['publicpath']; ?>images/controler.jpg" alt="..." height="80" width="200" ><br/>Controller of Examinations</th>
                                                <th  colspan="6" class="sub"><img src="https://chart.googleapis.com/chart?chs=100x100&cht=qr&chl=<?= $url; ?>%2F&choe=UTF-8" title="Link to student Grade Sheet" /></th>
                                                <th  colspan="5" class="sub"><img src="<?php echo $this->mainconfig['publicpath']; ?>images/principal.jpg" alt="..." height="80" width="240"><br/>Principal</th>
                                                

                                            </tr>
                                            <tr>
                                               <th style="text-align:left" colspan=10>Abbreviation Code &nbsp; *= Fail &nbsp;&nbsp;<?php
                                              //  echo "<pre>";print_r($depert_detial);exit;
                                if ($depert_detial['degree_id']==2 || $depert_detial['degree_id']==8) {
                                    echo "/ **=Qualifying only";
                                }
                                ?></th>
                                            </tr>


            <?php } else {
                ?>


                                            <tr>    

                                                <th class="sub" style='text-align:left;'><?= 'GRAND TOTAL'; ?></th>
                                                <th class="sub" style='text-align:left;' ></th>
                                                <th class="sub"  ><?= $grand_total; ?></th>
                                                <th class="sub"></th>
                                                <th class="sub" ><?php
                            if (count($cgpaf) != 0) {
                                echo "--";
                            } else {
                                ?><?= $grand_ob_total; ?><?php } ?></th>
                                                <th class="sub"></th>
                                                <th class="sub"></th>
                                                <th class="sub" ></th>
                                                <th class="sub" ></th>
                                                <th class="sub"></th>


                                            </tr>
                                            <tr></tr>

                                            <tr>
                                                <th class="sub" style='text-align:left;' >CGPA(Credit Point/Credit)</th>

                <?php
                if (count($cgpaf) == 0) {

                   $cgpa = number_format($cgpa, 2);
                     if($academic_details['session']<7){ // #303
                    $percent = number_format(($cgpa * 9), 2);
                   }
                   else
                   $percent = number_format(($cgpa * 9.5), 2);
                    if ($degree_id == 3)
                        $percent = number_format(($cgpa * 9.25), 2);
                    else if ($degree_id > 1) {
                        $percent = number_format(($cgpa * 9.5), 2);
                    }

                    $letter_grade = $ref_grade_item->getRecordByNumGrade1($percent, $degree_id, $academic_details['session']);
                } else {
                    $cgpa = 'Pending';
                    $percent = '--';
                    $letter_grade['letter_grade'] = '--';
                    $letter_grade['des'] = '--';
                }
                ?>
                                                <th class="sub" style='text-align:left;' ></th>
                                                <th class="sub" style='text-align:left;' ></th>
                                                <th class="sub" style='text-align:left;' ></th>
                                                <th class="sub" style='text-align:left;' ></th>
                                                <th class="sub"  ><?= $grand_cr_total; ?></th>
                                                <th class="sub"  ></th>
                                                <th class="sub" ></th>
                                                <th class="sub"  ><?php
                                if (count($cgpaf) != 0) {
                                    echo "--";
                                } else {
                                    ?><?= $grand_crp_total; ?><?php } ?></th>
                                                <th class="sub" ><?php
                                                    if (count($cgpaf) != 0) {
                                                        echo "Pending";
                                                    } else {
                                                        ?><?= $cgpa; ?>(<?= $grand_crp_total; ?>/<?= $grand_cr_total; ?>)<?php } ?></th>



                                            </tr>
                                            <tr>
                <?php if ($credit_number) { ?>
                                                    <th class="sub" colspan="2" style='text-align:left;' >Total Non-Academic Credits</th>
                                                    <th class="sub" colspan="1" style='text-align:center;' ><?= $credit_number; ?></th>
                <?php } else { ?>
                                                    <th class="sub" colspan="3" style='text-align:left;' ></th>
                                                <?php } ?>
                                                <th class="sub"  colspan ="5">Grade</th>
                                                <th class="sub" colspan="2" ><?php if ($letter_grade['letter_grade'] != '--') { ?><?= $letter_grade['letter_grade']; ?>&nbsp;(<?= $letter_grade['des']; ?>)<?php
                                                } else {
                                                    echo "--";
                                                }
                                                ?></th>

                                            </tr>

                                            <tr>
                                                    <?php if ($credit_number) { ?>
                                                    <th class="sub" colspan="2" style='text-align:left;' >Earned Credits</th>
                                                    <th class="sub" colspan="1" style='text-align:center;' ><?= $stu_details['earned_credit']; ?></th>
                <?php } else { ?>
                                                    <th class="sub" colspan="3" style='text-align:left;' ></th>
                                                <?php } ?>
                                                <th class="sub" colspan="5" >Final Percentage of Marks</th>

                                                <th class="sub" colspan="2" ><?= $percent; ?><?php if ($percent != '--') { ?>%<?php } ?></th>

                                            </tr>  

                                            <tr>
                                                <th class="sub" colspan=10>
                                                    <table class="tablestyle1"  >
                                                        <tbody>

                                                            <tr>
                                                                <!--<?php //if( $session_id =='2' || $session_id =='3' || $session_id =='9' ) { ?>-->
                                                                 <th colspan="3" style="border-right:0px solid #000;font-size:18px"><img src="<?php echo $this->mainconfig['publicpath']; ?>images/controler.jpg" alt="..." height="80" width="200" ><br/>Controller of Examinations</th>
                                                              
                                                               <!-- <?php //} else  {?>-->
                                                               <!-- <th colspan="3" style="border-right:0px solid #000;font-size:18px"><img src="<?php echo $this->mainconfig['publicpath']; ?>images/controler.jpg" alt="..." height="80" width="200" ><br/>Controller of Examinations</th>-->
                                                               <!--<?php// } ?>-->
                                                                <th  colspan="3"><img src="https://chart.googleapis.com/chart?chs=100x100&cht=qr&chl=<?= $url; ?>%2F&choe=UTF-8" title="Link to student Grade Sheet" /></th>
                                                                <th  colspan="4" style="border-left:0px solid #000;font-size:18px"  ><img src="<?php echo $this->mainconfig['publicpath']; ?>images/principal.jpg" alt="..." height="80" width="240"><br/>Principal</th>
                                                            </tr>


                                                        </tbody>

                                                    </table>
                                                </th>
                                            </tr>  

                                            <tr>
                                               <th style="text-align:left" colspan=5>Abbreviation Code &nbsp; *= Fail &nbsp;&nbsp;<?php
                                              //  echo "<pre>";print_r($depert_detial);exit;
                                if ($depert_detial['degree_id']==2 || $depert_detial['degree_id']==8) {
                                    echo "/ **=Qualifying only";
                                }
                                ?></th>
                                            </tr>

                                                    <?php
                                                }
                                            }
                                        } //========[End if for single term]===========// 
                                        ?>
                                <?php
                                $gr_pr++;
                            }
                            ?>
                        </tbody>

                    </table>
                </td>
            </tr>

<?php //================[Term iteration ends]=============// ?>
        </tbody>
    </table>
</div>
</center>

</body>

</html>
<?php

function getSgpa($details_arr, $degree_id, $term_id) {
    $fail_courses = array();
    $term_pr_id = $term_id;
    $term_details = $details_arr[1][$term_pr_id];
    $academic_details = $details_arr[2][$term_pr_id];
    $stu_marks = $details_arr[3][$term_pr_id];
    $ct_ids = $details_arr[4][$term_pr_id];
    $row_span_arr = array();

    $promo_one = $sgpa_one = $term_one = $course_group_arr = array();
    $all_total = $ob_total = $cr_total = $gr_total = $crp_total = 0;
    $tem_percent = 0;
    $fcourse_code = array();
    $j = 1;
    $sgpadynamic = 0;

    foreach ($stu_marks as $marks_key => $marks_val) {
        $component_weightages = explode(',', $marks_val['component_weightages']);
        $component_grades = explode(',', $marks_val['component_grades']);
        $marks_obtained = explode(',', $marks_val['number_value']);
        $grade_value = explode(',', $marks_val['grade_value']);

        $core_course_master = new Application_Model_Corecourselearning();
        $course_credit_info = $core_course_master->getCoreCouseDetailByTermAcademicCourse($academic_details['academic_year_id'], $term_details['term_id'], $marks_val['course_id']);

        foreach ($ct_ids as $key => $ct_values) {
            $i = 1;
            $total = $tot_obtained = $tot_marks = 0;
            $pass_fail = 'P';
            foreach ($ct_values as $ct_keys => $ct_value) {

                if ($marks_val['course_id'] == $ct_value['course_id']) {
                    $row_span_arr[$key] += 1;
                    $courseMaster = new Application_Model_Course();
                    $course_code = $courseMaster->getRecord($ct_value['course_id'])['course_code'];

                    for ($k = 0; $k < count($component_grades); $k++) {

                        $tot_marks += $component_weightages[$k];
                        $tot_obtained += !empty($marks_obtained[$k]) ? $marks_obtained[$k] : 0;
                        if ($tem_percent == 0)
                            $tem_percent = $passmarks;

                      //  $passmarks = $tem_percent;

                        if ($component_weightages[$k] == 250)
                            $tem_percent = 50;

                        if (!empty($grade_value[$k])) {

                            if ((!empty($marks_obtained[$k]) || $marks_obtained[$k] == 0) && $grade_value[$k] !== 'Ab' && $grade_value[$k] !== 'NA') {

                                if ($grade_value[$k] == 'F' || $grade_value[$k] == 'D') {
                                    $pass_fail = 'F';

                                    $sgpa = 0;
                                    $fcourse_code[] = $course_code;
                                }
                            } else {
                                $fcourse_code[] = $course_code;
                                $pass_fail = 'F';
                                $sgpa = 0;
                            }
                        }


                        $i += 1;
                    }
                    $all_total += $tot_marks;
                    $ob_total += $tot_obtained;

                    if ($course_credit_info['count_id'] == 0) {
                        $cr_total += $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0;
                    }


                    $num = round(((int) $tot_obtained / $tot_marks) * 100);
                    $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();
                    $letter_grade = $ref_grade_item->getRecordByNumGrade($num, $degree_id, $academic_details['session']);
                    if ($pass_fail == 'F') {
                        $letter_grade = 'F';
                    }




                    if (!is_numeric($letter_grade)) {

                        $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();
                        $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade, $degree_id, $academic_details['session']);
                        $numeric_grade = $letter_grade_result['number_grade'];
                    } else if (is_numeric($letter_grade)) {
                        $numeric_grade = $letter_grade;
                    }
                    if ($course_credit_info['count_id'] == 0) {
                        $total = $course_credit_info['count_id'] == 0 ? $numeric_grade * $course_credit_info['credit_value'] : 0;
                        $crp_total += $total;
                    }
                    $sgpadynamic = number_format($crp_total / $cr_total, 2);
                }
            }
        }
    }
    $fail_courses = implode('/', array_unique($fcourse_code));
    $sgpadynamic = !empty(trim($fail_courses)) ? 0 : $sgpadynamic;
    $j++;

    return array("sgpa" => $sgpadynamic, "fail_in" => $fail_courses);
}
?>
<?php

function stackData($parent, $child) {
    $result = array();
    try {
        if (is_array($parent) && is_array($child)) {

            foreach ($parent as $index => $parent_value) {
                foreach ($parent_value as $parent_key => $parent_key_value) {
                    foreach ($child as $child_index => $child_value) {
                        if ($parent_key_value == $child_value[$parent_key] && array_key_exists($parent_key, $child_value)) {
                            $result[$parent_key_value][] = $child_value;
                        }
                    }
                }
            }
            return $result;
        } else {
            throw new Exception('first and second param should be of type array !');
        }
    } catch (Exception $e) {
        echo '<strong>Error Message !</strong>' . $e->getMessage();
    }
}
?>
