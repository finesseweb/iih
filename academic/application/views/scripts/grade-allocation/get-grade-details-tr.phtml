<?php$fail_Val = array('D'=>'F','F'=>'F');$item_result = $this->result;$passpercent = $this->passpercent;$acad = $this->acad;$dept_name = $this->dept_name;$ter = $this->term;//echo "<pre>";print_r($item_result);exit;//====Variable Declaration==========//$i = 1;$k = 0;$tot_credit_point = $tot_grade_point = $one_row = $stu_data_pr = $component = $weightage = 0;$EvaluationComponents_model = '';$geData = array();$geWeightage = array();$ct_arr = $weightage_arr = $component_arr = array();//======['start printing tabulation register']=======//for ($i = 0; $i < count($item_result); $i++) {    $tot_arr = array();    ?><!--[table head to be aligned into middle]----------><style>    table thead tr,th,tr,td{        max-width:40px !important;        border:.01em solid #932e90;    }   @media print{  table { page-break-after:auto !important; }  tr    { page-break-inside:avoid !important; page-break-after:auto !important; }  td    { page-break-inside:avoid !important; page-break-after:auto !important; }  thead { display:table-header-group !important;}  tfoot { display:table-footer-group !important; }}           </style>               <table class="table table-striped table-bordered mb30 jambo_table bulk_action"  border ='1' cellspacing="0" id='dataTable' style="font-size:inherit !important;"  >                <thead>                                                                                                            <tr >                <!--[COLLEGE HEADER AND LOG STUDENT IMAGE]--->                               <th class="sub" width='<?= $marks_width1; ?>' id="pwcheader">                    <pre style="font-family:'Times New Roman'; background-color: #fff !important;border:1px solid #fff;">            <span style ="font-size:1.5em; letter-spacing:.03em; font-weight:900">PATNA WOMEN'S COLLEGE</span>            <span style ="font-size:1.3em; letter-spacing:.05em; font-weight:900">AUTONOMOUS</span>            <span style ="font-size:1em; font-weight:900">PATNA UNIVERSITY</span>    3rd Cycle NAAC Accredited <span style="text-transform: lowercase;">at</span> A Grade <span style="text-transform: lowercase;">with</span> CGPA 3.58/4'College<span style="text-transform: lowercase;"> with</span> Potential <span style="text-transform: lowercase;">for</span> Excellence'(CPE) <span style="text-transform: lowercase;">status accorded by </span>UGC           <span style ="font-size:1em; font-weight:900"> BAILEY ROAD,PATNA</span> - 800 001, BIHAR                <span style ="font-size:1em; font-weight:900">                   TABULATION REGISTER                  Department : <?=$dept_name;?>                </span>            </pre>                </th>            </tr>                                                                           <tr style="padding:0">                        <input type ="hidden" id='tabl_id' value="<?=$this->id?$this->id:0;?>"/>                        <th rowspan="2">S. No.</th>                        <th rowspan="2" style="word-wrap: break-word !important;">Participants</th><!--                        <th rowspan="2">ID No.</th>-->                        <th rowspan="2" style="word-wrap: break-word !important;">Ex.Roll.No./ Reg.No</th> <!--                        <th rowspan="2">Reg. No.</th> -->                               <?php                /*                 * calling model course_corse_learning                 * if course credit has been created                 * then get the courseType value                  *                  */                $Corecourselearning_model = new Application_Model_Corecourselearning();                $course_type_result = $Corecourselearning_model->getcourseTypeOn($item_result[$i]['academic_year_id'], $item_result[$i]['term_id']);              //-------------------------------------------------------****************------------------------------------------------------------------------------------------------//                     foreach ($course_type_result as $course_type_key => $course_type_val) {//====printing upper head with component==//                     $item_result[$i]['course_id'] = $course_type_val['course_id'];                    ?>                    <th rowspan="2" style="word-wrap: break-word !important;"><?= $course_type_val['ct_name']; ?>/ course code</th><!--                    <th rowspan="2">Course Code</th>-->                    <?php if ($component == 0) { ?>                        <th class="complex" style="max-width:15px !important; word-wrap: break-word !important;">Cmp</th>                        <?php $component++;                    } ?>                    <?php                    //====================[getting all the evaluation component]======================================//                    $EvaluationComponents_model = new Application_Model_EvaluationComponents();                    $result = $EvaluationComponents_model->getAllComponentsonTerms(0, 0, $item_result[$i]['course_id']);                     foreach ($result as $k => $val) {                        ?>                       <th class="complex" ><?php echo $val['component_name']; ?></th>                        <th class="complex" style='padding: 0em;'>Rm</th>        <?php } ?>                    <th class="complex" style='padding: 0em;'>Tot.</th><!--                    <th class="complex" style='padding: 0em;'>Cr</th>                    <th class="complex" style='padding: 0em;'>G.L.</th>                    <th class="complex" style='padding: 0em;'>G.P.</th>                    <th class="complex" style='padding: 0em;'>C.Pt.</th>-->                    <th class="complex" style="word-wrap: break-word !important;"><?= $course_type_val['ct_name']; ?> Rm</th>    <?php } ?>                <th class="complex" style='padding: 0em;'>SGPA</th>                <th class="complex" style="max-width:25px !important; word-wrap: break-word !important;">Cur.Sem</th>                <th class="complex" style='padding: 0em;'>Final Rem</th>                <th class="complex" style='padding: 0em;'>Fail in</th>                </tr> <?php //==========[END Printing upper components]====================// ?>  <!-----------------------------------------------------------**************************---------------------------------------------------------------------------->                <tr>                    <?php                    //========================[Getting all the course and ge_id for the weightage]============================//                    $newData = $EvaluationComponents_model->getAllComponentsonTerms1($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], 0);                    $eval_items = new Application_Model_EvaluationComponentsItems();                    $getNewWeightage = $ct_arr = $getWeightage = array();                    //==================[Fettering Weightage according to their courses_id]=============================================]=======//                    foreach ($newData as $Studkey => $newVal) {                        $getWeightage[$newVal['ct_id']][$newVal['course_id']][$newVal['component_id']] = $newVal['weightage'];                    }                                                            //===========================[Start printing the lower head with weightage]==============================================//                    foreach ($course_type_result as $course_type_key => $course_type_val) {                        $component_arr = array();                        $item_result[$i]['course_id'] = $course_type_val['course_id'];                        //===============[Filtering according to their component id]======================//                        foreach ($getWeightage[$course_type_val['ct_id']] as $Studkey => $newVal) {                            Ksort($newVal);                            foreach ($newVal as $component_id => $weightage_val) {                                $getNewWeightage[$course_type_val['ct_id']][$component_id][] = $weightage_val;                            }                        }                                                $result = $getNewWeightage[$course_type_val['ct_id']];                        ?>                        <?php if ($weightage == 0) { ?>                            <th style="max-width:15px !important; word-wrap: break-word !important;">Wt.</th>                            <?php $weightage++;                        } ?>                        <?php $arr_check = array(); ?>                        <?php                        /*                         * this loop making single head uniqe if duplicates                          * marks and print the weightage                         *                          *                          */                        foreach ($result as $k => $val) {                            $val1 = $val;                            $val = array_unique($val);                            ?>                            <th style="max-width:15px !important; word-wrap: break-word !important;"><?php                            foreach($val as $index => $fullMks ){                                  if($fullMks==250)                                    $passpercent = 50;                               else if($fullMks==25)                                   $passpercent = 50;                                                               $passmarks = ((int)$passpercent/100)*(int)$fullMks;                                $val[$index] = $fullMks."($passmarks)";                            }?>                                                             <?php echo implode('/', $val);                                $new_arr = $val1;                                foreach ($new_arr as $weightage_key => $to_val) {                                    $tot_arr[$course_type_val['ct_id']][$weightage_key] += $to_val;                                }                                ?></th>                            <th></th>                            <?php                        }                        $total_sub_mks = array_unique($tot_arr[$course_type_val['ct_id']]);                        ?>                        <th><?= implode('/', $total_sub_mks); ?></th><!--                        <th></th>                        <th></th>                        <th></th>                        <th>(Cr. x G.P.)</th>-->                        <th></th>    <?php } ?>      <th></th>                    <th></th>                    <th></th>                    <th></th>                </tr>  <!-----------------------[End printing head]--------------------------------------------------------------------------------------------------->                </thead>                <tbody>                    <?php                                        $m = 1;                     $inde = 0;                    $corce = array();                    $course_learning = new Application_Model_ElectiveSelection();                    $StudentPortal_model = new Application_Model_StudentPortal();                //===============[Degree_id & cmn terms]==========================//                            $acd_details = new Application_Model_Academic();                        $deg_details = new Application_Model_Department();                        $d_id = $acd_details->getRecord($item_result[$i]['academic_year_id'])['department'];                        $degree_id= $deg_details->getRecord($d_id)['degree_id'];                        $term_details = new Application_Model_TermMaster();                        $cmn_term = $term_details->getRecord($item_result[$i]['term_id'])['cmn_terms'];                        $semester_rule = new Application_Model_SemesterRule();                        $details = $semester_rule->checkRow($degree_id, $cmn_term);               //========================[END]========================//                    $category_data = $StudentPortal_model->getstudentsdetails($item_result[$i]['academic_year_id']);                    foreach ($category_data as $stu_data) {                   $p_count = $appear_count = $tot_credit_point = $total_gradepoint = $one_row = $stu_data_pr = 0;                      $promotion = $pass_in_ct_id  = $fail_ct_id = $fail_in = $ge_check_arr = array();                                              ?>                                           <tr title = "<?php echo $stu_data['students']; ?>">                                                                             <?php                            foreach ($course_type_result as $course_type_key => $course_type_val) {                                $ge_id_arr = $Corecourselearning_model->getcourseTypeOn1($item_result[$i]['academic_year_id'], $item_result[$i]['term_id']);                                if ($course_type_val['ge_id'] != 0) {                                    foreach ($ge_id_arr as $ge_key => $ge_val) {                                        $item_result[$i]['course_id'] = $course_learning->getStudentSelectedElectivesOnGeId($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $stu_data['student_id'], $ge_val['ge_id'],$ge_val['course_id']);                                      //   echo "<pre>";print_r($item_result[$i]['course_id']);exit;                              if (!empty($item_result[$i]['course_id']) && !in_array($ge_val['course_id'], $ge_check_arr) && $course_type_val['ct_id']==$ge_val['ct_id']) {                                            $ge_check_arr[] = $ge_val['course_id'];                                            $prin_len = 0;                                            break;                                        } else {                                         $item_result[$i]['course_id']='';                                        }                                    }                                } else{                                          $item_result[$i]['course_id'] = $course_type_val['course_id'];                                }                                                             //   $result = $EvaluationComponents_model->getAllComponentsonTerms(0, 0, $item_result[$i]['course_id']);                            if(empty($item_result[$i]['course_id']))                                   $prin_len = 4;                                ?>                                <?php if ($stu_data_pr == 0) { ?>                                    <td><?php echo $m; ?></td>	                                    <td style=" word-wrap: break-word !important;"><?php echo $stu_data['students']; ?> / <?php echo $stu_data['stu_id']; ?></td>                   <!--                            <td><?php echo $stu_data['stu_id']; ?></td>-->                            <td style=" word-wrap: break-word !important;"><?php echo $stu_data['exam_roll']; ?>/ <?php echo $stu_data['reg_no']; ?></td><!--                            <td style="max-width:35px !important; word-wrap: break-word !important;"><?php echo $stu_data['reg_no']; ?></td>-->                            <?php $stu_data_pr++;                        }                        ?>                        <?php                          if($item_result[$i]['course_id']){                        $course_details = new Application_Model_Course();                        $course = $course_details->getRecord($item_result[$i]['course_id']);                          }                          else{                                    $course['course_name'] ='--';                                    // $course['course_code'] ='--';                           }                        ?>                    <td style="word-wrap: break-word !important;"><?php echo $course['course_name']; ?>                     <?php   if (!in_array($item_result[$i]['course_id'], $corce[$course_type_val['ct_id']])) {                            $corce[$course_type_val['ct_id']][] = $item_result[$i]['course_id'];                        } ?>/                         <?php echo $course['course_code']; ?></td>                        <?php                        ?>                        <?php if ($one_row == 0) { ?>                            <td></td>                            <?php $one_row++;                        } ?>                        <?php                        $total_divisor = $total_marks_obained = $total = 0;                        if(!empty($item_result[$i]['course_id'])){                        $component_grades = '';                        $letter_grade1 = '';                        $pass_fail = 'P';                        $pass_fail_final = 'P';                        $new_numeric = 0;                        // foreach($result as $k => $val) {                         $GradeAllocation_model = new Application_Model_GradeAllocation();                        $grade_result = $GradeAllocation_model->getGradeRecordson($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $item_result[$i]['course_id'], $stu_data['student_id']);                        $component_grades = $grade_result['component_id'];                        //$grade = $grade_result['grade_value'];                        $component_res = explode(",", $grade_result['component_id']);                        $number_result = explode(",", $grade_result['number_value']);                        $grade_result = explode(",", $grade_result['grade_value']);                        ?>                        <?php                        $comp_weightages = '';                                               foreach ($grade_result as $k => $grade_value) {                            $prin_len--;                                $pass_fail = 'P';                            // echo "<pre>";print_r($number_result);                            $style = '';                                $letter_grade='';                                        if (array_key_exists($grade_value,$fail_Val)) {                                            $style = '';                                            $pass_fail = 'F';                                            $pass_fail_final = 'F';                                                                                    } else if (strtolower($grade_value) == 'ab') {                                            $number_result[$k] = $grade_value;                                            $style = 'style="color: #ff0000"';                                            $style1 = 'style="color: #ff0000"';                                            $pass_fail = 'F';                                             $pass_fail_final = 'F';                                        } else if (strtolower($grade_value) == 'na') {                                            $number_result[$k] = 'NA';                                            $style = 'style="color: #ff0000"';                                            $pass_fail = 'F';                                             $pass_fail_final = 'F';                                        }                                        else if($number_result[$k] == ''){                                        $number_result[$k] = '--';                                        $letter_grade = '--';                                        }                                        elseif ($number_result[$k] == 0) {                                            $number_result[$k] = 0;                                        } else if (empty($grade_value)) {                                            $number_result[$k] = '--';                                            $letter_grade = '--';                                        }                            ?>                            <td <?= $style; ?>><?php echo $number_result[$k]; ?></td>                            <?php $total_marks_obained += is_numeric($number_result[$k]) ? (int) $number_result[$k] : 0; ?>                            <?php $marks_obained = is_numeric($number_result[$k]) ? (int) $number_result[$k] : 0; ?>                            <?php                                                        $EvaluationComponentsItems_model = new Application_Model_EvaluationComponentsItems();                            $comp_weigh = $EvaluationComponentsItems_model->getweightages(0, 0, $item_result[$i]['course_id'], $component_res[$k]);                            $comp_name = $comp_weigh['component_name'];                            if(in_array($comp_name,explode(',',$details[0]['component_paper']))                                    && strtolower($grade_value) != 'ab'                                     && strtolower($grade_value) != 'na'                                    && !empty($grade_value)){                                $appear_count+=1;                                                                                    }                             $comp_weightages = $comp_weightages . $comp_weigh['weightage'] . ",";                            $tot_marks = (int) $comp_weigh['weightage'];                            $total_divisor += (int) $tot_marks;                      if($letter_grade == '--'){                                $letter_grade = '--';                            }                            elseif ($tot_marks != 0 && $marks_obained > 0) {                                                                $letter_grade = $pass_fail;                            }                                                         elseif ($tot_marks == 0) {                                $letter_grade = '--';                            } elseif ($marks_obained == 0) {                                $letter_grade = 'F';                                $pass_fail = 'F';                                 $pass_fail_final = 'F';                            }                            ?>                            <?php if(count($grade_result) == 1 && empty($grade_result[0])){                                 $prin_len = 2;                            for ($o = 0; $o < $prin_len; $o++) { ?>                            <td>--</td>                            <td>--</td>                            <?php } } ?>                                                        <td <?php                             if($total_marks_obained == 0){                                $pass_fail = '--';                            }                if (strtolower($letter_grade) == 'f') {                    $pass_fail='F';                     $pass_fail_final = 'F';                    echo 'style="color: #ff0000; font-weight:bolder"';                }                            ?>><?= $letter_grade; ?> </td>            <?php }                         } else{                            $total_marks_obained = '--';            for ($o = 0; $o < $prin_len; $o++) { ?>                            <td>--</td>                            <td>--</td>            <?php                             }      }            ?>                                                 <td><?= $total_marks_obained; ?></td>            <?php            if($item_result[$i]['course_id']){            // total credit value             $core_course_master = new Application_Model_Corecourselearning();            $course_credit_info = $core_course_master->getCoreCouseDetailByTermAcademicCourse($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $item_result[$i]['course_id']);            //  echo "<pre>";print_r($course_credit_info);exit;            ?>                                                  <?php                        //==========[Add all the credit point of all the coure of student simply]                        $tot_credit_point += (double) ($course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0);                                                ?><!--       credit point                 <td><?= $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0; ?></td>-->            <?php            //letter grade            $total_marks_obained = $total_marks_obained != 0 ? $total_marks_obained : '--';            $tot_marks = $tot_arr[$course_type_val['ct_id']][array_keys($corce[$course_type_val['ct_id']], $item_result[$i]['course_id'], true)[0]];            if (!empty($total_divisor)) {                if($total_marks_obained != '--' ){                $num = round(((int)$total_marks_obained / $total_divisor) * 100);                $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();                 $letter_grade = $ref_grade_item->getRecordByNumGrade($num,$degree_id);                $letter_grade = strtolower($letter_grade) == 'd'?'F':$letter_grade;                }                else {                    $letter_grade = 'F';                }            } else {                $letter_grade = 'F';                $pass_fail='F';                 $pass_fail_final = 'F';            }            ?><!--       grade letter                 <td <?php                        if (strtolower($letter_grade) == 'f') {                                                                                    echo 'style="color: #ff0000; font-weight:bolder"';                            $pass_fail = 'F';                             $pass_fail_final = 'F';                                                    }                                                                                                $pass_fail =  $letter_grade == 'F' ? 'F' : 'P';            ?>><?=$pass_fail;?></td>-->                                                              <?php            //grade point            $pass_fail = $pass_fail_final;            if (!is_numeric($letter_grade) && !empty($letter_grade)) {                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade,$degree_id);                $numeric_grade = $letter_grade_result['number_grade'];            } else if (is_numeric($letter_grade)) {                $numeric_grade = $letter_grade;            } $total = $course_credit_info['count_id'] == 0 ? $numeric_grade * $course_credit_info['credit_value'] : 0;            }                        ?><!--      Grade Point                  <td><?=empty($numeric_grade)?0:$numeric_grade;?></td>-->            <?php            //======[Adding all the grade point of all the core of same student];            $total_gradepoint += $total;            ?><!--   total credit point                     <td><?php echo number_format($total, 0); ?></td>-->                        <td <?php            if (strtolower($pass_fail) == 'f' ) {                if(!empty($item_result[$i]['course_id'])){                    $fail_in[] = $course_type_val['ct_name'];                    $fail_ct_id[] = $course_type_val['ct_id'];                     }                echo 'style="color: #ff0000; font-weight:bolder"';                           }else if(strtolower($pass_fail) == 'p'){                    if(!empty($item_result[$i]['course_id']))                    $pass_in_ct_id[] = $course_type_val['ct_id'];                }            ?>><?= $pass_fail; ?></td>                                                   <?php }$sgpa = ($total_gradepoint / $tot_credit_point) ?>                                                                       <?php //==================[Promotion Rules]=====================//                                                      $final_remarks = 'P';                               if($details[0]['credit_score']<=round(number_format($sgpa, 2)*10)                                    && $details[0]['semester_paper_count'] <= count(array_unique($pass_in_ct_id))                                   && $details[0]['appeared_paper'] <= $appear_count){                                   $term_name = $term_details->getAcademicTermIdAction($item_result[$i]['academic_year_id'],$cmn_term);                                   $promotion = "Promoted to $term_name";                               }                           else {                                    $final_remarks ='F';                                    $promotion = "--";                                }                       ?>                                                                    <td><?= number_format($sgpa, 2); ?></td>                    <td style="max-width:25px !important; word-wrap: break-word !important;"><?=$promotion;?></td>                    <td <?php if (strtolower($final_remarks) == 'f') {                echo 'style="color: #ff0000; font-weight:bolder"';            }?>><?=$final_remarks?></td>                    <td style="word-wrap: break-word !important;"><?=implode('/', array_unique($fail_in)); ?></td>                            </tr>          <?php $m++; ?>            <?php }    ?>	                </tbody>                <tfoot>                <th style="vertical-align: bottom;border:0;">Tabulator</th>                <th style="vertical-align: bottom;border:0;">Controller of Examinations</th>                <th style="vertical-align: bottom;border:0;">Principal</th>                                    </tfoot>            </table>            <?php}function selectData($array, $fieldname, $number = 0) {    try {        $filterd_value = array();        if (is_array($array) && is_array($fieldname)) {            for ($i = 0; $i < $number; $i++) {                foreach ($fieldname as $field_key => $field_value) {                    $filterd_value[$i][$field_value] = $array[$i][$field_value];                }            }            return $filterd_value;        } else {            throw new Exception('first and second param should be of type array !');        }    } catch (Exception $e) {        echo '<strong>Error Message !</strong>' . $e->getMessage();    }}?>   <script src="<?php echo $this->mainconfig['publicpath']; ?>js/jquery-1.12.2.min.js"></script>     <script>        var colspan = parseInt($('thead>tr>th').length/2);    $('#pwcheader').attr('colspan',colspan+3);        $('tfoot th').attr('colspan',Math.round((colspan)/2)-5);    $('tfoot th').height('100px');        </script>