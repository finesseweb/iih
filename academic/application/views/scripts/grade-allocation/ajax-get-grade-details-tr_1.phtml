<?php$item_result = $this->result;//echo "<pre>";print_r($item_result);exit;//====Variable Declaration==========//$i = 1;$k = 0;$tot_credit_point = $tot_grade_point = $one_row = $stu_data_pr = $component = $weightage = 0;$EvaluationComponents_model = '';$geData = array();$geWeightage = array();$ct_arr = $weightage_arr = $component_arr = array();//======['start printing tabulation register']=======//for ($i = 0; $i < count($item_result); $i++) {    $tot_arr = array();    ?><!--[table head to be aligned into middle]---------->    <style>        .table>caption+thead>tr:first-child>td, .table>caption+thead>tr:first-child>th, .table>colgroup+thead>tr:first-child>td, .table>colgroup+thead>tr:first-child>th, .table>thead:first-child>tr:first-child>td, .table>thead:first-child>tr:first-child>th {            border-top: 0;            vertical-align: middle !important;        }        .table-bordered>thead>tr>td, .table-bordered>thead>tr>th {            border-bottom-width: 2px;            vertical-align: middle !important;        }    </style>    <div class="box-body table-responsive">        <div style="overflow-x:scroll">            <table class="table table-striped table-bordered mb30 jambo_table bulk_action" id='dataTable' style="height:20em;" >                <thead>                    <tr>                        <th rowspan="2">S. No.</th>                        <th rowspan="2">Name of Participants</th>                        <th rowspan="2">ID Number</th>                        <th rowspan="2">Exam Roll No</th>                 <input type ="text"  name ="academic_id[]" style="display:none;" value ="<?= $item_result[$i]['academic_year_id']; ?>_<?= $item_result[$i]['term_id']; ?>"/>                <?php                /*                 * calling model course_corse_learning                 * if course credit has been created                 * then get the courseType value                  *                  */                $Corecourselearning_model = new Application_Model_Corecourselearning();                $course_type_result = $Corecourselearning_model->getcourseTypeOn($item_result[$i]['academic_year_id'], $item_result[$i]['term_id']);              //-------------------------------------------------------****************------------------------------------------------------------------------------------------------//                                foreach ($course_type_result as $course_type_key => $course_type_val) {//====printing upper head with component==//                     $item_result[$i]['course_id'] = $course_type_val['course_id'];                    ?>                    <th rowspan="2"><?= $course_type_val['ct_name']; ?></th>                    <th rowspan="2">Course Code</th>                    <?php if ($component == 0) { ?>                        <th>Component</th>                        <?php $component++;                    } ?>                    <?php                    //====================[getting all the evaluation component]======================================//                    $EvaluationComponents_model = new Application_Model_EvaluationComponents();                    $result = $EvaluationComponents_model->getAllComponentsonTerms(0, 0, $item_result[$i]['course_id']);                                        foreach ($result as $k => $val) {                        ?>                        <th><?php echo $val['component_name']; ?></th>                        <th>Rem</th>        <?php } ?>                    <th>Total</th>                    <th>credit</th>                    <th>Grade Letter</th>                    <th>Grade Point</th>                    <th>Credit Point</th>                    <th><?= $course_type_val['ct_name']; ?> Rem</th>    <?php } ?>                <th>SGPA</th>                <th>Current Semester</th>                <th>Final Remarks</th>                <th>Fail in</th>                </tr> <?php //==========[END Printing upper components]====================// ?>  <!-----------------------------------------------------------**************************---------------------------------------------------------------------------->                <tr>                    <?php                    //========================[Getting all the course and ge_id for the weightage]============================//                    $newData = $EvaluationComponents_model->getAllComponentsonTerms1($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], 0);                    $eval_items = new Application_Model_EvaluationComponentsItems();                    $getNewWeightage = $ct_arr = $getWeightage = array();                    //==================[Fettering Weightage according to their courses_id]=============================================]=======//                    foreach ($newData as $Studkey => $newVal) {                        $getWeightage[$newVal['ct_id']][$newVal['course_id']][$newVal['component_id']] = $newVal['weightage'];                    }                                                            //===========================[Start printing the lower head with weightage]==============================================//                    foreach ($course_type_result as $course_type_key => $course_type_val) {                        $component_arr = array();                        $item_result[$i]['course_id'] = $course_type_val['course_id'];                        //===============[Filtering according to their component id]======================//                        foreach ($getWeightage[$course_type_val['ct_id']] as $Studkey => $newVal) {                            Ksort($newVal);                            foreach ($newVal as $component_id => $weightage_val) {                                $getNewWeightage[$course_type_val['ct_id']][$component_id][] = $weightage_val;                            }                        }                                                $result = $getNewWeightage[$course_type_val['ct_id']];                        ?>                        <?php if ($weightage == 0) { ?>                            <th>Weightage</th>                            <?php $weightage++;                        } ?>                        <?php $arr_check = array(); ?>                        <?php                        /*                         * this loop making single head uniqe if duplicates                          * marks and print the weightage                         *                          *                          */                        foreach ($result as $k => $val) {                            $val = array_unique($val);                            ?>                            <th><?php                                echo implode('/', $val);                                $new_arr = $val;                                foreach ($new_arr as $weightage_key => $to_val) {                                    $tot_arr[$course_type_val['ct_id']][$weightage_key] += $to_val;                                }                                ?></th>                            <th></th>                            <?php                        }                        $total_sub_mks = array_unique($tot_arr[$course_type_val['ct_id']]);                        ?>                        <th><?= implode('/', $total_sub_mks); ?></th>                        <th></th>                        <th></th>                        <th></th>                        <th>(Credit x Grade Point)</th>                        <th></th>    <?php } ?>                    <th></th>                    <th></th>                    <th></th>                    <th></th>                </tr>  <!-----------------------[End printing head]--------------------------------------------------------------------------------------------------->                </thead>                <tbody>                    <?php                    $m = 1;                    $inde = 0;                    $corce = array();                    $course_learning = new Application_Model_ElectiveSelection();                    $StudentPortal_model = new Application_Model_StudentPortal();                    $category_data = $StudentPortal_model->getstudentsdetails($item_result[$i]['academic_year_id']);                  //  echo "<pre>"; print_r($category_data);exit;                    foreach ($category_data as $stu_data) {                        $tot_credit_point = $total_gradepoint = $one_row = $stu_data_pr = 0;                       $fail_ct_id = $fail_in = $ge_check_arr = array();                        ?>                                            <tr title = "<?php echo $stu_data['students']; ?>">                            <input type='text' style="display:none;" name='stu_ids[]' value="<?=$stu_data['student_id'];?>" />                            <?php                            foreach ($course_type_result as $course_type_key => $course_type_val) {                                $ge_id_arr = $Corecourselearning_model->getcourseTypeOn1($item_result[$i]['academic_year_id'], $item_result[$i]['term_id']);                                    //echo "<pre>";print_r($ge_id_arr);exit;                                if ($course_type_val['ge_id'] != 0) {                                    foreach ($ge_id_arr as $ge_key => $ge_val) {                                                                                $item_result[$i]['course_id'] = $course_learning->getStudentSelectedElectivesOnGeId($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $stu_data['student_id'], $ge_val['ge_id'],$ge_val['course_id']);                                        if (!empty($item_result[$i]['course_id']) && !in_array($ge_val['course_id'], $ge_check_arr)) {                                            $ge_check_arr[] = $ge_val['course_id'];                                            break;                                        }                                    }                                } else {                                    $item_result[$i]['course_id'] = $course_type_val['course_id'];                                }                                $result = $EvaluationComponents_model->getAllComponentsonTerms(0, 0, $item_result[$i]['course_id']);                                $prin_len = count($result);                                ?>                                <?php if ($stu_data_pr == 0) { ?>                                    <td><?php echo $m; ?></td>	                                    <td><?php echo $stu_data['students']; ?></td>                            <input type='text' style="display:none;"  name="grade[student_id_<?= $stu_data['student_id'].$item_result[$i]['academic_year_id']; ?>_<?php echo $item_result[$i]['term_id']; ?>_<?php echo $item_result[$i]['course_id']; ?>][]" id="student_id" value="<?php echo $stu_data['student_id']; ?>" />                            <td><?php echo $stu_data['stu_id']; ?></td>                            <td><?php echo $stu_data['exam_roll']; ?></td>                            <?php $stu_data_pr++;                        }                        ?>                        <?php                        $course_details = new Application_Model_Course();                        $course = $course_details->getRecord($item_result[$i]['course_id']);                        ?>                        <td><?php echo $course['course_name'];            if (!in_array($item_result[$i]['course_id'], $corce[$course_type_val['ct_id']])) {                $corce[$course_type_val['ct_id']][] = $item_result[$i]['course_id'];            } ?></td>                        <td><?php echo $course['course_code']; ?></td>                        <?php                        ?>                        <?php if ($one_row == 0) { ?>                            <td></td>                            <?php $one_row++;                        } ?>                        <?php                        $component_grades = '';                        $pass_fail = 'P';                        // foreach($result as $k => $val) {                         $GradeAllocation_model = new Application_Model_GradeAllocation();                        $grade_result = $GradeAllocation_model->getGradeRecordson($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $item_result[$i]['course_id'], $stu_data['student_id']);                        $component_grades = $grade_result['component_id'];                        //$grade = $grade_result['grade_value'];                        $component_res = explode(",", $grade_result['component_id']);                        $number_result = explode(",", $grade_result['number_value']);                        $grade_result = explode(",", $grade_result['grade_value']);                        $total_divisor = $total_marks_obained = $total = 0;                        ?>                        <?php                        $comp_weightages = '';                        // echo "<pre>";print_r($grade_result);                        foreach ($grade_result as $k => $grade_value) {                            $prin_len--;                            // echo "<pre>";print_r($number_result);                            $style = '';                            if (strtolower($grade_value) == 'f') {                                $style = '';                                $pass_fail = 'F';                            } else if (strtolower($grade_value) == 'ab') {                                $number_result[$k] = $grade_value;                                $style = 'style="color: #ff0000"';                                $style1 = 'style="color: #ff0000"';                                $pass_fail = 'F';                            } else if (strtolower($grade_value) == 'na') {                                $number_result[$k] = 'NA';                                $style = 'style="color: #ff0000"';                                $pass_fail = 'F';                            }                            else if($number_result[$k] == ''){                            $number_result[$k] = '--';                            $letter_grade = '--';                            }                            elseif ($number_result[$k] == 0) {                                $number_result[$k] = 0;                            } else if (empty($grade_value)) {                                $number_result[$k] = '--';                                $letter_grade = '--';                            }                            ?>                            <td <?= $style; ?>><?php echo $number_result[$k]; ?></td>                            <?php $total_marks_obained += is_numeric($number_result[$k]) ? (int) $number_result[$k] : 0; ?>                            <?php $marks_obained = is_numeric($number_result[$k]) ? (int) $number_result[$k] : 1; ?>                            <?php                                                        $EvaluationComponentsItems_model = new Application_Model_EvaluationComponentsItems();                            $comp_weigh = $EvaluationComponentsItems_model->getweightages(0, 0, $item_result[$i]['course_id'], $component_res[$k]);                            $comp_weightages = $comp_weightages . $comp_weigh['weightage'] . ",";                            $tot_marks = (int) $comp_weigh['weightage'];                            $total_divisor += (int) $tot_marks;                      if($letter_grade == '--'){                                $letter_grade = '--';                            }                            elseif ($tot_marks != 0 && $marks_obained > 0) {                                $num = round(((int) $marks_obained / $tot_marks) * 100);                                $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();                                $letter_grade = $ref_grade_item->getRecordByNumGrade($num);                                $letter_grade = $letter_grade == 'F' ? 'F' : 'P';                            }                                                         elseif ($tot_marks == 0) {                                $letter_grade = '--';                            } elseif ($marks_obained == 0) {                                $letter_grade = 'F';                                $pass_fail = 'F';                            }                            ?>                            <td <?php                if (strtolower($letter_grade) == 'f') {                    $fail_in[] = $course_type_val['ct_name'];                    $fail_ct_id[] = $course_type_val['ct_id'];                    echo 'style="color: #ff0000; font-weight:bolder"';                }                            ?>><?= $letter_grade; ?> </td>            <?php } for ($o = 0; $o < $prin_len; $o++) { ?>                            <td>--</td>                            <td>--</td>            <?php }            ?>                            <input type='text' style="display:none;" name="course_ids[]" value ="<?=$item_result[$i]['course_id'];?>" />                        <input type='text' style="display:none;"   name="grade[weightages_<?= $stu_data['student_id'].$item_result[$i]['academic_year_id']; ?>_<?php echo $item_result[$i]['term_id']; ?>_<?php echo $item_result[$i]['course_id']; ?>][]" value="<?php echo $comp_weightages; ?>" />                        <input type='text' style="display:none;"   name="grade[grades_<?= $stu_data['student_id'].$item_result[$i]['academic_year_id']; ?>_<?php echo $item_result[$i]['term_id']; ?>_<?php echo $item_result[$i]['course_id'] ?>][]" value="<?php echo $component_grades; ?>" />                        <td><?= number_format($total_marks_obained, 0); ?></td>            <?php            // total credit value             $core_course_master = new Application_Model_Corecourselearning();            $course_credit_info = $core_course_master->getCoreCouseDetailByTermAcademicCourse($item_result[$i]['academic_year_id'], $item_result[$i]['term_id'], $item_result[$i]['course_id']);            //  echo "<pre>";print_r($course_credit_info);exit;            ?>                                                  <?php                        //==========[Add all the credit point of all the coure of student simply]                        $tot_credit_point += (double) ($course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0);                        ?>                        <td><?= $course_credit_info['count_id'] == 0 ? $course_credit_info['credit_value'] : 0; ?></td>            <?php            //letter grade            $total_marks_obained = $total_marks_obained != 0 ? $total_marks_obained : 1;            $tot_marks = $tot_arr[$course_type_val['ct_id']][array_keys($corce[$course_type_val['ct_id']], $item_result[$i]['course_id'], true)[0]];            if (!empty($total_divisor)) {                $num = round(((int) $total_marks_obained / $total_divisor) * 100);                $ref_grade_item = new Application_Model_ReferenceGradeMasterItems();                $letter_grade = $ref_grade_item->getRecordByNumGrade($num);            } else {                $letter_grade = 'F';            }            ?>                        <td <?php                        if (strtolower($letter_grade) == 'f') {                            echo 'style="color: #ff0000; font-weight:bolder"';                        }                        ?>><?= $letter_grade == 'F' ? 'F' : 'P'; ?></td>            <?php            //grade point            if (!is_numeric($letter_grade) && !empty($letter_grade)) {                $ReferenceGradeMaster_model = new Application_Model_ReferenceGradeMaster();                $letter_grade_result = $ReferenceGradeMaster_model->getNumberGradeValue(0, $letter_grade);                $numeric_grade = $letter_grade_result['number_grade'];            } else if (is_numeric($letter_grade)) {                $numeric_grade = $letter_grade;            } $total = $course_credit_info['count_id'] == 0 ? $numeric_grade * $course_credit_info['credit_value'] : 0;            ?>                        <td><?= $numeric_grade; ?></td>            <?php            //======[Adding all the grade point of all the core of same student];            $total_gradepoint += $total;            ?>                        <td><?php echo number_format($total, 0); ?></td>                        <td <?php            if (strtolower($pass_fail) == 'f') {                echo 'style="color: #ff0000; font-weight:bolder"';            }            ?>><?= $pass_fail; ?></td>                        <input type='text' style="display:none;"  name="grade[grade_point_<?= $stu_data['student_id'].$item_result[$i]['academic_year_id']; ?>_<?php echo $item_result[$i]['term_id']; ?>_<?php echo $item_result[$i]['course_id']; ?>][]" value="<?php $tot = number_format($total, 2);            echo $tot;            ?>" />                           <?php }$sgpa = ($total_gradepoint / $tot_credit_point) ?>                    <td><?= number_format($sgpa, 2); ?></td>                    <td></td>                    <td></td>                    <td><?=implode('/', $fail_in); ?></td>        <input type='text' style="display:none;"  name="fail_in[]" value="<?=implode(',',$fail_ct_id) ;?>" />        <input type='text' style="display:none;"  name="sgpa[]" value="<?=$sgpa;?>" />        <input type='text' style="display:none;"  name="tot_credit_point[]" value="<?=$tot_credit_point;?>" />        <input type='text' style="display:none;"  name="tot_grade_point[]" value="<?=$total_gradepoint;?>" />                    </tr>          <?php $m++; ?>                                           <?php }    ?>	                </tbody>            </table>        </div>    </div>    <div id="addmore_items_<?php echo $i; ?>"></div>    <br>    <?php}function selectData($array, $fieldname, $number = 0) {    try {        $filterd_value = array();        if (is_array($array) && is_array($fieldname)) {            for ($i = 0; $i < $number; $i++) {                foreach ($fieldname as $field_key => $field_value) {                    $filterd_value[$i][$field_value] = $array[$i][$field_value];                }            }            return $filterd_value;        } else {            throw new Exception('first and second param should be of type array !');        }    } catch (Exception $e) {        echo '<strong>Error Message !</strong>' . $e->getMessage();    }}?><script>    $('table').each(function () {        var check_val = $(this).find('thead>tr:nth-child(2)>th:nth-child(1)').text();        if (check_val.toLowerCase() != 'weightage') {            $(this).prev().attr('style', 'display:none');            $(this).removeAttr('id');            $(this).attr('style', 'display:none');        }    });    $('<div class="row" id="moved-buttons" style="margin-top:1em; margin-right:.09em;"></div>').appendTo('#datatable-responsive_filter')    $('div[class="dt-buttons btn-group"]').appendTo('#moved-buttons');    modifiedDataTable(true,true,true);/*var id = '<?=$this->id?$this->id:0;?>';if(id){$('button').hide();   $('<div class="col-sm-12 text-center"><h4 class="text-danger"><strong>**Published TABULATION REGISTER Cannot be Modified.<br><small class="text-danger"><b>(Note:</b>&nbsp; Course Listed only with Created Evaluation Components.<b>)</b></small></strong></h4></div>').insertBefore('table');}else{   $('button').show(); }*///$('table').removeAttr('class');//$('table').addAttr('class','table table-striped table-bordered mb30 jambo_table bulk_action dataTable no-footer');</script>