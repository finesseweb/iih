<style>

    @media print {

                    table td:nth-child(5)

                     {

                         display:none;

                     }

                     table th:nth-child(5)

                     {

                         display:none;

                     }

                      *{

                        visibility:hidden;

                     }

                     table,th,td 

                     {

                         visibility:visible;                    

                     } 

                     .title1

                     {

                        visibility:visible; 

                     }

                }
                #academic_year_id_chosen{
                    display:none;
                }

</style>
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<div class="right_col">

<?php if ($this->type) { ?>

<div class="padding-md">

	<div class="row">

		 <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <h3 class="page-title txt-color-blueDark">
                    <i class="fa fa-bars">Electives Selection</i>

                </h3>
            </div>
           
        </div>
                    
                    <div class="row">
                <div class="pull-right col-xs-2 col-sm-2 col-md-2 col-lg-2"><div class="pull-right"><span class="pull-left" style="margin-right:.3em;margin-top: .5em"><small><b>Academics</b></small></span><input type="checkbox" id='unselect' value="0"   data-toggle="toggle" data-size="sm"></div></div>
                </div>

			<div class="panel panel-default">

				<form class="no-margin" id="formValidate1" action="<?php echo $this->form->getAction() ?>" method="post" data-validate="parsley" >
                    <div class='panel-header'>
                                </div>
					<div class="panel-body">

					<div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                              <label class="control-label">Academic Year<span class="asterisk">*</span></label>
                                <?php echo $this->form->academic_year; ?>
                            </div>
                        </div>	
                        <div class="col-sm-3">
                            <div class="form-group">
                              <label class="control-label">Session<span class="asterisk">*</span></label>
                                <?php echo $this->form->session; ?>
                            </div>
                            <?php echo $this->form->csrftoken; ?> 
                        </div>	
                            <div class="col-sm-3">
                            <div class="form-group">
                              <label class="control-label">Degree<span class="asterisk">*</span></label>
                                <?php echo $this->form->degree_id; ?>
                            </div>
							</div>	

						<div class="col-sm-6">

                            <div class="form-group">

                              <label class="control-label">Batch<span class="asterisk">*</span></label>

                                <?php echo $this->form->academic_year_id; ?>

                            </div>

							</div>	
                                           
							</div>

							<div class="row">
                                                               
                                                             <div class="col-sm-3">

							<div class="form-group">

							<label class="control-label">Term<span class="asterisk">*</span></label>

							<?php echo $this->form->term_id; ?>

							</div>

							</div>

							<div class="col-sm-3">
							<div class="form-group">
							<label class="control-label">Courses<span class="asterisk">*</span></label>
							<?php echo $this->form->course_id; ?>
							</div>
							</div>
							<div class="col-sm-3">
							<div class="form-group">
							<label class="control-label">Next Term<span class="asterisk">*</span></label>
							<?php echo $this->form->term_id2; ?>
							</div>
							</div>
							<div class="col-sm-3">
							<div class="form-group">
							<label class="control-label">Next Courses<span class="asterisk">*</span></label>
							<?php echo $this->form->course_id2; ?>
							</div>
							</div>
                                                         
					</div>
					<div class="row">

					 <div class="col-sm-10">

					<div class="form-group">
						<label class="control-label" >Students</label>
                                                <select class="form-control select2" name='selected_students[]'  required="required" id= 'selected_student' multiple="multiple">
                                                    
                                                    </select>
						</div>

					</div>
					<div class="col-sm-2">
						<div class="form-group">
						<button type="button" class="btn btn-info btn-lg" style="margin-top:9%" data-toggle="modal" data-target="#myModal">Filter <span class="glyphicon glyphicon-filter"></span></button>
						</div>
                    </div>
<!-- Modal -->
                    <div id="myModal" class="modal fade" role="dialog">
                      <div class="modal-dialog">
                    
                        <!-- Modal content-->
                        <div class="modal-content">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Form Id's<br/><small style="color:red;">(Paste or write multiple Form ids here.)</small></h4>
                          </div>
                          <div class="modal-body">
                              <div class="form-group">
                    						<label class="control-label" >Form Id's</label>
                            <textarea class="form-control" rows="5" id="comment"></textarea>
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-info" id="stu_id_submit" data-dismiss="modal">Submit</button>
                          </div>
                        </div>
                    
                      </div>
                    </div>
					</div>
					<div class="" id="electives">

					</div>

				

			</div>



			<div class="panel-footer">									

							<div class="row">

								<div class="col-sm-7 col-sm-offset-5">

									<?php if ($this->type == 'add') { ?> 

										<div style="float:left;margin-right:2px;">

										<button class="btn btn-primary submit">Submit</button>

										</div>

										<div style="float:left;padding:0px 10px;">

										<button type="reset" class="btn btn-danger btn-default">Reset</button>

										</div>

									<?php } else { ?>

										<div style="float:left;">

										<button class="btn btn-primary submit">Update</button>

										</div>

										<div style="float:left;">

										<a class="btn btn-primary" href="<?php echo $this->mainconfig['host']; ?>elective/selection">Back</a>

										</div>

									<?php } ?>

								</div>

							</div>

						</div>

					</div>

				</form>

	

			</div><!-- /panel -->

		</div><!-- /.col-->				

	</div><!-- /.row -->

	

<!-- /.padding-md -->	

<?php } else { ?>

  

<?php if (count($this->messages))   { 

    foreach ($this->messages as $message) {?>

     <div class="alert <?php echo $_SESSION['message_class']; ?>">

<a type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</a>

<?php echo $this->escape($message); ?>

</div>

 <?php } } ?>

 <!-- widget grid -->

<div class="">

	<div class="">

		<div class="row">

			

			<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">

		<h3 class="page-title txt-color-blueDark">

			<i class="fa fa-bars"> Electives Selection</i>

				

		</h3>

	</div>

			

		<div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">	 

			

			<a class="btn btn-primary pull-right" style="margin-top: 25px;" href="<?php echo $this->mainconfig['host']; ?>elective/selection/type/add">Add </a>

		</div>

		</div>

		

		<div class="x_panel">

               

                    <div class="x_title">

                        <div class="col-sm-3">
                            <div class="form-group">
                              <label class="control-label">Academic Year<span class="asterisk">*</span></label>
                                <?php echo $this->form->academic_year; ?>
                            </div>
                        </div>	
                        <div class="col-sm-3">
                            <div class="form-group">
                              <label class="control-label">Session<span class="asterisk">*</span></label>
                                <?php echo $this->form->session; ?>
                            </div>
                        </div>	
                           	

						<div class="col-sm-3">

                            <div class="form-group">

                              <label class="control-label">Batch<span class="asterisk">*</span></label>

                                <?php echo $this->form->batch_id; ?>

                            </div>
                        </div>	
                        <div class="col-sm-3">
                            <br>
                      <button type="button" id="getRecord" class="btn btn-primary" style="float: left" value="0" >Get Record</button>
                        </div>
                    
                    <div class="clearfix"></div>

                  </div>

<div class="x_content">

		

		<div class="padding-md clearfix">

            <div class="ajaxData" id="ajaxData">     

			<table class="table table-striped table-bordered mb30 jambo_table bulk_action" id="dataTable">

				<thead>

					<tr>

						<th>S.  No.</th>

						<th>Batch</th>
						<th>Term</th>

						<th>Course Code</th>

						<th>Action</th>

					</tr>

				</thead>

				<tbody>

					<?php



						$i = 1;

						$pagination_tr = '';

						if (count($this->paginator) != 0) {



						foreach ($this->paginator as $results) {

						//print_r($results);die;



					?>

							<tr>

								<td><?php echo $i;



									$i++; ?>

								</td>	

								<td><?php echo $results['short_code']; ?></td>
								<td><?php echo $results['term_name']; ?></td>

								<td><?php echo $results['course_code']; ?></td>

								

								<td><a href="<?php echo $this->mainconfig['host']; ?>elective/selection/type/edit/id/<?php echo $results['academic_year_id']; ?>/term/<?php echo $results['term_id'];?>/course/<?=$results['course_id'];?>" class="edit" title="Edit"><span class="fa fa-edit fa-lg"></span></a></td>



							</tr>            



						<?php }

						$pagination_tr = $this->paginationControl($this->paginator, 'Sliding', 'pagination.phtml');

						} ?>



				</tbody>

			</table>

			 <?php echo $pagination_tr; ?>
            </div>
		</div><!-- /.padding-md -->

	</div><!-- /panel -->

	</div>

	</div>

</div><!-- /.padding-md -->		

<?php } ?>

</div>

<script>

$(document).ready(function() {		
$('body').on('change',"#unselect",function(){
var value = $(this).parent().attr("class");
if(value.includes("off")){
    $(this).removeAttr("checked");
     $(this).val("0");
}
else
{
    $(this).attr("checked","checked");
    $(this).val("1");
}
});
	//$("#stu_dob").datepicker({ dateFormat: 'dd-mm-yy' });  

	$('#stu_dob').datepicker( {format: 'dd-mm-yyyy'} );

}); 





	function ConfirmDelete()

	{

	var x = confirm("Are you sure you want to delete?");

	if(x)

		return true;

	else

		return false;

	}

	

	

 

$('body').on('change', '#academic_year_id', function() {		

var academic_id=$('#academic_year_id').val();

   if(academic_id){

   $('#batch').show();

	$.ajax({ 

			type: "POST",

			url:'<?php echo $this->mainconfig['host'].'master/ajax-get-batch-code';?>',

			data: {academic_id:academic_id}

		}).done(function( data ) {

			var result = $.parseJSON(data);

			if((data!='')){

				$('#batch').val(result['short_code']);

			}

	  });

	 } 

 }); 

$('body').on('change', '#degree_id,#unselect', function() {		

var degree_id=$('#degree_id').val();
var session=$('#session').val();

   if(degree_id && !$('#unselect').prop('checked')){

	$.ajax({ 

			type: "POST",

			url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-academics';?>',

			data: {degree_id:degree_id,session_id:session}

		}).done(function( data ) {

			var result = $.parseJSON(data);
                        $('#academic_year_id>option').each(function(){
                            $(this).removeAttr('selected');
                        });
                        
			if((data!='')){
                                for(index in result){
                                 $('#academic_year_id>option[value="'+result[index]['academic_year_id']+'"]').prop('selected',true) ;
                                }
                              
			}
                    $('#academic_year_id').select2();

	  });

	 } 

 }); 

 

var academic_id=$('#academic_year_id').val();

   if(academic_id){

   $('#batch').show();
                                    var data = '<?=!empty($this->term_id)?$this->term_id:'';?>';
                                  if(data){
                                    var patt = /\d$/g;
                                    var prev_val = parseInt(data.match(patt))-1;
                                    var patt = /(<?=!empty($this->term_id)?$this->term_id:'';?>)/;
                                    data = data.replace(patt,'t'+prev_val);
                                    
                                   $('#term_id').val(data);
                                   $('#term_id').trigger('chosen:updated');
                                   var term_id = data;
                                   
                                   $('#term_id2>option').show();
                                    $('#term_id2>option[value="'+term_id+'"]').hide();
                                    $('#term_id2>option[value="'+term_id+'"]').next().prop('selected',true);
                                    var term2 = $('#term_id2').val();
                                      if((academic_id) && (term_id)){
                                            $.ajax({ 
                                                            type: "POST",
                                                            url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
                                                            data: {academic_year_id:academic_id,term_id : term_id,cc_id: 1}
                                                    }).done(function( data ) {
                                                        $('#course_id').html(data);
                                                        $('#course_id').trigger('chosen:updated');

                                                       if(term2){ 
                                                        $.ajax({ 
                                                            type: "POST",
                                                            url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
                                                            data: {academic_year_id:academic_id,term_id : term2,cc_id: 1}
                                                    }).done(function( data ) {
                                                        var patt = /(<?=$this->course_id;?>)_(\d+)_(\d+)/g;
                                                        var prev_val = data.match(patt);
                                                        data = data.replace(patt,'<?=!empty($this->course_id)?$this->course_id:'';?>');
                                                          $('#course_id2').html(data);
                                                          $('#course_id2').val('<?=$this->course_id;?>');
                                                          $('[value="<?=$this->course_id;?>"]').attr('value',prev_val);
                                                          $('#course_id2').trigger('chosen:updated');
                                                        });
                                                        }  
                                              });
                                            }
                                   
                                   
                                   

                                        
                                            $.ajax({ 
                                            type: "POST",
                                            url: '<?php echo $this->mainconfig['host'].'elective/ajax-get-students1';?>',
                                            data: {academic_year_id:academic_id} 
                                                   }).done(function( data ) {
                                           x = JSON.parse('<?=$this->student_ids;?>');
                                           if(x){
                                            $('#selected_student').html(data);
                                            var i = 0;
                                           for(arr in x){
                                               $('option[value="'+x[arr]+'"]').prop('selected',true);
                                               i++;
                                           }
                                                $('#selected_student').select2();
                                                $('#selected_student').trigger('refresh');
                                                    $('#selected_student').parent().append('<div class="form-control-static pull-right" id="count" style="font-size:1.6em;"><strong>'+(i-3)+' : Selected Students</strong></div>')  
                                           }
                                    });
			
                }
	 
	 }

	else{

$('#batch').hide();

}

$('body').on('change','#unselect',function(){

    if($(this).prop("checked")){
         $('#academic_year_id option').each(function(){
            $(this).attr('selected',false);
               

            
        });
          $('#academic_year_id').select2();
    }
    
});



$('body').on('change','#course_id',function () { 

var academic_year_id = $('#academic_year_id').val();  
var term_id = $('#term_id').val();

var course_id = $('#course_id').val();
var course_text = $('#course_id>option:selected').text();
var cc_id = course_id==0?0:1;

if((academic_year_id) && (term_id) ){
    
    
                        $('#course_id2>option').each(function(index){
                                                    var course = course_text.split(" ") 
                                                    var textcourse2 = $(this).text().toString();
                                                    var matchtext = course[0].toString();
                                                 if(!textcourse2.includes(matchtext)){
                                                     $(this).remove();
                                                 }
                        });
    
                                    $.ajax({ 
                                            type: "POST",
                                            url: '<?php echo $this->mainconfig['host'].'elective/ajax-get-students';?>',
                                            data: {academic_year_id:academic_year_id,term_id : term_id,course_id:course_id,cc_id:cc_id} 
                                                   }).done(function( data ) {
                                                       
                                                       
                                                       $('#selected_student').empty();
                                                       $('#selected_student').html(data);
                                                       var i = 0;
                                                                    $('#selected_student>option').each(function(){
                                               if($(this).val()){
                                                    $(this).prop('selected',true); 
                                                    i++;
                                                }
                                           });
                                           $('#count').remove();
                                            $('#selected_student').select2();
                                            $('#selected_student').parent().append('<div class="form-control-static pull-right" id="count" style="font-size:1.6em;"><strong>'+i+' : Selected Students</strong></div>')     
                                    });
                                    
                                    }
});

// 

$('body').on('change', '#term_id', function() {	

var academic_year_id = $('#academic_year_id').val();
var term_id = $(this).val();
$('#term_id2>option').show();
$('#term_id2>option[value="'+term_id+'"]').hide();
$('#term_id2>option[value="'+term_id+'"]').next().prop('selected',true);
var term2 = $('#term_id2').val();
   if((academic_year_id) && (term_id) ){
	$.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
			data: {academic_year_id:academic_year_id,term_id : term_id,cc_id : 1}
		}).done(function( data ) {
		     $('#course_id').html(data);
            $('#course_id').trigger('chosen:updated');
                    
		    if($('#course_id option').length==1)
		    {
		        
		        	$.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
			data: {academic_year_id:academic_year_id,term_id : term_id,cc_id : 0}
		}).done(function( data ) {
		     $('#course_id').empty();
		     $('#course_id').html(data);
                    $('#course_id').trigger('chosen:updated');
		});
		        
		        
		        
		    }
                    
                    
                    
                    
                   if(term2){ 
                    $.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
			data: {academic_year_id:academic_year_id,term_id : term2,cc_id : 1}
		}).done(function( data ) {
                    $('#course_id2').html(data);
                    $('#course_id2').trigger('chosen:updated');
                    });
                    }  
	  });
   }

 }); 
$('body').on('change', '#term_id2', function() {	

var academic_year_id = $('#academic_year_id').val();
var term_id = $(this).val();
$('#term_id>option').show();
$('#term_id>option[value="'+term_id+'"]').hide();

   if((academic_year_id) && (term_id) ){
	$.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'elective/ajax-get-course';?>',
			data: {academic_year_id:academic_year_id,term_id : term_id,cc_id:1}
		}).done(function( data ) {
                    $('#course_id2').html(data);
                    $('#course_id2').trigger('chosen:updated');

	  });
   }

 }); 




 $('#print').click(function(){

window.print('#grade_data');

});
      function onStudentSelect() {
        var op_list = $('#selected_student').find("option:selected");
        var str = "";
        $(op_list).each(function () {
            str += $(this).text() + "<br/>";
        });
      $('#selected_student').next('div').html(str);
    }
    $(document).ready(function () {
        onStudentSelect();
      onAcademicSelect();
    });
    
    
 $('#selected_student').select2();
      function onAcademicSelect() {
        var op_list = $('#academic_year_id').find("option:selected");
        var str = "";
        $(op_list).each(function () {
            str += $(this).text() + "<br/>";
        });
      $('#academic_year_id').next('div').html(str);
    }
     $('#academic_year_id').select2();
//For filter session
    $('body').on('change', '#academic_year', function () {;
        var year_id = $('#academic_year').val();
        if (year_id) {
            
            $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'master/ajax-Get-Session'; ?>',
                data: {year_id: year_id}
            }).done(function (data) {
                $('#session').empty('');
                $('#session').html(data);
                $('#session').trigger("chosen:updated");
            });
        }
    });
     //Get Batch By Session
    $('body').on('change', '#session', function () {
        var year_id = $('#session').val();
        if (year_id) {
            
            $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'master/ajax-get-batch'; ?>',
                data: {session: year_id}
            }).done(function (data) {
                
                $('#batch_id').empty('');
                $('#batch_id').html(data);
                $('#batch_id').trigger("chosen:updated");
            });
        }
    });
    $('#getRecord').on('click',function(){
       
        let batch_id= $('#batch_id').val();
        if(batch_id){
            $('#ajaxData').empty('');
           $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'elective/ajax-get-selection'; ?>',
                data: {batch_id: batch_id}
            }).done(function (data) {
                $('#ajaxData').empty('');
                $('#ajaxData').html(data);
            }); 
        }else{
            alert('Please select the required field.');
        }
    });
    
    // $('#stu_id_submit').on('click',function(){
    //     var formIds = $('textarea').val();
    //     var patt = /F-\d{4}-\d{1,}/g;
    //   var result = formIds.match(patt);
    //     var i = 0;
       
       
    //       $('#selected_student>option').each(function(){
    //           var selecttext = $(this).text();
    //             var option = $(this);
    //             option.prop('selected',false);
    //           for(var ele in result){
    //                     if(selecttext.includes(result[ele]+'-')){
    //                         option.prop('selected',true);
    //                         i++;
    //                     }
                        
    //                 }
              
    //       });
    //       $('#count').remove();
    //     $('#selected_student').select2();
    //     $('#selected_student').parent().append('<div class="form-control-static pull-right" id="count" style="font-size:1.6em;"><strong>'+i+' : Selected Students</strong></div>') 
         
    // });
    
        $('#stu_id_submit').on('click', function () {
        var formIds = $('textarea').val();
        var patt = /F-\d{4}-\d{1,}/g;
        var result = formIds.match(patt);
        var i = 0;

        $('#selected_student').empty();

        for (var ele in result) {
            $('#selected_student').append(`<option selected value=${result[ele]}>${result[ele]}</option>`);
            i++;

        }
        $('#count').remove();
        $('#selected_student').select2();
        $('#selected_student').parent().append('<div class="form-control-static pull-right" id="count" style="font-size:1.6em;"><strong>' + i + ' : Selected Students</strong></div>')

    });
    
    
</script>