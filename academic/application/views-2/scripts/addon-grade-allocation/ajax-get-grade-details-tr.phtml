<script>        var id = '<?=$this->id?$this->id['tabl_id']:0;?>';//if(id != 0){//$('#fac').hide();//   $('<div class="col-sm-12 text-center"><h4 class="text-danger"><strong>**Published TABULATION REGISTER Cannot be Modified.<br><small class="text-danger"><b>(Note:</b>&nbsp; Course Listed only with Created Evaluation Components.<b>)</b></small></strong></h4></div>').insertBefore('table');//}//else//{//   $('#fac').show(); //}</script><?php$fail_Val = array('D'=>'F','F'=>'F');$item_result = $this->result;$passpercent = $this->passpercent;$acad = $this->acad;$addon_id = $this->addon_id;//$ter = $this->term;//$dept_name = $this->dept_name;$session_model = new Application_Model_Session();$acd_details = new Application_Model_Academic();$deg_details = new Application_Model_Department();$gradeItems = new Application_Model_AddonGradeAllocationItems();$term_details = new Application_Model_TermMaster();$semester_rule = new Application_Model_SemesterRule();$evalItems = new Application_Model_AddonEvaluationComponentsItems();$gradeReportModel = new Application_Model_AddonGradeAllocationReportItems();$exam_model =  new Application_Model_ExamDateModel();//$cmn_term = $this->cmnTerms;//$examinfo = $exam_model->getRecordByBatchAndTerm($item_result[0]['academic_year_id'],$cmn_term);//$examyear = date("F - Y",strtotime($examinfo['examination_month']));//$resultdate = date("d-m-Y",strtotime($examinfo['result_publish_date']));$studentMarksDetails = $this->studentMarks;//$session_name = $session_model->getRecord($item_result[0]['session'])['session'];//====Variable Declaration==========//$i = 1;$k = 0;$tot_credit_point = $tot_grade_point = $one_row = $stu_data_pr = $component = $weightage = 0;$EvaluationComponents_model = '';$geData = array();$geWeightage = array();$ct_arr = $weightage_arr = $component_arr = array();$session =0 ;$examyear1= "" ;//======['start printing tabulation register']=======//for ($i = 0; $i < count($item_result); $i++) {       $tot_arr = array();    ?><!--[table head to be aligned into middle]---------->    <style>@page {  @bottom-left {    content: counter(page) ' of ' counter(pages);  }} span{text-transform: none    ; }   /* .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{*//*    font-size:10px !important;*//*    margin:0;*//*    padding:0 !important;*//*    text-align:center !important;*//*    vertical-align:middle !important;*//*}*/.table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{    font-size:.73em !important;    margin:0;    padding:0 !important;    text-align:center !important;    vertical-align:middle !important;}.table>tbody>tr>td{    font-size:.83em !important;    margin:0;    padding:0 !important;    text-align:center !important;    vertical-align:middle !important;}    </style>    <div class="box-body table-responsive" >        <div style="overflow-x:scroll" >            <div id='printBox'>            <table class="table table-striped table-bordered mb30 jambo_table bulk_action"  border ='1' id='dataTable' style="height:20em;" >                <thead>                    <tr style="padding:0">                        <input type ="hidden" id='tabl_id' value="<?=$this->id?$this->id:0;?>"/>                        <th rowspan="2" class="complex" data-id='hide'>S. No.</th>                        <th rowspan="2" class="complex" data-id='hide'>Name of Participants</th><!--                        <th rowspan="2" class="complex">ID Number</th>-->                        <th rowspan="2" class="complex" data-id='hide'>Exam Roll No</th>                         <th rowspan="2" class="complex" data-id='hide'>Reg No.</th>                 <input type ="text"  name ="academic_id[]" style="display:none;" value ="<?= $item_result[$i]['academic_year_id']; ?>_<?= $item_result[$i]['term_id']; ?>"/>                <input style="display:none;" type="text" id="dept" value="<?=$dept_name;?> " />                <?php                            $Corecourselearning_model = new Application_Model_AddonLearningModel();              $course_type_result = $Corecourselearning_model->getcourseTypeOn($item_result[$i]['academic_year'], $item_result[$i]['id']);                 //-------------------------------------------------------****************------------------------------------------------------------------------------------------------//                     foreach ($course_type_result as $course_type_key => $course_type_val) {//====printing upper head with component==//                                           $item_result[$i]['course_id'] = $course_type_val['course_id'];                    // $item_result[$i]['academic_year'] = $course_type_val['academic_year'];                    ?>                    <th rowspan="2" class="complex" data-id='hide'><?= $course_type_val['course_code']; ?></th><!--                    <th rowspan="2" class="complex">Course Code</th>-->                                       <?php                    //  print_r($course_type_result);die();                    //====================[getting all the evaluation component]======================================//                    $EvaluationComponents_model = new Application_Model_AddonEvaluationComponents();                    $result = $EvaluationComponents_model->getAllComponentsonTerms($addon_id, $item_result[$i]['course_id']);                                                        foreach ($result as $k => $val) {                        ?>                       <th class="complex" style='padding: .2em;'><?php echo $val['component_name']; ?></th>                        <th class="complex" style='padding: .2em;'>Rm</th>        <?php } ?>                    <th class="complex" style='padding: 0.2em;'>Total</th>                    <th class="complex" style='padding: 0.2em;' >credit</th>                    <th class="complex" style='padding: 0.2em;' >Grade Letter</th>                    <th class="complex" style='padding: 0.2em;' >Grade Point</th>                    <th class="complex" style='padding: 0.2em;' >Credit Point</th>                    <th class="complex" style='padding: 0.2em;'><?= $course_type_val['course_code']; ?> Rm</th>    <?php } ?>                 <th class="complex" style='padding: 0.2em;'>Total Cr. Point</th>                 <th class="complex" style='padding: 0.2em;'>Total Cr.</th>                <th class="complex" style='padding: 0.2em;'>SGPA</th>                <th class="complex" style='padding: 0.2em;'>Current Semester</th>                <th class="complex" style='padding: 0.2em;'>Final Remarks</th>                <th class="complex" style='padding: 0.2em;'>Fail in</th>                <!--<th class="complex" style='padding: 0.2em;' data-id="no_print">Download</th>-->                <!--<th class="complex" style='padding: 0.2em;' data-id="no_print">View</th>-->                </tr> <?php //==========[END Printing upper components]====================// ?>  <!-----------------------------------------------------------**************************---------------------------------------------------------------------------->                <tr>                    <?php                                          foreach ($course_type_result as $course_type_key => $course_type_val) {                    //========================[Getting all the course and ge_id for the weightage]============================//                    $newData = $EvaluationComponents_model->getAllComponentsonTerms1($item_result[$i]['academic_year'], $item_result[$i]['course_id']);                   $getNewWeightage = $ct_arr = $getWeightage = array();                   $total_sub_mks='';                  $totolfmpass='';                   foreach ($newData as $Studkey => $newVal) {                        // print_r($newVal['weightage']);die();                        $getWeightage[$newVal['component_id']] = $newVal['weightage'];                                                                              //print_r($newData);die();                                                ?>                                        <?php                                                     ?>                            <th>                                <?php                                //echo $passpercent; die();                               $fm = $newVal['weightage'];                                                               $passmarks = ((int)$passpercent/100)*(int)$fm;                                $pm = $passmarks;                                //$val[$index] = $fullMks."<br/>($passmarks)";                          ?>                              <div style="display:table;">                                  <p >FM&nbsp;(<?=$fm;?>)</p>                                  <hr/>                                  <p >PM&nbsp;(<?=$pm;?>)</p>                              </div>                               <?php                                                                ?></th>                            <th></th>                            <?php                            $total_sub_mks+=$newVal['weightage'];                                                     // }                        }                                            // $total_sub_mks = array_unique($tot_arr[$course_type_val['id']]);                        ?>                        <th><div style="display:table;">                            <p >FM&nbsp;(<?= $total_sub_mks; ?>)</p>                            <hr/>                            <p >PM&nbsp;(<?=$passpercent;?>)</p>                        </div></th>                        <th ></th>                        <th ></th>                        <th ></th>                        <th >(Credit x Grade Point)</th>                        <th></th>    <?php  $totpassfm+=$total_sub_mks;   } ?>      <th></th>                    <th></th>                    <th>(Total Cr. Point / Total Cr.)</th>                    <th></th>                    <th></th>                    <th></th>                </tr>  <!-----------------------[End printing head]--------------------------------------------------------------------------------------------------->                </thead>              <tbody>                                         <?php                     $m = 1;                     $inc=$inde = 0;                    $corce = array();                    $allprom = false;                //===============[Degree_id & cmn terms]==========================//                          // if(!empty($acad)){                      //  $d_id = $acd_details->getRecord($acad)['department'];                       // $degree_id= $deg_details->getRecord($d_id)['degree_id'];                        $totalCourse =  count($course_type_result);                    $total_count = count($studentMarksDetails);                  //  $tbl_id=$this->id?$this->id['tabl_id']:0;                   // $publishedStudent = $gradeReportModel->getPublishedStudent($item_result['academic_year'], $item_result['id'],$tbl_id);                                                      // / while($inc<$total_count){                      //   $stu_data = $studentMarksDetails[$inc];                 //  echo "<pre>"; print_r($studentMarksDetails);                    //echo $total_count; die();                     $PromotedStudent = array_column($resultfailstudent,'student_id');                    $publishedStudentsId = array_column($publishedStudent,'student_id');                      while($inc<$total_count){                         $stu_data = $studentMarksDetails[$inc];                    /// foreach ($studentMarksDetails as $stu_data) {                                          ?>                                        <tr>                             <td><?=$m;?></td>                                                                         <td><?=$stu_data['stu_fname'];?>/<br/>                                                <?=$stu_data['stu_id'];?>                                            </td>                                            <td><?=$stu_data['exam_roll'];?></td>                                            <td><?=$stu_data['reg_no'];?></td>                                            <input type='text' style="display:none;" name='stu_ids[]' value="<?=$studentMarksDetails[$inc]['student_id'];?>" />                                            <input type="text" name="saved_id" style="display:none;" value="<?=$tbl_id;?>"/>                                            <input type="text" style="display:none;" name="studSaveId[<?= $studentMarksDetails[$inc]['student_id'];?>]" value="<?=in_array($studentMarksDetails[$inc]['student_id'],$publishedStudentsId)?1:0;?>" />                           <?php for ($i = 0; $i < count($item_result); $i++)    {                                                                         $termTotalMarks = 0;                              $totpassmark=0;                            $termCreditPointTotal = 0;                            $termCreditTotal = 0;                            $termCredit = 0;                            $emptyCells = false;                            $core_course = $Corecourselearning_model->studentCorecourse($item_result[$i]['academic_year'], $item_result[$i]['id']);                                                  $termWiseRemarks= 'P';                          $termStyle = "";                          $fail_in = $fail_ct_id = array();                          $pass_in_ct_id=array();                          $gp = $fcourse_ids = array();                          $fcourse_name = array();                          $appercoursecount=0;                          foreach($core_course as $courseIndexKey=>$courseData){                                                          $failRemarksCourseWise = array();                            $courseWiseRemarks = 'P';                            $courseStyle = "";                                                      if($courseData['course_id']==$studentMarksDetails[$inc]['course_id']) {                            $course_components = $evalItems->getRecordsByCourse($courseData['course_id']);                            $weightage = array_column($course_components,'weightage');                                                                                              $creditPoint = $studentMarksDetails[$inc]['count_id']==0? $studentMarksDetails[$inc]['credit_value']*$studentMarksDetails[$inc]['number_grade']:0;                            $termTotalMarks+=$studentMarksDetails[$inc]['count_id']==0?$studentMarksDetails[$inc]['obtained_marks']:0;                            $termCreditPointTotal+=$studentMarksDetails[$inc]['count_id']==0?$creditPoint:0;                            $termCreditTotal+=$studentMarksDetails[$inc]['count_id']==0?$studentMarksDetails[$inc]['credit_value']:0;                            $numberValue = explode(',',$studentMarksDetails[$inc]['number_value']);                            $gradeValue = explode(',',$studentMarksDetails[$inc]['grade_value']);                                                                                            //  print_r($gradeValue) ; die();                              if(!in_array($gradeValue[0],array('NA','Ab'))                            && !in_array($gradeValue[1],array('NA','Ab'))                            && !in_array($gradeValue[2],array('NA','Ab'))){                            $failRemarksCourseWise[] = $gradeValue[0] = in_array($gradeValue[0],array('F','D'))?'F':'P';                            $failRemarksCourseWise[] = $gradeValue[1] = in_array($gradeValue[1],array('F','D'))?'F':'P';                            $failRemarksCourseWise[] = $gradeValue[2] = in_array($gradeValue[2],array('F','D'))?'F':'P';                            $appercoursecount++;                                                       }                            else                            {                            $failRemarksCourseWise[] = $gradeValue[0] = in_array($gradeValue[0],array('NA','Ab'))?$gradeValue[0]:'P';                            $failRemarksCourseWise[] = $gradeValue[1] = in_array($gradeValue[1],array('NA','Ab'))?$gradeValue[1]:'P';                            $failRemarksCourseWise[] = $gradeValue[2] = in_array($gradeValue[2],array('NA','Ab'))?$gradeValue[2]:'P';                            }                            if(in_array('F',$failRemarksCourseWise)  || in_array('NA',$failRemarksCourseWise) || in_array('Ab',$failRemarksCourseWise)){                                $courseWiseRemarks = 'F';                                $termWiseRemarks = 'F';                                $courseStyle = 'style="color:red;"';                                $termStyle = 'style="color:red"';                                $fail_in[] = $studentMarksDetails[$inc]['course_code'];                                $fail_ct_id[] = $studentMarksDetails[$inc]['course_id'];                                $fcourse_ids[] =   $studentMarksDetails[$inc]['course_id'];                                $fcourse_name[] = $studentMarksDetails[$inc]['course_code'];                            }                            else if(in_array('P',$failRemarksCourseWise)){                                $gp[] = $creditPoint;                                $pass_in_ct_id[]=$studentMarksDetails[$inc]['course_id'];                                                             }                            if($courseWiseRemarks=='P') {                            $totpassmark+=$studentMarksDetails[$inc]['count_id']==0?$studentMarksDetails[$inc]['obtained_marks']:0;                                                         }                                        // $fail_in[] = $studentMarksDetails[$inc]['course_code'];                                        ?>                                                                                                                            <input type='text' style="display:none;"  name="grade[student_id_<?=$studentMarksDetails[$inc]['student_id'].$item_result[$i]['academic_year']; ?>_<?php echo $item_result[$i]['id']; ?>_<?php echo $studentMarksDetails[$inc]['course_id']; ?>][]" id="student_id" value="<?php echo $studentMarksDetails[$inc]['student_id']; ?>" />                                    <input type='text' style="display:none;"  name="number_value[]" value="<?=$studentMarksDetails[$inc]['number_value'];?>" />                                      <input type='text' style="display:none;" name="course_ids[]" value ="<?=$studentMarksDetails[$inc]['course_id'];?>" />                                    <input type='text' style="display:none;"   name="grade[weightages_<?= $studentMarksDetails[$inc]['student_id'].$item_result[$i]['academic_year']; ?>_<?php echo $item_result[$i]['id']; ?>_<?php echo $studentMarksDetails[$inc]['course_id']; ?>][]" value="<?=implode(',',$weightage);?>" />                                    <input type='text' style="display:none;"   name="grade[grades_<?= $studentMarksDetails[$inc]['student_id'].$item_result[$i]['academic_year']; ?>_<?php echo $item_result[$i]['id']; ?>_<?php echo $studentMarksDetails[$inc]['course_id'] ?>][]" value="<?=$studentMarksDetails[$inc]['component_id']; ?>" />                                                                                       <td><?=$studentMarksDetails[$inc]['course_name']?>/<br/><?=$studentMarksDetails[$inc]['course_code'];?></td>                                    <td <?=in_array($gradeValue[0],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>>                                    <?=empty($numberValue[0]) && in_array($gradeValue[0],array('NA','Ab'))?$gradeValue[0]:$numberValue[0];?><?=in_array($gradeValue[0],array('F','D','NA','Ab'))?"*":"";?>                                    </td>                                    <td <?=in_array($gradeValue[0],array('F','D','NA','Ab'))?"style='color:Red;'":"";?> ><?=empty($numberValue[0])?'&mdash;':$gradeValue[0];?></td>                                             <!---------------------[ESE(T)]----------------------->                                    <td <?=in_array($gradeValue[1],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>>                                    <?=empty($numberValue[1]) && in_array($gradeValue[1],array('NA','Ab'))?$gradeValue[1]:$numberValue[1];?><?=in_array($gradeValue[1],array('F','D','NA','Ab'))?"*":"";?>                                    </td>                                    <td <?=in_array($gradeValue[1],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>><?=empty($numberValue[1])?'&mdash;':$gradeValue[1];?></td>                                    <!---------------------[ESE(P)]----------------------->                                    <td <?=in_array($gradeValue[2],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>>                                    <?=empty($numberValue[2]) && in_array($gradeValue[2],array('NA','Ab'))?$gradeValue[2]:$numberValue[2];?><?=in_array($gradeValue[2],array('F','D','NA','Ab'))?"*":"";?>                                    </td>                                    <td <?=in_array($gradeValue[2],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>><?=empty($numberValue[2])?'&mdash;':$gradeValue[2];?></td>                                                                                 <td <?=in_array($studentMarksDetails[$inc]['letter_grade'],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>>                                    <?=$studentMarksDetails[$inc]['obtained_marks'];?><?=in_array($studentMarksDetails[$inc]['letter_grade'],array('F','D','NA','Ab'))?"*":"";?>                                    </td>                                    <td><?=$studentMarksDetails[$inc]['credit_value'];?></td>                                    <td <?=in_array($studentMarksDetails[$inc]['letter_grade'],array('F','D','NA','Ab'))?"style='color:Red;'":"";?>><?=$studentMarksDetails[$inc]['letter_grade'];?></td>                                    <td><?=$studentMarksDetails[$inc]['number_grade'];?></td>                                    <td <?=$courseStyle;?> ><?=$creditPoint;?></td>                                    <td <?=$courseStyle;?> ><?= $courseWiseRemarks;?></td>                                                                                                                   <?php                                                          $inc = $studentMarksDetails[$inc]['obtained_marks']>0?$inc+1:$inc+2;                                            $emptyCells= true;                                                } }                                                                          ?>                                                                                   <?php   if(!$emptyCells){?>                                                             <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                        <td>&mdash;</td>                         <td>&mdash;</td>                                    <?php                         $inc++; }                     //===============[calculating sgpa]=========================//                                        $sgpa = number_format($termCreditPointTotal/$termCreditTotal,2);                    $sgpa = $termWiseRemarks=='F'?'&mdash;':$sgpa;                                        $tottalpasspermarks=(int)$passpercent*(int)$totpassfm/100;                    if($tottalpasspermarks<=$totpassmark) {                       $termWiseRemarks ='P';                      $promotion = "Pass";                     }                                        else {                      $termWiseRemarks ='F';                      $promotion = "Failed";                    }                   // .' '.$totpassmark.' '.$passpercent.' '.$tottalpasspermarks//                     if((in_array($stu_data['student_id'],$PromotedStudent) && $details[0]['appeared_paper'] <=$appercoursecount) || ($allprom && $details[0]['appeared_paper'] <=$appercoursecount)){//                                  // $term_name = $term_details->getAcademicTermIdAction($item_result[$i]['academic_year_id'],$cmn_term);//                                   $promotion = !empty($term_name)?"Promoted to $term_name Sem":"Pass";//                                   $termWiseRemarks='P';//                               }//                           else {//                               $termStyle = 'style="color:red"';//                                    $termWiseRemarks ='F';//                                    $promotion = "--";//                                }                                                                                        ?>                                               <td <?=$termStyle;?> ><?=$termCreditPointTotal;?></td>                    <td <?=$termStyle;?> ><?=$termCreditTotal;?></td>                    <td <?=$termStyle;?> ><?=$sgpa;?></td>                    <td <?=$termStyle;?> ><?=$promotion;?></td>                    <td <?=$termStyle;?> ><?=$termWiseRemarks;?></td>                    <td <?=$termStyle;?> ><?=implode(',',$fail_in)?></td>                                                                <?php                         }//============[END TErms Loop] ?>                        <input type='text' style="display:none;"  name="fail_in[]" value="<?=implode(',',array_unique($fail_ct_id)) ;?>" />                        <input type='text' style="display:none;"  name="sgpa[]" value="<?php if($termWiseRemarks == 'F' ){echo '0';}else {echo $sgpa;} ?>" />                        <input type='text' style="display:none;"  name="gp[]" value="<?=implode(',', ($gp)) ;?>" />                        <input type='text' style="display:none;"  name="fcourse_ids[]" value="<?=implode(',', array_unique($fcourse_ids)) ;?>" />                        <input type='text' style="display:none;"  name="tot_credit_point[]" value="<?=$termCreditTotal;?>" />                        <input type='text' style="display:none;"  name="promotion[]" value="<?=$promotion;?>" />                        <input type='text' style="display:none;"  name="f_remark[]" value="<?=$termWiseRemarks;?>" />                        <input type='text' style="display:none;"  name="tot_grade_point[]" value="<?=$termCreditPointTotal;?>" />                                                <?php $m++;                                                }//=====[End Student For Earch]                                        ?>                    </tr>                    <?php            //}//========[END IF statement]            ?>	                </tbody>                            </table>        </div>        </div>    </div>    <div id="addmore_items_<?php echo $i; ?>"></div>    <br>    <?php}function selectData($array, $fieldname, $number = 0) {    try {        $filterd_value = array();        if (is_array($array) && is_array($fieldname)) {            for ($i = 0; $i < $number; $i++) {                foreach ($fieldname as $field_key => $field_value) {                    $filterd_value[$i][$field_value] = $array[$i][$field_value];                }            }            return $filterd_value;        } else {            throw new Exception('first and second param should be of type array !');        }    } catch (Exception $e) {        echo '<strong>Error Message !</strong>' . $e->getMessage();    }}?><script>    // $('table').each(function () {    //     var check_val = $(this).find('thead>tr:nth-child(2)>th:nth-child(1)').text();    //     if (check_val.toLowerCase() != 'weightage') {    //         $(this).prev().attr('style', 'display:none');    //         $(this).removeAttr('id');    //         $(this).attr('style', 'display:none');    //     }    // });    $('<div class="row" id="moved-buttons" style="margin-top:1em; margin-right:.09em;"></div>').appendTo('#datatable-responsive_filter')    $('div[class="dt-buttons btn-group"]').appendTo('#moved-buttons');    setDatatables('<?=$dept_name;?>','<?=$session_name;?>','<?=$examyear;?>','<?=$resultdate;?>','<?=$degree_id;?>');</script>