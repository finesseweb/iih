<style>
    .my.table>tbody>tr>td, .my.table>tbody>tr>th, .my.table>tfoot>tr>td, .my.table>tfoot>tr>th, .my.table>thead>tr>td, .my.table>thead>tr>th {
        padding: 0px !important;
        line-height: 1.42857143;
        vertical-align: middle !important;
        border-top: 1px solid #ddd;
    }
    .my.table{
        margin-bottom:0px;
    }

    #term_id-label{
        display:none;
    }
</style>  
<div class="right_col">

    <?php if ($this->type) { ?>
        <div class="padding-md ">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="page-title txt-color-blueDark" >
                        <div><i class="fa fa-eye">Class Allotment</i></div>
                    </h3>
                    <div class="panel panel-default">
                        <form class="no-margin" id="formValidate1" action="<?php echo $this->form->getAction() ?>" method="post" data-validate="parsley" >

                            <div class="panel-body">

                                <div class="row">

                                    <div class="col-sm-3 employee_class">
                                        <div class="form-group">


                                            <label class="control-label">Batch<span class="asterisk">*</span></label>
                                            <?php echo $this->form->academic_year_id; ?>

                                        </div>
                                    </div>

                                    <div class="col-sm-3 employee_class">
                                        <div class="form-group">


                                            <label class="control-label">Term <span class="asterisk">*</span></label>
                                            <?php echo $this->form->term_id; ?>

                                        </div>
                                    </div>

                                    <div class="col-sm-3 employee_class">
                                        <div class="form-group">


                                            <label class="control-label">Course<span class="asterisk">*</span></label>
                                            <?php echo $this->form->course_id; ?>

                                        </div>
                                    </div> 
                                    <div class="col-sm-3" >                           
                                        <div class="form-group">


                                            <label class="control-label">Date<span class="asterisk">*</span></label>
                                            <?= $this->form->date; ?>

                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-sm-3">
                                        <div class="form-group">


                                            <label class="control-label"><span class="asterisk"></span></label>
                                            <input type="text" id="batch" class="form-control" style="background-color:#fdf59a;" readonly />
                                        </div>
                                    </div>
                                    <div id='fom-data'>
                                    </div>    
                                </div>
                            </div>

                            <div class="">
                                <div id="item_details"></div>
                            </div>


                            <?php if (count($this->result) > 0) { ?>
                            <?php } ?>
                    </div>
                    <div class="panel-footer">									
                        <div class="row">
                            <div class="col-sm-7 col-sm-offset-5">
                                <?php if ($this->type == 'add') { ?> 
                                    <div style="float:left;margin-right:2px;">
                                        <button class="btn btn-primary submit" id="btn" >Submit</button>
                                    </div>
                                    <div style="float:left;padding:0px 10px;">
                                        <button type="reset" class="btn btn-danger btn-default">Reset</button>
                                    </div>
                                <?php } else { ?>
                                    <div style="float:left;">
                                        <button class="btn btn-primary submit">Update</button>
                                    </div>
                                    <div style="float:left;">
                                        <a class="btn btn-primary" href="<?php echo $this->mainconfig['host']; ?>master/classalotment">Back</a>
                                    </div>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                </div>
                </form>
            </div><!-- /panel -->
        </div><!-- /.col-->				
    </div><!-- /.row -->
    </div>	
    <!-- /.padding-md -->	
<?php } else { ?>

    <?php if (count($this->messages)) {
        foreach ($this->messages as $message) {
            ?>
            <div class="alert alert-success ">
                <a type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</a>
            <?php echo $this->escape($message); ?>
            </div>
        <?php }
    } ?>
    <!-- widget grid -->
    <div class="">
        <div class="">
            <div class="row">

                <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
                    <h3 class="page-title txt-color-blueDark">
                        <i class="fa fa-bars">Class Allotment</i>

                    </h3>
                </div>


                <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">	 

                    <a class="btn btn-primary pull-right" style="margin-top: 25px;" href="<?php echo $this->mainconfig['host']; ?>master/classalotment/type/add">Add/ Edit </a>
                </div>

            </div>

            <div class="x_panel">

                <div class="x_title">
                    <h2>Class Allotment</h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                        <li class="dropdown">
                            <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        </li>
                        <li><a class=""><i class="fa fa-close"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">

                    <div class="padding-md clearfix">
                        <table class="table table-striped table-bordered mb30 jambo_table bulk_action" id="datatable-responsive">
                            <thead>
                                <tr>
                                    <th>S.  No.</th>	
                                    <th>Facutly</th>
                                    <th>Batch</th>
                                    <th>Term Name</th>
                                    <th>Course Code</th>
                                    <th>Class</th>
                                    <th>Date</th>
                                    <th>Action</th>
                                    <!--<th>View</th>-->
                                </tr>
                            </thead>
                            <tbody>
                                <?php
                                $i = 1;
                                $pagination_tr = '';
                                if (count($this->paginator) != 0) {

                                    foreach ($this->paginator as $results) {
                                        ?>
                                        <tr>
                                            <td><?= $i; ?></td>
                                            <td><?= $results['faculty_id']; ?></td>
                                            <td><?= $results['batch_id']; ?></td>
                                            <td><?= $results['term_id']; ?></td>
                                            <td><?= $results['course_id']; ?></td>
                                            <td><?php
                                                if ($results['class_no'] == 1)
                                                    echo 'First class';
                                                if ($results['class_no'] == 2)
                                                    echo 'Second class';
                                                if ($results['class_no'] == 3)
                                                    echo 'Third class';
                                                if ($results['class_no'] == 4)
                                                    echo 'Fourth class';
                                                if ($results['class_no'] == 5)
                                                    echo 'Fifth class';
                                                ?></td>
                                            <td><?= date('d-m-Y', strtotime($results['date'])); ?></td>

                    <td><a href="<?php echo $this->mainconfig['host']; ?>master/classalotment/type/edit/id/<?php echo $results['id']; ?>" class="edit" title="Edit">View</a><!--<?php //if(in_array($this->role_id,$this->administrator_role)){?>&nbsp; | &nbsp;  <a href="<?php //echo $this->mainconfig['host']; ?>attendance/index/type/delete/id/<?php echo $results['ec_id']; ?>" onclick="return ConfirmDelete();" title="Delete" class="delete"> <span class="fa fa-trash-o fa-lg"></span> </a><?php //} ?>--></td>
                                        </tr>

                                <?php $i++;
                            }
                        } ?>
                            </tbody>
                        </table>
    <?php echo $pagination_tr; ?>
                    </div><!-- /.padding-md -->
                </div><!-- /panel -->
            </div>
        </div>
    </div><!-- /.padding-md -->		
<?php } ?>
</div>
<script>



    var term_id = $('#term_id').val();
    var academic_id = $('#academic_year_id').val();
    if (term_id) {
        $.ajax({
            type: "POST",
            url: '<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-course'; ?>',
            data: {academic_year_id: academic_id, term_id: term_id}
        }).done(function (data) {
            //alert(data);
            $('#course_id').empty('');
            $('#course_id').html(data);
            $('#course_id').val(<?= $_SESSION['classalotment']['course_id']; ?>);
            var course_id = $("#course_id").val();
            $.ajax({
                type: "POST",
                url: "<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-date'; ?>",
                data: {batch_id: academic_id, term_id: term_id, course_id: course_id}
            }).done(function (data) {
                $('#date').empty('');
                $("#date").html(data);
                $('#date').val('<?= $_SESSION['classalotment']['date']; ?>');
<?php unset($_SESSION['classalotment']['date']); ?>
                var date_val = $('#date').val();
                $.ajax({
                    type: "POST",
                    url: "<?php echo $this->mainconfig['host'] . 'master/ajax-student-list-view'; ?>",
                    data: {batch_id: academic_id,
                        term_id: term_id, course_id: course_id, date_val: date_val}
                }).done(function (data) {
                    $('#fom-data').empty('');
                    $("#fom-data").html(data);


                    $.ajax({
                        type: "POST",
                        url: '<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-faculty'; ?>',
                        data: {batch_id: $('#academic_year_id').val(), term_id: $('#term_id').val(), course_id: $('#course_id').val()}
                    }).done(function (data) {
                        $('#faculty_1').empty(data);


                        $('#faculty_1').html(data);

                        $('#faculty_1').val('<?= $_SESSION['classalotment']['faculty']; ?>');
<?php unset($_SESSION['classalotment']['faculty']); ?>


                        $('select[name=class_no]').val('<?= $_SESSION['classalotment']['class_no']; ?>');
<?php unset($_SESSION['classalotment']['class_no']); ?>




                    });

                });




            });


        });
    }



    function ConfirmDelete()
    {
        var x = confirm("Are you sure you want to delete?");
        if (x)
            return true;
        else
            return false;
    }


    $("#academic_year_id").change(function () {
        var academic_id = $('#academic_year_id').val();
        if (academic_id) {
            $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'master/ajax-get-terms'; ?>',
                data: {academic_year_id: academic_id}
            }).done(function (data) {
                //alert(data);
                $('#term_id').empty('');
                $('#term_id').html(data);
            })
        }
    });



    $("#term_id").change(function () {
        var term_id = $('#term_id').val();
        var academic_id = $('#academic_year_id').val();
        // alert(academic_id);
        $.ajax({
            type: "POST",
            url: '<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-course'; ?>',
            data: {academic_year_id: academic_id, term_id: term_id}
        }).done(function (data) {
            //alert(data);
            $('#course_id').empty('');
            $('#course_id').html(data);
        })

    });

    $("#course_id").change(function () {
        var term_id = $('#term_id').val();
        var academic_id = $('#academic_year_id').val();
        var course_id = $("#course_id").val();

        // alert(academic_id);
        var id = $(this).attr("id");
        $.ajax({
            type: "POST",
            url: "<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-date'; ?>",
            data: {batch_id: academic_id, term_id: term_id, course_id: course_id}
        }).done(function (data) {
            $('#date').empty('');
            $("#date").html(data);
        });

    });


    $("#date").change(function () {
        var term_id = $('#term_id').val();
        var academic_id = $('#academic_year_id').val();
        var course_id = $("#course_id").val();
        var date_val = $("#date").val();
        var id = $(this).attr("id");
        $.ajax({
            type: "POST",
            url: "<?php echo $this->mainconfig['host'] . 'master/ajax-student-list-view'; ?>",
            data: {batch_id: academic_id,
                term_id: term_id, course_id: course_id, date_val: date_val}
        }).done(function (data) {
            $('#fom-data').empty('');
            $("#fom-data").html(data);


            $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'attendance/ajax-get-faculty'; ?>',
                data: {batch_id: $('#academic_year_id').val(), term_id: $('#term_id').val(), course_id: $('#course_id').val()}
            }).done(function (data) {
                $('#faculty_1').empty(data);
                $('#faculty_2').empty(data);
                $('#faculty_3').empty(data);
                $('#faculty_4').empty(data);
                $('#faculty_5').empty(data);

                $('#faculty_1').html(data);
                $('#faculty_2').html(data);
                $('#faculty_3').html(data);
                $('#faculty_4').html(data);
                $('#faculty_5').html(data);
            });




        });
    });



    $('body').on('change', '#academic_year_id', function () {
        var academic_id = $('#academic_year_id').val();
        if (academic_id) {
            $('#batch').show();
            $.ajax({
                type: "POST",
                url: '<?php echo $this->mainconfig['host'] . 'master/ajax-get-batch-code'; ?>',
                data: {academic_id: academic_id}
            }).done(function (data) {
                var result = $.parseJSON(data);
                if ((data != '')) {
                    $('#batch').val(result['short_code']);
                }
            });
        }

    });


    var academic_id = $('#academic_year_id option:selected').val();
    if (academic_id) {
        $('#batch').show();
        $.ajax({
            type: "POST",
            url: '<?php echo $this->mainconfig['host'] . 'master/ajax-get-batch-code'; ?>',
            data: {academic_id: academic_id}
        }).done(function (data) {
            var result = $.parseJSON(data);
            if ((data != '')) {
                $('#batch').val(result['short_code']);
            }
        });
    } else {
        $('#batch').hide();
    }
    $('#course_id').change(function () {
    });



    $('#print').click(function () {
        window.print('#grade_data');
    });


</script>

