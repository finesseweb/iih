<?php if ($this->type) { ?>

<div class="padding-md right_col">
	<div class="row">
		<div class="col-md-12">
		<h3 class="page-title txt-color-blueDark" >
			<div><i class="fa fa-eye"> Tax Type</i></div>
		</h3>
			<div class="panel panel-default">
				<form class="no-margin" id="formValidate1" action="<?php echo $this->form->getAction() ?>" method="post" data-validate="parsley" novalidate>
					
					<div class="panel-body">
						<div class="row">		
							<div class="col-sm-3">	
								<div class="form-group">
									<label class="control-label">Country</label>
									<?php echo $this->form->country_id; ?>
								</div>										
							</div> 
<div class="col-md-2">
										<label class="control-label">State</label>	
										<select type="text" multiple name="state[]" id="state_id" label="state" class="form-control">           
								           <option value="">Select State</option>
										   <?php foreach($this->state as $k=>$val) { //echo $k;;
											$selected = '';
											$data = explode(',',$this->result['state_id']);
											foreach($data as $Val) { 
										  if($k == $Val){
										   $selected = "selected";
										     } }?>
									     <option value="<?php echo $k; ?>"<?php echo $selected; ?>><?php echo $val;?></option>	
									     <?php } ?>	
								      	
								     </select>
							</div>
							<div class="col-md-2">
										<label class="control-label">City</label>	
										<select type="text" multiple name="city[]" id="city_id" label="city" 
										class="form-control">    
										 <option value="">Select</option>	
										<?php  foreach($this->city as $key =>$val1) { 
											$selected = '';
											$data = explode(',',$this->result['city_id']);
											foreach($data as $Val) { 
										if($key == $Val){
										    $selected = "selected";
										     } }?>
									 <option value="<?php echo $key; ?>"<?php echo $selected; ?>><?php echo $val1;?></option>
										<?php } ?>									 
								     </select>
									 
							</div>
							<div class="col-md-2">
										<label class="control-label">Location</label>	
										<select type="text" multiple name="location[]" id="location_id" label="location" class="form-control">           
										<?php foreach($this->location as $k=>$val) { //echo $k;; 
										  $selected = '';
										  $data = explode(',',$this->result['location_id']);
										  foreach($data as $Val) {
										 if($k == $Val){
										  $selected = "selected";
										  } }?>
										
									 <option value="<?php echo $k; ?>" <?php echo $selected; ?>><?php echo $val;?></option>	
									<?php } ?>
								     </select>
							</div>
											</div>
							<?php 
								if(!empty($this->taxresult)>0){
										  $i=0; ?>
								<input type="hidden" name="count" id="count" value="<?php echo (count($this->results) +1 ); ?>" class="count">
								<?php
								foreach($this->taxresult as  $val1){
								//print_r($val1);die;
								//$total_amount += $val['total_price'];
								
							
								?>
								<div  class="row" style="padding-top:10px;">
									<div class="col-md-2">
										<label class="control-label">Tax Type</label>	
										<select type="text"  name="tax[tax_type][]" id="tax_type" label="tax_type<?php echo $i; ?>" class="form-control">           
										<?php foreach($this->taxtype as $k=>$val) { //echo $k;; 
										$selected ='';
										if($k == $val['tax_type_allocation']){
										$selected = "selected";
										}?>
									<option value="<?php echo $k; ?>" ><?php echo $val; ?></option>	
									<?php } ?>
								    </select>
							      </div>
							 
							    <div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:20px;margin-left:-12px;">	
								<input type="button" id="select1" value="Select All"  style="border:none;"/>
								<input type="button" id="unselect1" value="Unselect All" style="border:none;"/>
									<div class="form-group">
									
									<label  class="control-label">Fee Type Franchise</label>
									<input type="checkbox" name="tax[type][]" id="type_id" 
									  <?php foreach($this->FeeType as $k=>$val){ //print_r($val); die; ?>
										<label class="label-checkbox" style="padding-left:0px; margin:1px;" >
										<input type="checkbox"  name="tax[fee_type_franchise][<?php echo $i; ?>][]" id="fee_type_franchise<?php echo $i; ?>" class="checkbox1" label="fee_type_franchise<?php echo $i;?>" 
										<?php  if(!empty($val1['fee_type_franchise_id'])){ 
												$data = explode(',',$val1['fee_type_franchise_id']);
												foreach($data as $key=>$Val){
													$checked = '';
													if($k == $Val)
													echo $checked = 'checked';
													} } ?>  value="<?php echo $k;?>"/> 
												  <span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val; ?>
										<?php } ?>
												
								   </div> 
							  </div>
							  <div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:20px;margin-left:-15px;">
								<input type="button" id="select2" value="Select All"  style="border:none;"/>
								<input type="button" id="unselect2" value="Unselect All" style="border:none;"/>
							    <div class="form-group">
								<label  class="control-label">Fee Heads</label>
								  <?php foreach($this->feehead as $k=>$val){ //print_r($val); die; ?>
									<label class="label-checkbox" style="padding-left:0px; margin:1px;" >
									<input type="checkbox" name="tax[fee_head][<?php echo $i; ?>][]" id="fee_head" class="checkbox2"
									label="fee_head_<?php echo $i; ?>" 
									<?php
										 if(!empty($val1['fee_head_id'])){ 
												$data = explode(',',$val1['fee_head_id']);
												foreach($data as $key=>$Val){
													$checked = '';
													if($k == $Val)
													echo $checked = 'checked';
													} } ?>  value="<?php echo $k;?>"/>
												  <span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val; ?>
							     <?php } ?>
							   </div> 
							  </div>		
							  
							    <div class="col-sm-1">
								 <div class="form-group">
									<label class="control-label">Percentage</label>		
									<input type="text"  class="form-control " label="percentage_<?php echo $i; ?>" 
										  name="tax[percentage][]" value="<?php echo $val1['percentage']; ?>"  />
								 </div>
							    </div>
							   <div class="col-sm-2">								
								<label class="control-label">From Date <span class="asterisk">*</span></label>
								<div class="input-group">
									<input type="text" class="form-control" name="tax[from_date][]" id="from_date<?php echo $i; ?>" value="<?php echo $val1['from_date'];?>"/>
									<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
								</div>		 					
							</div>	
							<div class="col-sm-2">
								<label class="control-label">To Date <span class="asterisk">*</span></label>
								<div class="input-group">
									<input type="text" class="form-control" name="tax[to_date][]" id="to_date<?php echo $i; ?>" value="<?php echo $val1['to_date'];?>"/>
									<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
								</div>
							</div>
<?php if($i == 1){ ?>
								<a href="#" style="padding:7px 19px; margin:24px 15px;" class="removeclass6 btn btn-primary 
remove_class" >-</a>	<?php } ?>				
						 </div>
						<?php  $i++; } ?>	
						<div class="col-md-2"></div><div class="col-md-2"></div><div class="col-md-2"></div><div class="col-md-2"></div><div class="col-md-2"></div><div class="col-sm-1"></div>
						<a id="AddButton6" class="btn btn-primary" style="margin:24px 0px; padding: 7px 19px!important;">+</a> 
								<?php } else { ?>
								<div  class="row" style="padding-top:10px;">
								
									<input type="hidden" name="count" id="count" value="1" class="count">
									<div class="col-md-2">
									
										<label class="control-label">Tax Type</label>
										<select type="text"  name="tax[tax_type][]" id="tax_type" label="tax_type" class="form-control"> <?php foreach($this->taxtype as $k=>$val1) {      //echo $k;; 
										$selected ='';
										if($k == $val1){
										$selected = "selected";
										}?>   
											
										<option value="<?php echo $k;?>"><?php echo $val1;?></option>	
										<?php  } ?>
										</select>
								
									</div>								
								<div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:20px;margin-left:-12px;">	
								<input type="button" id="select1" value="Select All"  style="border:none;"/>
								<input type="button" id="unselect1" value="Unselect All" style="border:none;"/>
									<div class="form-group">
									 <label  class="control-label">Fee Type Franchise</label>
									  <?php foreach($this->FeeType as $k=>$val1){ //print_r($val); die; ?>
										<label class="label-checkbox" style="padding-left:0px; margin:1px;" >
										<input type="checkbox" name="tax[fee_type_franchise][0][]" id="fee_type_franchise0"  class="checkbox1" label="fee_type_franchise" <?php
										 
										?> value="<?php echo $k;?>"/>
												<span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val1; ?>
										<?php } ?>
								   </div> 
							  </div>
							  <div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:20px;margin-left:-15px;">
								<input type="button" id="select2" value="Select All"  style="border:none;"/>
								<input type="button" id="unselect2" value="Unselect All" style="border:none;"/>
							    <div class="form-group">
								<label  class="control-label">Fee Heads</label>
								  <?php foreach($this->feehead as $k=>$val1){ //print_r($val); die; ?>
									<label class="label-checkbox" style="padding-left:0px; margin:1px;" >
									<input type="checkbox" name="tax[fee_head][0][]" id="fee_head0" class="checkbox2"label="fee_head_0" <?php
										?> value="<?php echo $k;?>" />
								  <span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val1; ?>
							     <?php } ?>
							   </div> 
							  </div>									
							 <div class="col-sm-1">
								<div class="form-group">
									<label class="control-label">Percentage</label>			
									<input type="text"  class="form-control" name="tax[percentage][]" label="percentage_0" value= "<?php echo $this->result['percentage'];?>" />
								</div>
							 </div>

							<div class="col-sm-2">								
								<label class="control-label">From Date <span class="asterisk">*</span></label>
								<div class="input-group">
									<input type="text" class="form-control" name="tax[from_date][]" id="from_date0" value="<?php echo $this->result['from_date'];?>"/>
									<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
								</div>		 					
							</div>	
							<div class="col-sm-2">
								<label class="control-label">To Date <span class="asterisk">*</span></label>
								<div class="input-group">
									<input type="text" class="form-control" name="tax[to_date][]" id="to_date0" value="<?php echo $this->result['to_date'];?>"/>
									<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
								</div>			 					
							</div>	
									<a id="AddButton6" class="btn btn-primary" style="margin:24px 15px; padding: 7px 19px!important;">+</a> 
						</div>
								
					<?php } ?>
									
						<div id="fields7">
							<div class="padding-top"></div>
						</div>
						<span class="copy_append0" style="display:none">
							<option value="">Select</option>
							<?php foreach($this->taxtype as $k=>$val) {    ?> 
									<option value="<?php echo $k;?>"><?php echo $val;?></option>	
							<?php	} ?>   		
						</span>
						<span class="copy_append1" style="display:none;">
							<?php foreach($this->FeeType as $k=>$val){  //print_r($val); die; ?>
										<option value="<?php echo $k;?>"><?php echo $val;?></option>
										
							<?php	} ?>   		
						</span>
						<span class="copy_append2" style="display:none;" >
							<?php foreach($this->feehead as $k=>$val){  //print_r($val); die; ?>
										<option value="<?php echo $k;?>"><?php echo $val;?></option>
							<?php } ?>   		
						</span>
						<input type="hidden" name="tax_type_id" id="tax_type_id" value="<?php echo $this->result['tax_type_id']; ?>" />
						<input type="hidden" name="state1" id="state1" value="<?php echo $this->result['state_id']; ?>" />
						<input type="hidden" name="city1" id="city1" value="<?php echo $this->result['city_id']; ?>" />
						<input type="hidden" name="location1" id="location1" value="<?php echo $this->result['location_id']; ?>" />
						<div class="panel-footer ">									
							<div class="row">
								<div class="col-sm-7 col-sm-offset-5">
									<?php if ($this->type == 'add') { ?> 
										<div style="float:left;margin-right:2px;">
										<button class="btn btn-primary submit">Submit</button>
										</div>
										<div style="float:left;padding:0px 10px;">
										<button type="reset" class="btn btn-danger btn-default">Reset</button>
										</div>
									<?php } else { ?>
										<div >
										<button class="btn btn-primary submit">Update</button>
										</div>
									<?php } ?>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div><!-- /panel -->
		</div><!-- /.col-->				
	</div><!-- /.row -->
</div><!-- /.padding-md -->	
<?php } else { ?>

<?php if (count($this->messages))   { 
    foreach ($this->messages as $message) {?>
     <div class="alert alert-success ">
<a type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</a>
<?php echo $this->escape($message); ?>
</div>
 <?php } } ?>
 <!-- widget grid -->
<div class="right_col">
<div class="row">
	<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
		<h3 class="page-title txt-color-blueDark">
			<i class="fa fa-bars"> Tax Type</i>
				
		</h3>
	</div>
	<div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
		<a class="btn btn-primary pull-right" style="margin-top:25px;" href="<?php echo $this->mainconfig['host'];?>master/tax-type-allocation/type/add">Add </a>
			
	</div>
</div>
	<div class="x_panel">
               
                    <div class="x_title">
                    <h2>Tax Type</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                       </li>
                      <li><a class=""><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
<div class="x_content">
	
	
		<div class="padding-md clearfix">
			<table class="table table-striped table-bordered jambo_table bulk_action" id="dataTable">
				<thead>
					<tr>
						<th>S.No.</th>	 
						<th>Country</th>
						<th>State</th>
						<th>City</th>
						<th>Location</th>
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					<?php

						$i = 1;
						$pagination_tr = '';
						
						if (count($this->paginator) != 0) {
							

						foreach ($this->paginator as $results) { 

					?>
					<tr>
						<td><?php echo $i;

							$i++; ?>
						</td>
						<td><?php echo $results['countries_name']; ?></td>
						<td><?php echo $results['state_name']; ?></td>
						<td><?php echo $results['city_name']; ?></td>
						<td><?php echo $results['location_name']; ?></td>
						<td><a href="<?php echo $this->mainconfig['host']; ?>master/tax-type-allocation/type/edit/id/<?php echo $results['tax_type_id']; ?>" class="edit" title="Edit"><span class="fa fa-edit fa-lg"></span></a>&nbsp; | &nbsp;  <a href="<?php echo $this->mainconfig['host']; ?>master/tax-type-allocation/type/delete/id/<?php echo $results['tax_type_id']; ?>" title="Delete" class="delete"> <span class="fa fa-trash-o fa-lg"></span> </a></td>

					</tr>            

								<?php }
								$pagination_tr = $this->paginationControl($this->paginator, 'Sliding', 'pagination.phtml');
								} ?>

				</tbody>
			</table>
			 <?php echo $pagination_tr; ?>
		</div><!-- /.padding-md -->
	</div><!-- /panel -->
</div><!-- /.padding-md -->
		
<?php } ?>
</div>
</form>
<script type="text/javascript">
  $(document).ready(function() {		
		// Datepicker
		$('#from_date0').datepicker({format: 'yyyy-mm-dd'});
		$('#to_date0').datepicker({format: 'yyyy-mm-dd'});
	});
$('body').on('change','#country_id', function() {
	var id = $(this).val();	
	var tax_type_id = $('#tax_type_id').val();
		$.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'master/ajax-get-state-edit';?>',
			data: {id:id,tax_type_id:tax_type_id}
		}).done(function( data ) {
			$("#state_id").html( data );
		 });
});
$(document).ready(function() { 
 var id = $('#country_id option:selected').val();
var tax_type_id = $('#tax_type_id').val();

		$.ajax({ 
			type: "POST",
			url:'<?php echo $this->mainconfig['host'].'master/ajax-get-state-edit';?>',
			data: {id:id,tax_type_id:tax_type_id}
		}).done(function( data ) {
			$("#state_id").html( data );
		 }); 
		 }); 
$('body').on('change','#state_id', function() { 
	var selectedstate = new Array();
	//$('input[name="state[]"]:checked').each(function() {
	 $("#state_id option:selected").each(function(){
	selectedstate.push(this.value);
	
	});
	var tax_type_id = $('#tax_type_id').val();
			 if(selectedstate){
			//alert(selectedLocation);
				$.ajax({ 
						type: "POST",
						url:'<?php echo $this->mainconfig['host'].'master/ajax-get-city-tax';?>',
						data: {selectedstate:selectedstate,tax_type_id:tax_type_id}
					}).done(function( data ) {
					//alert(selectedstate);
						$("#city_id").html( data );
					 });
			} 
});

		 	
var tax_type_id = $('#tax_type_id').val();
var state = $('#state1').val();
//alert(state);
if(state){
						$.ajax({ 
								type: "POST",
								url:'<?php echo $this->mainconfig['host'].'master/ajax-get-city-tax';?>',
								data: {selectedstate:state,tax_type_id:tax_type_id}
							}).done(function( data ) {
							//alert(data);
								$("#city_id").html( data );
							 });
					}  		
			
$('body').on('change','#city_id', function() { 

	var selectedcity = new Array();
	//$('input[name="state[]"]:checked').each(function() {
	 $("#city_id option:selected").each(function(){
	selectedcity.push(this.value);
	//alert(selectedcity);
	});
	//alert(selectedcity);
	var tax_type_id = $('#tax_type_id').val();
			 if(selectedcity){
			//alert(selectedLocation);
				$.ajax({ 
						type: "POST",
						url:'<?php echo $this->mainconfig['host'].'master/ajax-get-location-tax';?>',
						data: {selectedcity:selectedcity,tax_type_id:tax_type_id}
					}).done(function( data ) {
						$("#location_id").html( data );
					 });
			} 
});
var city = $('#city1').val();
var tax_type_id = $('#tax_type_id').val();
if(city){
			//alert(selectedLocation);
				$.ajax({ 
						type: "POST",
						url:'<?php echo $this->mainconfig['host'].'master/ajax-get-location-tax';?>',
						data: {selectedcity:city,tax_type_id:tax_type_id}
					}).done(function( data ) {
						$("#location_id").html( data );
					 });
			} 
		/*	var selectedcity = new Array();
				var tax_type_id = $('#tax_type_id').val();
					 $("#city_id option:selected").each(function(){
						selectedcity.push($(this).val());
								//alert(selectedLocation);
						}); 						
						
						if(selectedcity){
						$.ajax({ 
								type: "POST",
								url:'<?php echo $this->mainconfig['host'].'master/ajax-get-event-branch';?>',
								data: {selectedcity:selectedcity,tax_type_id:tax_type_id}
							}).done(function( data ) {
							//alert(data);
								$("#location_id").html( data );
							 });
					} */
		
			
var count = $('#count').val();
$("body").on("click","#AddButton6",function(event){
		var count_val = count++;		
		append_html = '<div class="row" style="padding-top:20px;width:100%;">';
		append_html += '<div class="col-md-2" style="margin-left: -2px;">Tax Type<select type="text"  class="form-control" label="tax_type'+count_val+'" name="tax[tax_type][]" style="background:#FFFFFF;">'+$('.copy_append0').html()+'</select></div>';
		append_html += '<div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:-10px">Fee Type Franchise<label class="label-checkbox" style="padding-left:0px; margin:6px;margin-left:-1px;" ><?php foreach($this->FeeType as $k=>$val){ ?><input type="checkbox"  class="form-control" label="fee_type_franchise'+count_val+'" name="tax[fee_type_franchise]['+count_val+'][]"  style=" background:#FFFFFF;" id="fee_type_franchise'+count_val+'" value="<?php echo $k;?>"/><span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val; ?><?php } ?></div>';
		append_html += '<div class="col-sm-2" style="height: 100px;overflow-y: scroll;margin-top:-10px;margin-left:-10px;">Fee Head<label class="label-checkbox" style="padding-left:0px; margin:6px;margin-left:-1px;" ><?php foreach($this->feehead as $k=>$val){ ?><input type="checkbox"  class="form-control" label="fee_head_'+count_val+'" name="tax[fee_head]['+count_val+'][]"  style=" background:#FFFFFF;" value="<?php echo $k;?>"/><span class="custom-checkbox" style="float:left;"></span> </label> <?php echo $val; ?><?php } ?></div>';
		append_html += '<div class="col-md-1" style="margin: 0px 1px;">Percentage<input type="text"  class="form-control" label="percentage_'+count_val+'" name="tax[percentage][]"  style=" background:#FFFFFF;"/></div>';
		append_html += '<div class="col-md-2" style="margin: 0px 5px;">From Date<input type="text"  class="form-control" label="from_date_'+count_val+'" name="tax[from_date][]"  style=" background:#FFFFFF;" id="from_date'+count_val+'"/></div>';
		append_html += '<div class="col-md-2" style="margin:0px 5px;">To Date<input type="text"  class="form-control" label="to_date_'+count_val+'" name="tax[to_date][]"  style=" background:#FFFFFF;" id="to_date'+count_val+'"/></div>';
		append_html += '<a href="#" class="removeclass6 btn btn-primary remove_class6 " style="padding:7px 19px; margin:15px 5px;">-</a>';
		append_html += '</div>';													
	 $('#fields7').append(append_html);
		$(".no-margin input[id='from_date"+count_val+"']").datepicker({format: 'yyyy-mm-dd'});
		$(".no-margin input[id='to_date"+count_val+"']").datepicker({format: 'yyyy-mm-dd'});
	
});

$("body").on("click",".removeclass6", function(e){//alert('sdsd');
	$(this).parent('div').remove(); 
	return false;
});
$('body').on('click','#select1',function() {
//alert('sdsd'); 
var id = $('#select1').val();
  if(id == 'Select All') {
      // Iterate each checkbox
      $('.checkbox1').each(function() {
          this.checked = true;
      });
  }
  else {
    $('.checkbox1').each(function() {
          this.checked = false;
      });
  }
}); 
$('body').on('click','#unselect1',function() {
var id = $('#unselect1').val();
//alert(id);
  if(id == 'Unselect All') {
      // Iterate each checkbox
      $('.checkbox1').each(function() {
          this.checked = false;
      });
  }
  else {
    $('.checkbox1').each(function() {
          this.checked = true;
      });
  }
});
$('body').on('click','#select2',function() {
//alert('sdsd'); 
var id = $('#select2').val();
  if(id == 'Select All') {
      // Iterate each checkbox
      $('.checkbox2').each(function() {
          this.checked = true;
      });
  }
  else {
    $('.checkbox2').each(function() {
          this.checked = false;
      });
  }
}); 
$('body').on('click','#unselect2',function() {
var id = $('#unselect2').val();
//alert(id);
  if(id == 'Unselect All') {
      // Iterate each checkbox
      $('.checkbox2').each(function() {
          this.checked = false;
      });
  }
  else {
    $('.checkbox2').each(function() {
          this.checked = true;
      });
  }
}) 

 /* var selected= new Array();
				var tax_type_id = $('#tax_type_id').val();
				//alert(tax_type_id);
					 $("#state_id option:selected").each(function(){
					 
						selected.push(this.value);
								alert(selected);
						}); 

				
						if(selected){
						$.ajax({ 
								type: "POST",
								url:'<?php echo $this->mainconfig['host'].'master/ajax-get-city-tax';?>',
								data: {selectedstate:selected,tax_type_id:tax_type_id}
							}).done(function( data ) {
							//alert(data);
								$("#city").html( data );
							 });
					}   */
</script>